{"version":3,"sources":["MapRenderer/node_modules/browser-pack/_prelude.js","MapRenderer/src/MapRenderer/index.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","$(\"#toggleHelper\").click(function () {\n  highlightEnabled = !highlightEnabled;\n});\n\n/// This example is very inspired by the ModelRenderer example but updated\n/// using the latest version of the API. This global object for the app contains\n/// all the important data.\nconst cleanMapData = {\n  id: null,\n  mapFile: null,\n  terrain: {\n    data: [],\n  },\n  collision: {\n    enabled: false,\n    loaded: false,\n    data: [],\n  },\n  props: {\n    enabled: false,\n    loaded: false,\n    data: [],\n  },\n  zone: {\n    enabled: false,\n    loaded: false,\n    data: [],\n  },\n};\n\nconst mapRenderer = {\n  /// All renderers must have access to a LocalReader.\n  /// The LocalReader is the object that allows us\n  /// to read from the .dat\n  localReader: null,\n\n  /// The context is an object all the renderer outputs their data to\n  context: null,\n\n  /// THREE js objects\n  scene: null,\n  camera: null,\n  renderer: null,\n  raycaster: null,\n  mouse: null,\n  controls: null,\n\n  /// Data:\n  mapData: Object.assign({}, cleanMapData),\n};\n\n/// Highlight specific variables\nlet highlightObject;\nlet highlightHelper;\nlet highlightEnabled = false;\n\n/// Extend Original Logger\nlet myLogger = {\n  lastMessageType: null,\n  log: function () {\n    let htmlOutput = $(\"#log\");\n    let str = Array.prototype.slice.call(arguments, 1).join(\" \");\n    if (arguments[1] === myLogger.lastMessageType) {\n      $(\"#log p:last-of-type\")[0].innerHTML = str;\n    } else {\n      htmlOutput.append($(\"<p>-------------</p>\"));\n      htmlOutput.append($(\"<p>\" + str + \"</p>\"));\n    }\n    htmlOutput[0].scrollTop = htmlOutput[0].scrollHeight;\n    myLogger.lastMessageType = arguments[1];\n  },\n};\n\n$(document).ready(function () {\n  /// Build TREE scene\n  setupScene();\n\n  /// Handle file pick\n  $(\"#filePicker\").change(function (evt) {\n    let file = evt.target.files[0];\n\n    mapRenderer.localReader = T3D.getLocalReader(\n      file,\n      onReaderCreated,\n      \"../static/t3dworker.js\",\n      myLogger\n    );\n  });\n\n  /// Handle button click\n  $(\"#loadMapBtn\").click(onLoadMapClick);\n});\n\n/// Callback for when the LocalReader has finished setting up!\nfunction onReaderCreated() {\n  $(\"#fileIdInput\").removeAttr(\"disabled\");\n  $(\"#fileMapSelect\").removeAttr(\"disabled\");\n  $(\"#loadMapBtn\").removeAttr(\"disabled\");\n\n  let opt = document.createElement(\"option\");\n  opt.value = undefined;\n  opt.innerHTML = \"\"; // whatever property it has\n  $(\"#fileMapSelect\").append(opt);\n\n  for (const category of T3D.MapFileList.maps) {\n    let opt = document.createElement(\"option\");\n    opt.disabled = true;\n    opt.innerHTML = category.name;\n    $(\"#fileMapSelect\").append(opt);\n\n    for (const map of category.maps) {\n      let opt = document.createElement(\"option\");\n      opt.value = map.fileName.split(\".data\")[0];\n      opt.innerHTML = map.name; // whatever property it has\n\n      // then append it to the select element\n      $(\"#fileMapSelect\").append(opt);\n    }\n  }\n}\n\n/// The insterresting part!\nfunction onLoadMapClick() {\n  $(\"#loadCollBtn\").click(loadCollModels);\n  $(\"#loadCollBtn\").removeAttr(\"disabled\");\n  $(\"#loadPropsBtn\").click(loadPropModels);\n  $(\"#loadPropsBtn\").removeAttr(\"disabled\");\n  $(\"#loadZoneBtn\").click(loadZoneModels);\n  $(\"#loadZoneBtn\").removeAttr(\"disabled\");\n\n  // Clean previous render states\n  mapRenderer.mapData = Object.assign({}, cleanMapData);\n\n  /// Get selected file id\n  if ($(\"#fileMapSelect\").val() && $(\"#fileMapSelect\").val() !== \"undefined\") {\n    mapRenderer.mapData.id = $(\"#fileMapSelect\").val();\n  } else {\n    mapRenderer.mapData.id = $(\"#fileIdInput\").val();\n  }\n\n  /// Renderer settings (see the documentation of each Renderer for details)\n  let renderers = [\n    {\n      renderClass: T3D.EnvironmentRenderer,\n      settings: {},\n    },\n    {\n      renderClass: T3D.TerrainRenderer,\n      settings: {},\n    },\n  ];\n\n  /// Setup the logger (hacky way because very verbose)\n  T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = function () {\n    myLogger.log(arguments[0], arguments[0], arguments[1]);\n    console.log(arguments[0], arguments[1]);\n  };\n\n  /// Load for the first time the renderer and spawn the context\n  T3D.renderMapContentsAsync(\n    mapRenderer.localReader,\n    mapRenderer.mapData.id,\n    renderers,\n    onRendererDone,\n    myLogger\n  );\n\n  /// And store the mapfile for future use\n  loadMapFile(mapRenderer.mapData.id, function (data) {\n    mapRenderer.mapData.mapFile = data;\n  });\n}\n\n/// Runs when the ModelRenderer is finshed\nfunction onRendererDone(context) {\n  document.addEventListener(\"mousemove\", onMouseMove, false);\n  document.addEventListener(\"mousedown\", onMouseDown, false);\n\n  cleanScene();\n\n  /// Populate our context with the context returned\n  mapRenderer.context = context;\n\n  /// Take all the terrain tiles generated by the TerrainRenderer and add them to the scene\n  for (const elem of T3D.getContextValue(\n    context,\n    T3D.TerrainRenderer,\n    \"terrainTiles\"\n  )) {\n    mapRenderer.scene.add(elem);\n    mapRenderer.mapData.terrain.data.push(elem);\n  }\n\n  /// Add the water level to the scene\n  let water = T3D.getContextValue(context, T3D.TerrainRenderer, \"water\");\n  mapRenderer.scene.add(water);\n  mapRenderer.mapData.terrain.data.push(water);\n\n  /// Move the camera initial place depending on the map bounds\n  let bounds = T3D.getContextValue(context, T3D.TerrainRenderer, \"bounds\");\n  mapRenderer.camera.position.x = 0;\n  mapRenderer.camera.position.y = bounds ? bounds.y2 : 0;\n  mapRenderer.camera.position.z = 0;\n}\n\n/// It's usually not needed to keep the mapFile independently but\n/// because we're loading the colision/props/zone models manually, it is.\nfunction loadMapFile(fileId, callback) {\n  if (parseInt(fileId)) {\n    mapRenderer.localReader.loadFile(fileId, function (arrayBuffer) {\n      let ds = new DataStream(arrayBuffer, 0, DataStream.LITTLE_ENDIAN);\n      let mapFile = new T3D.GW2File(ds, 0);\n      callback(mapFile);\n    });\n  }\n}\n\n/// Run a renderer manually and populates the data object\nfunction loadMeshes(rendererClass, outRendererData, callback) {\n  T3D.runRenderer(\n    rendererClass,\n    mapRenderer.localReader,\n    { visible: true, mapFile: mapRenderer.mapData.mapFile },\n    mapRenderer.context,\n    function () {\n      outRendererData.data = T3D.getContextValue(\n        mapRenderer.context,\n        rendererClass,\n        \"meshes\"\n      );\n      outRendererData.loaded = true;\n      callback();\n    }\n  );\n}\n\nfunction toggleMeshes(meshType, buttonId) {\n  let mapData = mapRenderer.mapData[meshType];\n  if (!mapData.enabled) {\n    for (const elem of mapData.data) {\n      mapRenderer.scene.add(elem);\n    }\n    mapData.enabled = true;\n    $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\n      \"Load\",\n      \"Unload\"\n    );\n  } else {\n    for (const elem of mapData.data) {\n      mapRenderer.scene.remove(elem);\n    }\n    mapData.enabled = false;\n    $(buttonId)[0].innerHTML = $(buttonId)[0].innerHTML.replace(\n      \"Unload\",\n      \"Load\"\n    );\n  }\n}\n\n/// Action when the load zone props button is clicked\nfunction loadZoneModels() {\n  if (!mapRenderer.mapData.zone.loaded) {\n    loadMeshes(T3D.ZoneRenderer, mapRenderer.mapData.zone, function () {\n      toggleMeshes(\"zone\", \"#loadZoneBtn\");\n    });\n  } else {\n    toggleMeshes(\"zone\", \"#loadZoneBtn\");\n  }\n}\n\n/// Action when the load props button is clicked\nfunction loadPropModels() {\n  if (!mapRenderer.mapData.props.loaded) {\n    loadMeshes(T3D.PropertiesRenderer, mapRenderer.mapData.props, function () {\n      toggleMeshes(\"props\", \"#loadPropsBtn\");\n    });\n  } else {\n    toggleMeshes(\"props\", \"#loadPropsBtn\");\n  }\n}\n\n/// Action when the load collisions button is clicked\nfunction loadCollModels() {\n  if (!mapRenderer.mapData.collision.loaded) {\n    loadMeshes(T3D.HavokRenderer, mapRenderer.mapData.collision, function () {\n      toggleMeshes(\"collision\", \"#loadCollBtn\");\n    });\n  } else {\n    toggleMeshes(\"collision\", \"#loadCollBtn\");\n  }\n}\n\n/// Wipes out the data\nfunction cleanScene() {\n  for (const type of [\"terrain\", \"props\", \"zone\", \"collision\"]) {\n    for (const elem of mapRenderer.mapData[type].data) {\n      mapRenderer.scene.remove(elem);\n    }\n    mapRenderer.mapData[type].data = [];\n  }\n\n  for (const type of [\"props\", \"zone\", \"collision\"]) {\n    mapRenderer.mapData[type].loaded = false;\n    mapRenderer.mapData[type].enabled = false;\n  }\n}\n\nfunction onMouseMove(event) {\n  let canvasBounds = mapRenderer.renderer.domElement.getBoundingClientRect();\n  mapRenderer.mouse.x =\n    ((event.clientX - canvasBounds.left) /\n      (canvasBounds.right - canvasBounds.left)) *\n      2 -\n    1;\n  mapRenderer.mouse.y =\n    -(\n      (event.clientY - canvasBounds.top) /\n      (canvasBounds.bottom - canvasBounds.top)\n    ) *\n      2 +\n    1;\n}\n\nfunction onMouseDown() {\n  if (highlightObject) {\n    console.log(highlightObject);\n  }\n}\n\n/// Basic THREE stuff, don't mind it\nfunction setupScene() {\n  let canvasWidth = 800;\n  let canvasHeight = 800;\n  let canvasClearColor = 0x342920; // For happy rendering, always use Van Dyke Brown.\n  let fov = 60;\n  let aspect = 1;\n\n  mapRenderer.camera = new THREE.PerspectiveCamera(fov, aspect, 0.1, 100000);\n\n  mapRenderer.scene = new THREE.Scene();\n\n  mapRenderer.raycaster = new THREE.Raycaster();\n  mapRenderer.mouse = new THREE.Vector2();\n\n  /// This scene has one ambient light source and three directional lights\n  let ambientLight = new THREE.AmbientLight(0x555555);\n  mapRenderer.scene.add(ambientLight);\n\n  let directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight1.position.set(0, 0, 1);\n  mapRenderer.scene.add(directionalLight1);\n\n  let directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight2.position.set(1, 0, 0);\n  mapRenderer.scene.add(directionalLight2);\n\n  let directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.8);\n  directionalLight3.position.set(0, 1, 0);\n  mapRenderer.scene.add(directionalLight3);\n\n  /// Standard THREE renderer with AA\n  mapRenderer.renderer = new THREE.WebGLRenderer({\n    antialiasing: true,\n    logarithmicDepthBuffer: true,\n  });\n  document.body.appendChild(mapRenderer.renderer.domElement);\n  mapRenderer.renderer.setSize(canvasWidth, canvasHeight);\n  mapRenderer.renderer.setClearColor(canvasClearColor);\n\n  setupController();\n\n  /// Note: constant continous rendering from page load\n  render();\n}\n\nfunction setupController() {\n  if (!mapRenderer.controls) {\n    let controls = new THREE.OrbitControls(\n      mapRenderer.camera,\n      mapRenderer.renderer.domElement\n    );\n    controls.enableZoom = true;\n    mapRenderer.controls = controls;\n  }\n}\n\nfunction render() {\n  window.requestAnimationFrame(render);\n\n  //Use the raycaster\n  if (highlightEnabled) {\n    mapRenderer.raycaster.setFromCamera(mapRenderer.mouse, mapRenderer.camera);\n    let intersects = mapRenderer.raycaster.intersectObjects(\n      mapRenderer.scene.children\n    );\n    if (intersects.length > 0) {\n      if (highlightObject !== intersects[0].object) {\n        if (highlightHelper) {\n          mapRenderer.scene.remove(highlightHelper);\n        }\n        highlightObject = intersects[0].object;\n        highlightHelper = new THREE.BoxHelper(highlightObject);\n        mapRenderer.scene.add(highlightHelper);\n      }\n    } else {\n      highlightObject = null;\n      if (highlightHelper) {\n        mapRenderer.scene.remove(highlightHelper);\n      }\n      highlightHelper = null;\n    }\n  }\n\n  mapRenderer.renderer.render(mapRenderer.scene, mapRenderer.camera);\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvTWFwUmVuZGVyZXIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiJChcIiN0b2dnbGVIZWxwZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICBoaWdobGlnaHRFbmFibGVkID0gIWhpZ2hsaWdodEVuYWJsZWQ7XG59KTtcblxuLy8vIFRoaXMgZXhhbXBsZSBpcyB2ZXJ5IGluc3BpcmVkIGJ5IHRoZSBNb2RlbFJlbmRlcmVyIGV4YW1wbGUgYnV0IHVwZGF0ZWRcbi8vLyB1c2luZyB0aGUgbGF0ZXN0IHZlcnNpb24gb2YgdGhlIEFQSS4gVGhpcyBnbG9iYWwgb2JqZWN0IGZvciB0aGUgYXBwIGNvbnRhaW5zXG4vLy8gYWxsIHRoZSBpbXBvcnRhbnQgZGF0YS5cbmNvbnN0IGNsZWFuTWFwRGF0YSA9IHtcbiAgaWQ6IG51bGwsXG4gIG1hcEZpbGU6IG51bGwsXG4gIHRlcnJhaW46IHtcbiAgICBkYXRhOiBbXSxcbiAgfSxcbiAgY29sbGlzaW9uOiB7XG4gICAgZW5hYmxlZDogZmFsc2UsXG4gICAgbG9hZGVkOiBmYWxzZSxcbiAgICBkYXRhOiBbXSxcbiAgfSxcbiAgcHJvcHM6IHtcbiAgICBlbmFibGVkOiBmYWxzZSxcbiAgICBsb2FkZWQ6IGZhbHNlLFxuICAgIGRhdGE6IFtdLFxuICB9LFxuICB6b25lOiB7XG4gICAgZW5hYmxlZDogZmFsc2UsXG4gICAgbG9hZGVkOiBmYWxzZSxcbiAgICBkYXRhOiBbXSxcbiAgfSxcbn07XG5cbmNvbnN0IG1hcFJlbmRlcmVyID0ge1xuICAvLy8gQWxsIHJlbmRlcmVycyBtdXN0IGhhdmUgYWNjZXNzIHRvIGEgTG9jYWxSZWFkZXIuXG4gIC8vLyBUaGUgTG9jYWxSZWFkZXIgaXMgdGhlIG9iamVjdCB0aGF0IGFsbG93cyB1c1xuICAvLy8gdG8gcmVhZCBmcm9tIHRoZSAuZGF0XG4gIGxvY2FsUmVhZGVyOiBudWxsLFxuXG4gIC8vLyBUaGUgY29udGV4dCBpcyBhbiBvYmplY3QgYWxsIHRoZSByZW5kZXJlciBvdXRwdXRzIHRoZWlyIGRhdGEgdG9cbiAgY29udGV4dDogbnVsbCxcblxuICAvLy8gVEhSRUUganMgb2JqZWN0c1xuICBzY2VuZTogbnVsbCxcbiAgY2FtZXJhOiBudWxsLFxuICByZW5kZXJlcjogbnVsbCxcbiAgcmF5Y2FzdGVyOiBudWxsLFxuICBtb3VzZTogbnVsbCxcbiAgY29udHJvbHM6IG51bGwsXG5cbiAgLy8vIERhdGE6XG4gIG1hcERhdGE6IE9iamVjdC5hc3NpZ24oe30sIGNsZWFuTWFwRGF0YSksXG59O1xuXG4vLy8gSGlnaGxpZ2h0IHNwZWNpZmljIHZhcmlhYmxlc1xubGV0IGhpZ2hsaWdodE9iamVjdDtcbmxldCBoaWdobGlnaHRIZWxwZXI7XG5sZXQgaGlnaGxpZ2h0RW5hYmxlZCA9IGZhbHNlO1xuXG4vLy8gRXh0ZW5kIE9yaWdpbmFsIExvZ2dlclxubGV0IG15TG9nZ2VyID0ge1xuICBsYXN0TWVzc2FnZVR5cGU6IG51bGwsXG4gIGxvZzogZnVuY3Rpb24gKCkge1xuICAgIGxldCBodG1sT3V0cHV0ID0gJChcIiNsb2dcIik7XG4gICAgbGV0IHN0ciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkuam9pbihcIiBcIik7XG4gICAgaWYgKGFyZ3VtZW50c1sxXSA9PT0gbXlMb2dnZXIubGFzdE1lc3NhZ2VUeXBlKSB7XG4gICAgICAkKFwiI2xvZyBwOmxhc3Qtb2YtdHlwZVwiKVswXS5pbm5lckhUTUwgPSBzdHI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGh0bWxPdXRwdXQuYXBwZW5kKCQoXCI8cD4tLS0tLS0tLS0tLS0tPC9wPlwiKSk7XG4gICAgICBodG1sT3V0cHV0LmFwcGVuZCgkKFwiPHA+XCIgKyBzdHIgKyBcIjwvcD5cIikpO1xuICAgIH1cbiAgICBodG1sT3V0cHV0WzBdLnNjcm9sbFRvcCA9IGh0bWxPdXRwdXRbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgIG15TG9nZ2VyLmxhc3RNZXNzYWdlVHlwZSA9IGFyZ3VtZW50c1sxXTtcbiAgfSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgLy8vIEJ1aWxkIFRSRUUgc2NlbmVcbiAgc2V0dXBTY2VuZSgpO1xuXG4gIC8vLyBIYW5kbGUgZmlsZSBwaWNrXG4gICQoXCIjZmlsZVBpY2tlclwiKS5jaGFuZ2UoZnVuY3Rpb24gKGV2dCkge1xuICAgIGxldCBmaWxlID0gZXZ0LnRhcmdldC5maWxlc1swXTtcblxuICAgIG1hcFJlbmRlcmVyLmxvY2FsUmVhZGVyID0gVDNELmdldExvY2FsUmVhZGVyKFxuICAgICAgZmlsZSxcbiAgICAgIG9uUmVhZGVyQ3JlYXRlZCxcbiAgICAgIFwiLi4vc3RhdGljL3QzZHdvcmtlci5qc1wiLFxuICAgICAgbXlMb2dnZXJcbiAgICApO1xuICB9KTtcblxuICAvLy8gSGFuZGxlIGJ1dHRvbiBjbGlja1xuICAkKFwiI2xvYWRNYXBCdG5cIikuY2xpY2sob25Mb2FkTWFwQ2xpY2spO1xufSk7XG5cbi8vLyBDYWxsYmFjayBmb3Igd2hlbiB0aGUgTG9jYWxSZWFkZXIgaGFzIGZpbmlzaGVkIHNldHRpbmcgdXAhXG5mdW5jdGlvbiBvblJlYWRlckNyZWF0ZWQoKSB7XG4gICQoXCIjZmlsZUlkSW5wdXRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAkKFwiI2ZpbGVNYXBTZWxlY3RcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAkKFwiI2xvYWRNYXBCdG5cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuXG4gIGxldCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICBvcHQudmFsdWUgPSB1bmRlZmluZWQ7XG4gIG9wdC5pbm5lckhUTUwgPSBcIlwiOyAvLyB3aGF0ZXZlciBwcm9wZXJ0eSBpdCBoYXNcbiAgJChcIiNmaWxlTWFwU2VsZWN0XCIpLmFwcGVuZChvcHQpO1xuXG4gIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgVDNELk1hcEZpbGVMaXN0Lm1hcHMpIHtcbiAgICBsZXQgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICBvcHQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIG9wdC5pbm5lckhUTUwgPSBjYXRlZ29yeS5uYW1lO1xuICAgICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5hcHBlbmQob3B0KTtcblxuICAgIGZvciAoY29uc3QgbWFwIG9mIGNhdGVnb3J5Lm1hcHMpIHtcbiAgICAgIGxldCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgICAgb3B0LnZhbHVlID0gbWFwLmZpbGVOYW1lLnNwbGl0KFwiLmRhdGFcIilbMF07XG4gICAgICBvcHQuaW5uZXJIVE1MID0gbWFwLm5hbWU7IC8vIHdoYXRldmVyIHByb3BlcnR5IGl0IGhhc1xuXG4gICAgICAvLyB0aGVuIGFwcGVuZCBpdCB0byB0aGUgc2VsZWN0IGVsZW1lbnRcbiAgICAgICQoXCIjZmlsZU1hcFNlbGVjdFwiKS5hcHBlbmQob3B0KTtcbiAgICB9XG4gIH1cbn1cblxuLy8vIFRoZSBpbnN0ZXJyZXN0aW5nIHBhcnQhXG5mdW5jdGlvbiBvbkxvYWRNYXBDbGljaygpIHtcbiAgJChcIiNsb2FkQ29sbEJ0blwiKS5jbGljayhsb2FkQ29sbE1vZGVscyk7XG4gICQoXCIjbG9hZENvbGxCdG5cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAkKFwiI2xvYWRQcm9wc0J0blwiKS5jbGljayhsb2FkUHJvcE1vZGVscyk7XG4gICQoXCIjbG9hZFByb3BzQnRuXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgJChcIiNsb2FkWm9uZUJ0blwiKS5jbGljayhsb2FkWm9uZU1vZGVscyk7XG4gICQoXCIjbG9hZFpvbmVCdG5cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuXG4gIC8vIENsZWFuIHByZXZpb3VzIHJlbmRlciBzdGF0ZXNcbiAgbWFwUmVuZGVyZXIubWFwRGF0YSA9IE9iamVjdC5hc3NpZ24oe30sIGNsZWFuTWFwRGF0YSk7XG5cbiAgLy8vIEdldCBzZWxlY3RlZCBmaWxlIGlkXG4gIGlmICgkKFwiI2ZpbGVNYXBTZWxlY3RcIikudmFsKCkgJiYgJChcIiNmaWxlTWFwU2VsZWN0XCIpLnZhbCgpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YS5pZCA9ICQoXCIjZmlsZU1hcFNlbGVjdFwiKS52YWwoKTtcbiAgfSBlbHNlIHtcbiAgICBtYXBSZW5kZXJlci5tYXBEYXRhLmlkID0gJChcIiNmaWxlSWRJbnB1dFwiKS52YWwoKTtcbiAgfVxuXG4gIC8vLyBSZW5kZXJlciBzZXR0aW5ncyAoc2VlIHRoZSBkb2N1bWVudGF0aW9uIG9mIGVhY2ggUmVuZGVyZXIgZm9yIGRldGFpbHMpXG4gIGxldCByZW5kZXJlcnMgPSBbXG4gICAge1xuICAgICAgcmVuZGVyQ2xhc3M6IFQzRC5FbnZpcm9ubWVudFJlbmRlcmVyLFxuICAgICAgc2V0dGluZ3M6IHt9LFxuICAgIH0sXG4gICAge1xuICAgICAgcmVuZGVyQ2xhc3M6IFQzRC5UZXJyYWluUmVuZGVyZXIsXG4gICAgICBzZXR0aW5nczoge30sXG4gICAgfSxcbiAgXTtcblxuICAvLy8gU2V0dXAgdGhlIGxvZ2dlciAoaGFja3kgd2F5IGJlY2F1c2UgdmVyeSB2ZXJib3NlKVxuICBUM0QuTG9nZ2VyLmxvZ0Z1bmN0aW9uc1tUM0QuTG9nZ2VyLlRZUEVfUFJPR1JFU1NdID0gZnVuY3Rpb24gKCkge1xuICAgIG15TG9nZ2VyLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1swXSwgYXJndW1lbnRzWzFdKTtcbiAgICBjb25zb2xlLmxvZyhhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSk7XG4gIH07XG5cbiAgLy8vIExvYWQgZm9yIHRoZSBmaXJzdCB0aW1lIHRoZSByZW5kZXJlciBhbmQgc3Bhd24gdGhlIGNvbnRleHRcbiAgVDNELnJlbmRlck1hcENvbnRlbnRzQXN5bmMoXG4gICAgbWFwUmVuZGVyZXIubG9jYWxSZWFkZXIsXG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YS5pZCxcbiAgICByZW5kZXJlcnMsXG4gICAgb25SZW5kZXJlckRvbmUsXG4gICAgbXlMb2dnZXJcbiAgKTtcblxuICAvLy8gQW5kIHN0b3JlIHRoZSBtYXBmaWxlIGZvciBmdXR1cmUgdXNlXG4gIGxvYWRNYXBGaWxlKG1hcFJlbmRlcmVyLm1hcERhdGEuaWQsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgbWFwUmVuZGVyZXIubWFwRGF0YS5tYXBGaWxlID0gZGF0YTtcbiAgfSk7XG59XG5cbi8vLyBSdW5zIHdoZW4gdGhlIE1vZGVsUmVuZGVyZXIgaXMgZmluc2hlZFxuZnVuY3Rpb24gb25SZW5kZXJlckRvbmUoY29udGV4dCkge1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIG9uTW91c2VNb3ZlLCBmYWxzZSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgb25Nb3VzZURvd24sIGZhbHNlKTtcblxuICBjbGVhblNjZW5lKCk7XG5cbiAgLy8vIFBvcHVsYXRlIG91ciBjb250ZXh0IHdpdGggdGhlIGNvbnRleHQgcmV0dXJuZWRcbiAgbWFwUmVuZGVyZXIuY29udGV4dCA9IGNvbnRleHQ7XG5cbiAgLy8vIFRha2UgYWxsIHRoZSB0ZXJyYWluIHRpbGVzIGdlbmVyYXRlZCBieSB0aGUgVGVycmFpblJlbmRlcmVyIGFuZCBhZGQgdGhlbSB0byB0aGUgc2NlbmVcbiAgZm9yIChjb25zdCBlbGVtIG9mIFQzRC5nZXRDb250ZXh0VmFsdWUoXG4gICAgY29udGV4dCxcbiAgICBUM0QuVGVycmFpblJlbmRlcmVyLFxuICAgIFwidGVycmFpblRpbGVzXCJcbiAgKSkge1xuICAgIG1hcFJlbmRlcmVyLnNjZW5lLmFkZChlbGVtKTtcbiAgICBtYXBSZW5kZXJlci5tYXBEYXRhLnRlcnJhaW4uZGF0YS5wdXNoKGVsZW0pO1xuICB9XG5cbiAgLy8vIEFkZCB0aGUgd2F0ZXIgbGV2ZWwgdG8gdGhlIHNjZW5lXG4gIGxldCB3YXRlciA9IFQzRC5nZXRDb250ZXh0VmFsdWUoY29udGV4dCwgVDNELlRlcnJhaW5SZW5kZXJlciwgXCJ3YXRlclwiKTtcbiAgbWFwUmVuZGVyZXIuc2NlbmUuYWRkKHdhdGVyKTtcbiAgbWFwUmVuZGVyZXIubWFwRGF0YS50ZXJyYWluLmRhdGEucHVzaCh3YXRlcik7XG5cbiAgLy8vIE1vdmUgdGhlIGNhbWVyYSBpbml0aWFsIHBsYWNlIGRlcGVuZGluZyBvbiB0aGUgbWFwIGJvdW5kc1xuICBsZXQgYm91bmRzID0gVDNELmdldENvbnRleHRWYWx1ZShjb250ZXh0LCBUM0QuVGVycmFpblJlbmRlcmVyLCBcImJvdW5kc1wiKTtcbiAgbWFwUmVuZGVyZXIuY2FtZXJhLnBvc2l0aW9uLnggPSAwO1xuICBtYXBSZW5kZXJlci5jYW1lcmEucG9zaXRpb24ueSA9IGJvdW5kcyA/IGJvdW5kcy55MiA6IDA7XG4gIG1hcFJlbmRlcmVyLmNhbWVyYS5wb3NpdGlvbi56ID0gMDtcbn1cblxuLy8vIEl0J3MgdXN1YWxseSBub3QgbmVlZGVkIHRvIGtlZXAgdGhlIG1hcEZpbGUgaW5kZXBlbmRlbnRseSBidXRcbi8vLyBiZWNhdXNlIHdlJ3JlIGxvYWRpbmcgdGhlIGNvbGlzaW9uL3Byb3BzL3pvbmUgbW9kZWxzIG1hbnVhbGx5LCBpdCBpcy5cbmZ1bmN0aW9uIGxvYWRNYXBGaWxlKGZpbGVJZCwgY2FsbGJhY2spIHtcbiAgaWYgKHBhcnNlSW50KGZpbGVJZCkpIHtcbiAgICBtYXBSZW5kZXJlci5sb2NhbFJlYWRlci5sb2FkRmlsZShmaWxlSWQsIGZ1bmN0aW9uIChhcnJheUJ1ZmZlcikge1xuICAgICAgbGV0IGRzID0gbmV3IERhdGFTdHJlYW0oYXJyYXlCdWZmZXIsIDAsIERhdGFTdHJlYW0uTElUVExFX0VORElBTik7XG4gICAgICBsZXQgbWFwRmlsZSA9IG5ldyBUM0QuR1cyRmlsZShkcywgMCk7XG4gICAgICBjYWxsYmFjayhtYXBGaWxlKTtcbiAgICB9KTtcbiAgfVxufVxuXG4vLy8gUnVuIGEgcmVuZGVyZXIgbWFudWFsbHkgYW5kIHBvcHVsYXRlcyB0aGUgZGF0YSBvYmplY3RcbmZ1bmN0aW9uIGxvYWRNZXNoZXMocmVuZGVyZXJDbGFzcywgb3V0UmVuZGVyZXJEYXRhLCBjYWxsYmFjaykge1xuICBUM0QucnVuUmVuZGVyZXIoXG4gICAgcmVuZGVyZXJDbGFzcyxcbiAgICBtYXBSZW5kZXJlci5sb2NhbFJlYWRlcixcbiAgICB7IHZpc2libGU6IHRydWUsIG1hcEZpbGU6IG1hcFJlbmRlcmVyLm1hcERhdGEubWFwRmlsZSB9LFxuICAgIG1hcFJlbmRlcmVyLmNvbnRleHQsXG4gICAgZnVuY3Rpb24gKCkge1xuICAgICAgb3V0UmVuZGVyZXJEYXRhLmRhdGEgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKFxuICAgICAgICBtYXBSZW5kZXJlci5jb250ZXh0LFxuICAgICAgICByZW5kZXJlckNsYXNzLFxuICAgICAgICBcIm1lc2hlc1wiXG4gICAgICApO1xuICAgICAgb3V0UmVuZGVyZXJEYXRhLmxvYWRlZCA9IHRydWU7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlTWVzaGVzKG1lc2hUeXBlLCBidXR0b25JZCkge1xuICBsZXQgbWFwRGF0YSA9IG1hcFJlbmRlcmVyLm1hcERhdGFbbWVzaFR5cGVdO1xuICBpZiAoIW1hcERhdGEuZW5hYmxlZCkge1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiBtYXBEYXRhLmRhdGEpIHtcbiAgICAgIG1hcFJlbmRlcmVyLnNjZW5lLmFkZChlbGVtKTtcbiAgICB9XG4gICAgbWFwRGF0YS5lbmFibGVkID0gdHJ1ZTtcbiAgICAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwgPSAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwucmVwbGFjZShcbiAgICAgIFwiTG9hZFwiLFxuICAgICAgXCJVbmxvYWRcIlxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIG1hcERhdGEuZGF0YSkge1xuICAgICAgbWFwUmVuZGVyZXIuc2NlbmUucmVtb3ZlKGVsZW0pO1xuICAgIH1cbiAgICBtYXBEYXRhLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwgPSAkKGJ1dHRvbklkKVswXS5pbm5lckhUTUwucmVwbGFjZShcbiAgICAgIFwiVW5sb2FkXCIsXG4gICAgICBcIkxvYWRcIlxuICAgICk7XG4gIH1cbn1cblxuLy8vIEFjdGlvbiB3aGVuIHRoZSBsb2FkIHpvbmUgcHJvcHMgYnV0dG9uIGlzIGNsaWNrZWRcbmZ1bmN0aW9uIGxvYWRab25lTW9kZWxzKCkge1xuICBpZiAoIW1hcFJlbmRlcmVyLm1hcERhdGEuem9uZS5sb2FkZWQpIHtcbiAgICBsb2FkTWVzaGVzKFQzRC5ab25lUmVuZGVyZXIsIG1hcFJlbmRlcmVyLm1hcERhdGEuem9uZSwgZnVuY3Rpb24gKCkge1xuICAgICAgdG9nZ2xlTWVzaGVzKFwiem9uZVwiLCBcIiNsb2FkWm9uZUJ0blwiKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICB0b2dnbGVNZXNoZXMoXCJ6b25lXCIsIFwiI2xvYWRab25lQnRuXCIpO1xuICB9XG59XG5cbi8vLyBBY3Rpb24gd2hlbiB0aGUgbG9hZCBwcm9wcyBidXR0b24gaXMgY2xpY2tlZFxuZnVuY3Rpb24gbG9hZFByb3BNb2RlbHMoKSB7XG4gIGlmICghbWFwUmVuZGVyZXIubWFwRGF0YS5wcm9wcy5sb2FkZWQpIHtcbiAgICBsb2FkTWVzaGVzKFQzRC5Qcm9wZXJ0aWVzUmVuZGVyZXIsIG1hcFJlbmRlcmVyLm1hcERhdGEucHJvcHMsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRvZ2dsZU1lc2hlcyhcInByb3BzXCIsIFwiI2xvYWRQcm9wc0J0blwiKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICB0b2dnbGVNZXNoZXMoXCJwcm9wc1wiLCBcIiNsb2FkUHJvcHNCdG5cIik7XG4gIH1cbn1cblxuLy8vIEFjdGlvbiB3aGVuIHRoZSBsb2FkIGNvbGxpc2lvbnMgYnV0dG9uIGlzIGNsaWNrZWRcbmZ1bmN0aW9uIGxvYWRDb2xsTW9kZWxzKCkge1xuICBpZiAoIW1hcFJlbmRlcmVyLm1hcERhdGEuY29sbGlzaW9uLmxvYWRlZCkge1xuICAgIGxvYWRNZXNoZXMoVDNELkhhdm9rUmVuZGVyZXIsIG1hcFJlbmRlcmVyLm1hcERhdGEuY29sbGlzaW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICB0b2dnbGVNZXNoZXMoXCJjb2xsaXNpb25cIiwgXCIjbG9hZENvbGxCdG5cIik7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgdG9nZ2xlTWVzaGVzKFwiY29sbGlzaW9uXCIsIFwiI2xvYWRDb2xsQnRuXCIpO1xuICB9XG59XG5cbi8vLyBXaXBlcyBvdXQgdGhlIGRhdGFcbmZ1bmN0aW9uIGNsZWFuU2NlbmUoKSB7XG4gIGZvciAoY29uc3QgdHlwZSBvZiBbXCJ0ZXJyYWluXCIsIFwicHJvcHNcIiwgXCJ6b25lXCIsIFwiY29sbGlzaW9uXCJdKSB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIG1hcFJlbmRlcmVyLm1hcERhdGFbdHlwZV0uZGF0YSkge1xuICAgICAgbWFwUmVuZGVyZXIuc2NlbmUucmVtb3ZlKGVsZW0pO1xuICAgIH1cbiAgICBtYXBSZW5kZXJlci5tYXBEYXRhW3R5cGVdLmRhdGEgPSBbXTtcbiAgfVxuXG4gIGZvciAoY29uc3QgdHlwZSBvZiBbXCJwcm9wc1wiLCBcInpvbmVcIiwgXCJjb2xsaXNpb25cIl0pIHtcbiAgICBtYXBSZW5kZXJlci5tYXBEYXRhW3R5cGVdLmxvYWRlZCA9IGZhbHNlO1xuICAgIG1hcFJlbmRlcmVyLm1hcERhdGFbdHlwZV0uZW5hYmxlZCA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9uTW91c2VNb3ZlKGV2ZW50KSB7XG4gIGxldCBjYW52YXNCb3VuZHMgPSBtYXBSZW5kZXJlci5yZW5kZXJlci5kb21FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBtYXBSZW5kZXJlci5tb3VzZS54ID1cbiAgICAoKGV2ZW50LmNsaWVudFggLSBjYW52YXNCb3VuZHMubGVmdCkgL1xuICAgICAgKGNhbnZhc0JvdW5kcy5yaWdodCAtIGNhbnZhc0JvdW5kcy5sZWZ0KSkgKlxuICAgICAgMiAtXG4gICAgMTtcbiAgbWFwUmVuZGVyZXIubW91c2UueSA9XG4gICAgLShcbiAgICAgIChldmVudC5jbGllbnRZIC0gY2FudmFzQm91bmRzLnRvcCkgL1xuICAgICAgKGNhbnZhc0JvdW5kcy5ib3R0b20gLSBjYW52YXNCb3VuZHMudG9wKVxuICAgICkgKlxuICAgICAgMiArXG4gICAgMTtcbn1cblxuZnVuY3Rpb24gb25Nb3VzZURvd24oKSB7XG4gIGlmIChoaWdobGlnaHRPYmplY3QpIHtcbiAgICBjb25zb2xlLmxvZyhoaWdobGlnaHRPYmplY3QpO1xuICB9XG59XG5cbi8vLyBCYXNpYyBUSFJFRSBzdHVmZiwgZG9uJ3QgbWluZCBpdFxuZnVuY3Rpb24gc2V0dXBTY2VuZSgpIHtcbiAgbGV0IGNhbnZhc1dpZHRoID0gODAwO1xuICBsZXQgY2FudmFzSGVpZ2h0ID0gODAwO1xuICBsZXQgY2FudmFzQ2xlYXJDb2xvciA9IDB4MzQyOTIwOyAvLyBGb3IgaGFwcHkgcmVuZGVyaW5nLCBhbHdheXMgdXNlIFZhbiBEeWtlIEJyb3duLlxuICBsZXQgZm92ID0gNjA7XG4gIGxldCBhc3BlY3QgPSAxO1xuXG4gIG1hcFJlbmRlcmVyLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShmb3YsIGFzcGVjdCwgMC4xLCAxMDAwMDApO1xuXG4gIG1hcFJlbmRlcmVyLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgbWFwUmVuZGVyZXIucmF5Y2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3RlcigpO1xuICBtYXBSZW5kZXJlci5tb3VzZSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XG5cbiAgLy8vIFRoaXMgc2NlbmUgaGFzIG9uZSBhbWJpZW50IGxpZ2h0IHNvdXJjZSBhbmQgdGhyZWUgZGlyZWN0aW9uYWwgbGlnaHRzXG4gIGxldCBhbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KDB4NTU1NTU1KTtcbiAgbWFwUmVuZGVyZXIuc2NlbmUuYWRkKGFtYmllbnRMaWdodCk7XG5cbiAgbGV0IGRpcmVjdGlvbmFsTGlnaHQxID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gIGRpcmVjdGlvbmFsTGlnaHQxLnBvc2l0aW9uLnNldCgwLCAwLCAxKTtcbiAgbWFwUmVuZGVyZXIuc2NlbmUuYWRkKGRpcmVjdGlvbmFsTGlnaHQxKTtcblxuICBsZXQgZGlyZWN0aW9uYWxMaWdodDIgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMC44KTtcbiAgZGlyZWN0aW9uYWxMaWdodDIucG9zaXRpb24uc2V0KDEsIDAsIDApO1xuICBtYXBSZW5kZXJlci5zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDIpO1xuXG4gIGxldCBkaXJlY3Rpb25hbExpZ2h0MyA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAwLjgpO1xuICBkaXJlY3Rpb25hbExpZ2h0My5wb3NpdGlvbi5zZXQoMCwgMSwgMCk7XG4gIG1hcFJlbmRlcmVyLnNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0Myk7XG5cbiAgLy8vIFN0YW5kYXJkIFRIUkVFIHJlbmRlcmVyIHdpdGggQUFcbiAgbWFwUmVuZGVyZXIucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7XG4gICAgYW50aWFsaWFzaW5nOiB0cnVlLFxuICAgIGxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IHRydWUsXG4gIH0pO1xuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1hcFJlbmRlcmVyLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICBtYXBSZW5kZXJlci5yZW5kZXJlci5zZXRTaXplKGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpO1xuICBtYXBSZW5kZXJlci5yZW5kZXJlci5zZXRDbGVhckNvbG9yKGNhbnZhc0NsZWFyQ29sb3IpO1xuXG4gIHNldHVwQ29udHJvbGxlcigpO1xuXG4gIC8vLyBOb3RlOiBjb25zdGFudCBjb250aW5vdXMgcmVuZGVyaW5nIGZyb20gcGFnZSBsb2FkXG4gIHJlbmRlcigpO1xufVxuXG5mdW5jdGlvbiBzZXR1cENvbnRyb2xsZXIoKSB7XG4gIGlmICghbWFwUmVuZGVyZXIuY29udHJvbHMpIHtcbiAgICBsZXQgY29udHJvbHMgPSBuZXcgVEhSRUUuT3JiaXRDb250cm9scyhcbiAgICAgIG1hcFJlbmRlcmVyLmNhbWVyYSxcbiAgICAgIG1hcFJlbmRlcmVyLnJlbmRlcmVyLmRvbUVsZW1lbnRcbiAgICApO1xuICAgIGNvbnRyb2xzLmVuYWJsZVpvb20gPSB0cnVlO1xuICAgIG1hcFJlbmRlcmVyLmNvbnRyb2xzID0gY29udHJvbHM7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVuZGVyKCkge1xuICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7XG5cbiAgLy9Vc2UgdGhlIHJheWNhc3RlclxuICBpZiAoaGlnaGxpZ2h0RW5hYmxlZCkge1xuICAgIG1hcFJlbmRlcmVyLnJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKG1hcFJlbmRlcmVyLm1vdXNlLCBtYXBSZW5kZXJlci5jYW1lcmEpO1xuICAgIGxldCBpbnRlcnNlY3RzID0gbWFwUmVuZGVyZXIucmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHMoXG4gICAgICBtYXBSZW5kZXJlci5zY2VuZS5jaGlsZHJlblxuICAgICk7XG4gICAgaWYgKGludGVyc2VjdHMubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKGhpZ2hsaWdodE9iamVjdCAhPT0gaW50ZXJzZWN0c1swXS5vYmplY3QpIHtcbiAgICAgICAgaWYgKGhpZ2hsaWdodEhlbHBlcikge1xuICAgICAgICAgIG1hcFJlbmRlcmVyLnNjZW5lLnJlbW92ZShoaWdobGlnaHRIZWxwZXIpO1xuICAgICAgICB9XG4gICAgICAgIGhpZ2hsaWdodE9iamVjdCA9IGludGVyc2VjdHNbMF0ub2JqZWN0O1xuICAgICAgICBoaWdobGlnaHRIZWxwZXIgPSBuZXcgVEhSRUUuQm94SGVscGVyKGhpZ2hsaWdodE9iamVjdCk7XG4gICAgICAgIG1hcFJlbmRlcmVyLnNjZW5lLmFkZChoaWdobGlnaHRIZWxwZXIpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBoaWdobGlnaHRPYmplY3QgPSBudWxsO1xuICAgICAgaWYgKGhpZ2hsaWdodEhlbHBlcikge1xuICAgICAgICBtYXBSZW5kZXJlci5zY2VuZS5yZW1vdmUoaGlnaGxpZ2h0SGVscGVyKTtcbiAgICAgIH1cbiAgICAgIGhpZ2hsaWdodEhlbHBlciA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgbWFwUmVuZGVyZXIucmVuZGVyZXIucmVuZGVyKG1hcFJlbmRlcmVyLnNjZW5lLCBtYXBSZW5kZXJlci5jYW1lcmEpO1xufVxuIl19"}