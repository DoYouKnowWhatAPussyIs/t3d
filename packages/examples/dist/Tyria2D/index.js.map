{"version":3,"sources":["Tyria2D/node_modules/browser-pack/_prelude.js","Tyria2D/src/Tyria2D/index.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","window.onload = () => {\n  /// T3D\n  let _lr;\n  let _context;\n  let _fileId;\n  let _fileList;\n  let _audioSource;\n  let _audioContext;\n\n  /// THREE\n  let _scene;\n  let _camera;\n  let _renderer;\n  let _models = [];\n  let _controls;\n\n  $(function () {\n    /*\n        SET MAIN UP GRID\n        */\n    let pstyle = \"border: 1px solid #dfdfdf; padding: 0;\";\n    $(\"#layout\").w2layout({\n      name: \"layout\",\n      panels: [\n        {\n          type: \"left\",\n          size: 570,\n          resizable: true,\n          style: pstyle + \"margin:0\",\n        },\n        {\n          type: \"main\",\n          style: pstyle + \" background-color: transparent;\",\n          toolbar: {\n            style: \"background-color:#eaeaea; height:40px\",\n            items: [\n              {\n                type: \"html\",\n                id: \"fileIdToolbar\",\n                html:\n                  '<div class=\"toolbarEntry\">' +\n                  \" File ID:\" +\n                  '    <input id=\"fileIdInput\"/>' +\n                  '    <button id=\"fileIdInputBtn\">' +\n                  \"    Load </button>\" +\n                  \"</div>\",\n              },\n              {\n                type: \"html\",\n                id: \"contextToolbar\",\n                html: '<div class=\"toolbarEntry\" id=\"contextToolbar\"></div>',\n              },\n            ],\n            onClick: function (event) {\n              this.owner.content(\"main\", event);\n            },\n          },\n        },\n      ],\n      onResize: onCanvasResize,\n    });\n\n    $(\"#fileIdInputBtn\").click(function () {\n      viewFileByFileId($(\"#fileIdInput\").val());\n    });\n\n    /// Grid inside main left\n    $().w2layout({\n      name: \"leftLayout\",\n      panels: [\n        {\n          type: \"left\",\n          size: 150,\n          resizable: true,\n          style: pstyle,\n          content: \"left\",\n        },\n        {\n          type: \"main\",\n          size: 420,\n          resizable: true,\n          style: pstyle,\n          content: \"right\",\n        },\n      ],\n    });\n    w2ui[\"layout\"].content(\"left\", w2ui[\"leftLayout\"]);\n\n    /*\n            SIDEBAR\n            */\n    w2ui[\"leftLayout\"].content(\n      \"left\",\n      $().w2sidebar({\n        name: \"sidebar\",\n        img: null,\n        nodes: [{ id: \"All\", text: \"All\", img: \"icon-folder\", group: false }],\n        onClick: onFilterClick,\n      })\n    );\n\n    /*\n            SET UP FILE BROWSER\n            */\n    w2ui[\"leftLayout\"].content(\n      \"main\",\n      $().w2grid({\n        name: \"grid\",\n        show: {\n          toolbar: true,\n          footer: true,\n        },\n        columns: [\n          {\n            field: \"recid\",\n            caption: \"MFT index\",\n            size: \"80px\",\n            sortable: true,\n            resizable: true,\n            searchable: \"int\",\n          },\n          {\n            field: \"baseIds\",\n            caption: \"BaseId list\",\n            size: \"100%\",\n            sortable: true,\n            resizable: true,\n            searchable: true,\n          },\n          {\n            field: \"type\",\n            caption: \"Type\",\n            size: \"100px\",\n            resizable: true,\n            sortable: true,\n          },\n          {\n            field: \"fileSize\",\n            caption: \"Pack Size\",\n            size: \"85px\",\n            resizable: true,\n            sortable: true,\n          },\n        ],\n        onClick: function (event) {\n          viewFileByMFT(event.recid);\n        },\n      })\n    );\n\n    /*\n            SET UP FILE VIEW 'WINDOW'\n            */\n    $(w2ui[\"layout\"].el(\"main\"))\n      .append($(\"<h1 id='fileTitle' />\"))\n      .append($(\"<div id='fileTabs' />\"))\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsRaw'>\" +\n            \"<div class='tabOutput' id='rawOutput' />\" +\n            \"</div>\"\n        )\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsPack'>\" +\n            \"<div class='tabOutput' id='packOutput' />\" +\n            \"</div>\"\n        ).hide()\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsTexture'>\" +\n            \"<div class='tabOutput' id='textureOutput' />\" +\n            \"</div>\"\n        ).hide()\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsString'>\" +\n            \"<div id='stringOutput' />\" +\n            \"</div>\"\n        ).hide()\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsModel'>\" +\n            \"<div id='modelOutput'/>\" +\n            \"</div>\"\n        ).hide()\n      )\n      .append(\n        $(\n          \"<div class='fileTab' id='fileTabsSound'>\" +\n            \"<div class='tabOutput' id='soundOutput'/>\" +\n            \"</div>\"\n        ).hide()\n      );\n\n    $(\"#fileTabs\").w2tabs({\n      name: \"fileTabs\",\n      active: \"tabRaw\",\n      tabs: [\n        {\n          id: \"tabRaw\",\n          caption: \"Raw\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsRaw\").show();\n          },\n        },\n        {\n          id: \"tabPF\",\n          caption: \"Pack File\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsPack\").show();\n          },\n        },\n        {\n          id: \"tabTexture\",\n          caption: \"Texture\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsTexture\").show();\n          },\n        },\n        {\n          id: \"tabString\",\n          caption: \"String\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsString\").show();\n          },\n        },\n        {\n          id: \"tabModel\",\n          caption: \"Model\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsModel\").show();\n          },\n        },\n        {\n          id: \"tabSound\",\n          caption: \"Sound\",\n          disabled: true,\n          onClick: function () {\n            $(\".fileTab\").hide();\n            $(\"#fileTabsSound\").show();\n          },\n        },\n      ],\n    });\n\n    /// Set up grid for strings view\n    ///Create grid\n    $(\"#stringOutput\").w2grid({\n      name: \"stringGrid\",\n      selectType: \"cell\",\n      show: {\n        toolbar: true,\n        footer: true,\n      },\n      columns: [\n        { field: \"recid\", caption: \"Row #\", size: \"60px\" },\n        { field: \"value\", caption: \"Text\", size: \"100%\" },\n      ],\n    });\n\n    /*\n            SET UP TREE 3D SCENE\n        */\n    setupScene();\n\n    /// Ask for file\n    w2popup.open({\n      speed: 0,\n      title: \"Load A GW2 dat\",\n      modal: true,\n      showClose: false,\n      body:\n        '<div class=\"w2ui-centered\">' +\n        '<div id=\"fileLoadProgress\" />' +\n        '<input id=\"filePickerPop\" type=\"file\" />' +\n        \"</div>\",\n    });\n\n    $(\"#filePickerPop\").change(function (evt) {\n      _lr = T3D.getLocalReader(\n        evt.target.files[0],\n        onReaderCreated,\n        \"../static/t3dworker.js\"\n      );\n    });\n\n    /// Overwrite progress logger\n    T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = function () {\n      $(\"#filePickerPop\").prop(\"disabled\", true);\n      $(\"#fileLoadProgress\").html(\n        \"Indexing .dat file (first visit only)<br/>\" +\n          arguments[1] +\n          \"%<br/><br/>\"\n      );\n    };\n  });\n\n  function onReaderCreated() {\n    T3D.getFileListAsync(\n      _lr,\n      function (files) {\n        /// Store fileList globally\n        _fileList = files;\n\n        let packNode = {\n          id: \"packGroup\",\n          text: \"Pack Files\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        let textureNode = {\n          id: \"textureGroup\",\n          text: \"Texture files\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        let unsortedNode = {\n          id: \"unsortedGroup\",\n          text: \"Unsorted\",\n          img: \"icon-folder\",\n          group: false,\n          nodes: [],\n        };\n\n        /// Build sidebar nodes\n        for (let fileType in _fileList) {\n          if (Object.getOwnPropertyNames(_fileList).includes(fileType)) {\n            let node = { id: fileType, img: \"icon-folder\", group: false };\n            //let isPack = false;\n            if (fileType.startsWith(\"TEXTURE\")) {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              textureNode.nodes.push(node);\n            } else if (fileType === \"BINARIES\") {\n              node.text = \"Binaries\";\n              w2ui.sidebar.add(node);\n            } else if (fileType === \"STRINGS\") {\n              node.text = \"Strings\";\n              w2ui.sidebar.add(node);\n            } else if (fileType.startsWith(\"PF\")) {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              packNode.nodes.push(node);\n            } else if (fileType === \"UNKNOWN\") {\n              node.text = \"Unknown\";\n              w2ui.sidebar.add(node);\n            } else {\n              node = {\n                id: fileType,\n                img: \"icon-folder\",\n                group: false,\n                text: fileType,\n              };\n              unsortedNode.nodes.push(node);\n            }\n          }\n        }\n\n        if (packNode.nodes.length > 0) {\n          w2ui.sidebar.add(packNode);\n        }\n\n        if (textureNode.nodes.length > 0) {\n          w2ui.sidebar.add(textureNode);\n        }\n\n        if (unsortedNode.nodes.length > 0) {\n          w2ui.sidebar.add(unsortedNode);\n        }\n\n        /// Close the pop\n        w2popup.close();\n\n        /// Select the \"All\" category\n        w2ui.sidebar.click(\"All\");\n      } /// End readFileListAsync callback\n    );\n  }\n\n  function onFilterClick(evt) {\n    /// No filter if clicked group was \"All\"\n    if (evt.target === \"All\") {\n      showFileGroup();\n    }\n\n    /// Other events are fine to just pass\n    else {\n      showFileGroup([evt.target]);\n    }\n  }\n\n  function showFileGroup(fileTypeFilter) {\n    w2ui.grid.records = [];\n\n    let reverseTable = _lr.getReverseIndex();\n\n    for (const fileType in _fileList) {\n      /// Only show types we've asked for\n      if (fileTypeFilter && fileTypeFilter.indexOf(fileType) < 0) {\n        /// Special case for \"packGroup\"\n        /// Should let trough all pack types\n        /// Should NOT let trought any non-pack types\n        /// i.e. Strings, Binaries etc\n        if (fileTypeFilter.indexOf(\"packGroup\") >= 0) {\n          if (!fileType.startsWith(\"PF\")) {\n            continue;\n          }\n        } else if (fileTypeFilter.indexOf(\"textureGroup\") >= 0) {\n          if (!fileType.startsWith(\"TEXTURE\")) {\n            continue;\n          }\n        } else {\n          continue;\n        }\n      }\n\n      if (Object.keys(_fileList).includes(fileType)) {\n        let fileArr = _fileList[fileType];\n        fileArr.forEach(\n          function (mftIndex) {\n            let meta = _lr.getFileMeta(mftIndex);\n\n            let baseIds = reverseTable[mftIndex];\n            let fileSize = meta ? meta.size : \"\";\n\n            if (fileSize > 0 && mftIndex > 15) {\n              w2ui[\"grid\"].records.push({\n                recid: mftIndex, /// MFT index\n                baseIds: baseIds,\n                type: fileType,\n                fileSize: fileSize,\n              });\n            }\n\n            mftIndex++;\n          } /// End for each mft in this file type\n        );\n      } /// End if _fileList[filetype]\n    } /// End for each fileType key in _fileList object\n\n    /// Update file grid\n    w2ui.grid.refresh();\n  }\n\n  function viewFileByMFT(mftIdx) {\n    let reverseTable = _lr.getReverseIndex();\n\n    let baseId = reverseTable[mftIdx] ? reverseTable[mftIdx][0] : \"\";\n\n    viewFileByFileId(baseId);\n  }\n\n  function viewFileByFileId(fileId) {\n    /// Clean outputs\n    $(\".tabOutput\").html(\"\");\n    $(\"#fileTitle\").html(\"\");\n\n    /// Clean context toolbar\n    $(\"#contextToolbar\").html(\"\");\n\n    /// Disable tabs\n    w2ui.fileTabs.disable(\"tabRaw\");\n    w2ui.fileTabs.disable(\"tabPF\");\n    w2ui.fileTabs.disable(\"tabTexture\");\n    w2ui.fileTabs.disable(\"tabString\");\n    w2ui.fileTabs.disable(\"tabModel\");\n    w2ui.fileTabs.disable(\"tabSound\");\n\n    /// Remove old models from the scene\n    if (_models) {\n      _models.forEach(function (mdl) {\n        _scene.remove(mdl);\n      });\n    }\n\n    /// Make sure _context is clean\n    _context = {};\n\n    /// Run the basic DataRenderer, handles all sorts of files for us.\n    T3D.runRenderer(\n      T3D.DataRenderer,\n      _lr,\n      { id: fileId },\n      _context,\n      onBasicRendererDone\n    );\n  }\n\n  function onBasicRendererDone() {\n    /// Read render output from _context VO\n    let fileId = (_fileId = T3D.getContextValue(\n      _context,\n      T3D.DataRenderer,\n      \"fileId\"\n    ));\n\n    let rawData = T3D.getContextValue(_context, T3D.DataRenderer, \"rawData\");\n\n    let raw = T3D.getContextValue(_context, T3D.DataRenderer, \"rawString\");\n\n    let packfile = T3D.getContextValue(_context, T3D.DataRenderer, \"file\");\n\n    let image = T3D.getContextValue(_context, T3D.DataRenderer, \"image\");\n\n    let fcc = raw.substring(0, 4);\n\n    /// Update main header to show filename\n\n    let fileName =\n      fileId + (image || !packfile ? \".\" + fcc : \".\" + packfile.header.type);\n    $(\"#fileTitle\").html(fileName);\n\n    /// Update raw view and enable tab\n    w2ui.fileTabs.enable(\"tabRaw\");\n\n    $(\"#contextToolbar\").append(\n      $(\"<button>Download raw</button>\").click(function () {\n        let blob = new Blob([rawData], { type: \"octet/stream\" });\n        saveData(blob, fileName + \".raw\");\n      })\n    );\n\n    $(\"#rawOutput\").append($(\"<div>\").text(raw));\n\n    /// Texture file\n    if (image) {\n      /// Select texture tab\n      w2ui.fileTabs.enable(\"tabTexture\");\n      w2ui.fileTabs.click(\"tabTexture\");\n\n      /// Display bitmap on canvas\n      let canvas = $(\"<canvas>\");\n      canvas[0].width = image.width;\n      canvas[0].height = image.height;\n      let ctx = canvas[0].getContext(\"2d\");\n      let uica = new Uint8ClampedArray(image.data);\n      let imagedata = new ImageData(uica, image.width, image.height);\n      ctx.putImageData(imagedata, 0, 0);\n\n      $(\"#textureOutput\").append(canvas);\n    }\n\n    /// PF Pack file\n    else if (packfile) {\n      /// Always render the pack file chunk data\n      displayPackFile();\n\n      /// Enable corresponding tab\n      w2ui.fileTabs.enable(\"tabPF\");\n\n      /// If the pack file was a model, render it!\n      if (packfile.header.type === \"MODL\") {\n        /// Render model\n        renderFileModel(fileId);\n      } else if (packfile.header.type === \"ASND\") {\n        /// Get a chunk, this is really the job of a renderer but whatevs\n        let chunk = packfile.getChunk(\"ASND\");\n\n        /// Enable and select sound tab\n        w2ui.fileTabs.enable(\"tabSound\");\n        w2ui.fileTabs.click(\"tabSound\");\n\n        /// Print some random data about this sound\n        $(\"#soundOutput\").html(\n          \"Length: \" +\n            chunk.data.length +\n            \" seconds<br/>\" +\n            \"Size: \" +\n            chunk.data.audioData.length +\n            \" bytes\"\n        );\n\n        /// Extract sound data\n\n        let soundUintArray = chunk.data.audioData;\n\n        $(\"#contextToolbar\")\n          .show()\n          .append(\n            $(\"<button>Download MP3</button>\").click(function () {\n              let blob = new Blob([soundUintArray], { type: \"octet/stream\" });\n              saveData(blob, fileName + \".mp3\");\n            })\n          )\n          .append(\n            $(\"<button>Play MP3</button>\").click(function () {\n              if (!_audioContext) {\n                _audioContext = new AudioContext();\n              }\n\n              /// Stop previous sound\n              try {\n                _audioSource.stop();\n              } catch (e) {\n                console.error(e);\n              }\n\n              /// Create new buffer for current sound\n              _audioSource = _audioContext.createBufferSource();\n              _audioSource.connect(_audioContext.destination);\n\n              /// Decode and start playing\n              _audioContext.decodeAudioData(soundUintArray.buffer, function (\n                res\n              ) {\n                _audioSource.buffer = res;\n                _audioSource.start();\n              });\n            })\n          )\n          .append(\n            $(\"<button>Stop MP3</button>\").click(function () {\n              try {\n                _audioSource.stop();\n              } catch (e) {\n                console.error(e);\n              }\n            })\n          );\n      } else {\n        /// Select PF tab\n        w2ui.fileTabs.click(\"tabPF\");\n      }\n    } else if (fcc === \"strs\") {\n      showFileString(fileId);\n    }\n\n    /// Else just show raw view\n    else {\n      w2ui.fileTabs.click(\"tabRaw\");\n    }\n  }\n\n  function displayPackFile() {\n    //let fileId = T3D.getContextValue(_context, T3D.DataRenderer, \"fileId\");\n    let packfile = T3D.getContextValue(_context, T3D.DataRenderer, \"file\");\n\n    $(\"#packOutput\").html(\"\");\n    $(\"#packOutput\").append($(\"<h2>Chunks</h2>\"));\n\n    packfile.chunks.forEach(function (chunk) {\n      let field = $(\"<fieldset />\");\n      let legend = $(\"<legend>\" + chunk.header.type + \"</legend>\");\n\n      let logButton = $(\"<button>Log Chunk Data to Console</button>\");\n      logButton.click(function () {\n        T3D.Logger.log(\n          T3D.Logger.TYPE_MESSAGE,\n          \"Logging\",\n          chunk.header.type,\n          \"chunk\"\n        );\n        T3D.Logger.log(T3D.Logger.TYPE_MESSAGE, chunk.data);\n      });\n\n      field.append(legend);\n      field.append($(\"<p>Size:\" + chunk.header.chunkDataSize + \"</p>\"));\n      field.append(logButton);\n\n      $(\"#packOutput\").append(field);\n      $(\"#packOutput\").show();\n    });\n  }\n\n  function showFileString(fileId) {\n    /// Make sure output is clean\n    _context = {};\n\n    /// Run single renderer\n    T3D.runRenderer(\n      T3D.StringRenderer,\n      _lr,\n      { id: fileId },\n      _context,\n      onRendererDoneString\n    );\n  }\n\n  function onRendererDoneString() {\n    /// Read data from renderer\n    let strings = T3D.getContextValue(\n      _context,\n      T3D.StringRenderer,\n      \"strings\",\n      []\n    );\n\n    w2ui.stringGrid.records = strings;\n\n    w2ui.stringGrid.buffered = w2ui.stringGrid.records.length;\n    w2ui.stringGrid.total = w2ui.stringGrid.buffered;\n    w2ui.stringGrid.refresh();\n\n    /// Select this view\n    w2ui.fileTabs.enable(\"tabString\");\n    w2ui.fileTabs.click(\"tabString\");\n  }\n\n  function renderFileModel(fileId) {\n    /// Make sure output is clean\n    _context = {};\n\n    /// Run single renderer\n    T3D.runRenderer(\n      T3D.SingleModelRenderer,\n      _lr,\n      { id: fileId },\n      _context,\n      onRendererDoneModel\n    );\n  }\n\n  function onRendererDoneModel() {\n    /// Enable and select model tab\n    w2ui.fileTabs.enable(\"tabModel\");\n    w2ui.fileTabs.click(\"tabModel\");\n    $(\"#modelOutput\").show();\n\n    /// Re-fit canvas\n    onCanvasResize();\n\n    /// Add context toolbar export button\n    $(\"#contextToolbar\").append(\n      $(\"<button>Export scene</button>\").click(exportScene)\n    );\n\n    /// Read the new models\n    _models = T3D.getContextValue(\n      _context,\n      T3D.SingleModelRenderer,\n      \"meshes\",\n      []\n    );\n\n    /// Keeping track of the biggest model for later\n    let biggestMdl = null;\n\n    /// Add all models to the scene\n    _models.forEach(function (model) {\n      /// Find the biggest model for camera focus/fitting\n      if (\n        !biggestMdl ||\n        biggestMdl.boundingSphere.radius < model.boundingSphere.radius\n      ) {\n        biggestMdl = model;\n      }\n\n      _scene.add(model);\n    });\n\n    /// Reset any zoom and transaltion/rotation done when viewing earlier models.\n    _controls.reset();\n\n    /// Focus camera to the bigest model, doesn't work great.\n    let dist =\n      biggestMdl && biggestMdl.boundingSphere\n        ? biggestMdl.boundingSphere.radius / Math.tan((Math.PI * 60) / 360)\n        : 100;\n    dist = 1.2 * Math.max(100, dist);\n    dist = Math.min(1000, dist);\n    _camera.position.zoom = 1;\n    _camera.position.x = dist * Math.sqrt(2);\n    _camera.position.y = 50;\n    _camera.position.z = 0;\n\n    if (biggestMdl) _camera.lookAt(biggestMdl.position);\n  }\n\n  /// Exports current model as an .obj file with a .mtl refering .png textures.\n  function exportScene() {\n    /// Get last loaded fileId\n    let fileId = _fileId;\n\n    /// Run T3D hacked version of OBJExporter\n    let result = new THREE.OBJExporter().parse(_scene, fileId);\n\n    /// Result lists what file ids are used for textures.\n    let texIds = result.textureIds;\n\n    /// Set up very basic material file refering the texture pngs\n    /// pngs are generated a few lines down.\n    let mtlSource = \"\";\n    texIds.forEach(function (texId) {\n      mtlSource +=\n        \"newmtl tex_\" +\n        texId +\n        \"\\n\" +\n        \"  map_Ka tex_\" +\n        texId +\n        \".png\\n\" +\n        \"  map_Kd tex_\" +\n        texId +\n        \".png\\n\\n\";\n    });\n\n    /// Download obj\n    let blob = new Blob([result.obj], { type: \"octet/stream\" });\n    saveData(blob, \"export.\" + fileId + \".obj\");\n\n    /// Download mtl\n    blob = new Blob([mtlSource], { type: \"octet/stream\" });\n    saveData(blob, \"export.\" + fileId + \".mtl\");\n\n    /// Download texture pngs\n    texIds.forEach(function (texId) {\n      /// LocalReader will have to re-load the textures, don't want to fetch\n      /// then from the model data..\n      _lr.loadTextureFile(texId, function (\n        inflatedData,\n        dxtType,\n        imageWidth,\n        imageHeigth\n      ) {\n        /// Create js image using returned bitmap data.\n        let image = {\n          data: new Uint8Array(inflatedData),\n          width: imageWidth,\n          height: imageHeigth,\n        };\n\n        /// Need a canvas in order to draw\n        let canvas = $(\"<canvas />\");\n        $(\"body\").append(canvas);\n\n        canvas[0].width = image.width;\n        canvas[0].height = image.height;\n\n        let ctx = canvas[0].getContext(\"2d\");\n\n        /// Draw raw bitmap to canvas\n        let uica = new Uint8ClampedArray(image.data);\n        let imagedata = new ImageData(uica, image.width, image.height);\n        ctx.putImageData(imagedata, 0, 0);\n\n        /// This is where shit gets stupid. Flipping raw bitmaps in js\n        /// is apparently a pain. Basicly read current state pixel by pixel\n        /// and write it back with flipped y-axis\n        let input = ctx.getImageData(0, 0, image.width, image.height);\n\n        /// Create output image data buffer\n        let output = ctx.createImageData(image.width, image.height);\n\n        /// Get imagedata size\n        let w = input.width,\n          h = input.height;\n        let inputData = input.data;\n        let outputData = output.data;\n\n        /// Loop pixels\n        for (let y = 1; y < h - 1; y += 1) {\n          for (let x = 1; x < w - 1; x += 1) {\n            /// Input linear coordinate\n            let i = (y * w + x) * 4;\n\n            /// Output linear coordinate\n            let flip = ((h - y) * w + x) * 4;\n\n            /// Read and write RGBA\n            /// TODO: Perhaps put alpha to 100%\n            for (let c = 0; c < 4; c += 1) {\n              outputData[i + c] = inputData[flip + c];\n            }\n          }\n        }\n\n        /// Write back flipped data\n        ctx.putImageData(output, 0, 0);\n\n        /// Fetch canvas data as png and download.\n        canvas[0].toBlob(function (pngBlob) {\n          saveData(pngBlob, \"tex_\" + texId + \".png\");\n        });\n\n        /// Remove canvas from DOM\n        canvas.remove();\n      });\n    });\n  }\n\n  /// Utility for downloading files to client\n  let saveData = (function () {\n    let a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style = \"display: none\";\n    return function (blob, fileName) {\n      let url = window.URL.createObjectURL(blob);\n      a.href = url;\n      a.download = fileName;\n      a.click();\n      window.URL.revokeObjectURL(url);\n    };\n  })();\n\n  /// Setting up a scene, Tree.js standard stuff...\n  function setupScene() {\n    let canvasWidth = $(\"#modelOutput\").width();\n    let canvasHeight = $(\"#modelOutput\").height();\n    let canvasClearColor = 0x342920; // For happy rendering, always use Van Dyke Brown.\n    let fov = 60;\n    let aspect = 1;\n    let near = 0.1;\n    let far = 500000;\n\n    _camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n\n    _scene = new THREE.Scene();\n\n    /// This scene has one ambient light source and three directional lights\n    let ambientLight = new THREE.AmbientLight(0x555555);\n    _scene.add(ambientLight);\n\n    let directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight1.position.set(0, 0, 1);\n    _scene.add(directionalLight1);\n\n    let directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight2.position.set(1, 0, 0);\n    _scene.add(directionalLight2);\n\n    let directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.8);\n    directionalLight3.position.set(0, 1, 0);\n    _scene.add(directionalLight3);\n\n    /// Standard THREE renderer with AA\n    _renderer = new THREE.WebGLRenderer({ antialiasing: true });\n    $(\"#modelOutput\")[0].appendChild(_renderer.domElement);\n\n    _renderer.setSize(canvasWidth, canvasHeight);\n    _renderer.setClearColor(canvasClearColor);\n\n    /// Add THREE orbit controls, for simple orbiting, panning and zooming\n    _controls = new THREE.OrbitControls(_camera, _renderer.domElement);\n    _controls.enableZoom = true;\n\n    /// Sems w2ui delays resizing :/\n    $(window).resize(function () {\n      setTimeout(onCanvasResize, 10);\n    });\n\n    /// Note: constant continous rendering from page load event, not very opt.\n    render();\n  }\n\n  function onCanvasResize() {\n    let sceneWidth = $(\"#modelOutput\").width();\n    let sceneHeight = $(\"#modelOutput\").height();\n\n    if (!sceneHeight || !sceneWidth) return;\n\n    _camera.aspect = sceneWidth / sceneHeight;\n\n    _renderer.setSize(sceneWidth, sceneHeight);\n\n    _camera.updateProjectionMatrix();\n  }\n\n  /// Render loop, no game logic, just rendering.\n  function render() {\n    window.requestAnimationFrame(render);\n    _renderer.render(_scene, _camera);\n  }\n};\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvVHlyaWEyRC9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gIC8vLyBUM0RcbiAgbGV0IF9scjtcbiAgbGV0IF9jb250ZXh0O1xuICBsZXQgX2ZpbGVJZDtcbiAgbGV0IF9maWxlTGlzdDtcbiAgbGV0IF9hdWRpb1NvdXJjZTtcbiAgbGV0IF9hdWRpb0NvbnRleHQ7XG5cbiAgLy8vIFRIUkVFXG4gIGxldCBfc2NlbmU7XG4gIGxldCBfY2FtZXJhO1xuICBsZXQgX3JlbmRlcmVyO1xuICBsZXQgX21vZGVscyA9IFtdO1xuICBsZXQgX2NvbnRyb2xzO1xuXG4gICQoZnVuY3Rpb24gKCkge1xuICAgIC8qXG4gICAgICAgIFNFVCBNQUlOIFVQIEdSSURcbiAgICAgICAgKi9cbiAgICBsZXQgcHN0eWxlID0gXCJib3JkZXI6IDFweCBzb2xpZCAjZGZkZmRmOyBwYWRkaW5nOiAwO1wiO1xuICAgICQoXCIjbGF5b3V0XCIpLncybGF5b3V0KHtcbiAgICAgIG5hbWU6IFwibGF5b3V0XCIsXG4gICAgICBwYW5lbHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwibGVmdFwiLFxuICAgICAgICAgIHNpemU6IDU3MCxcbiAgICAgICAgICByZXNpemFibGU6IHRydWUsXG4gICAgICAgICAgc3R5bGU6IHBzdHlsZSArIFwibWFyZ2luOjBcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwibWFpblwiLFxuICAgICAgICAgIHN0eWxlOiBwc3R5bGUgKyBcIiBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDtcIixcbiAgICAgICAgICB0b29sYmFyOiB7XG4gICAgICAgICAgICBzdHlsZTogXCJiYWNrZ3JvdW5kLWNvbG9yOiNlYWVhZWE7IGhlaWdodDo0MHB4XCIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJodG1sXCIsXG4gICAgICAgICAgICAgICAgaWQ6IFwiZmlsZUlkVG9vbGJhclwiLFxuICAgICAgICAgICAgICAgIGh0bWw6XG4gICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInRvb2xiYXJFbnRyeVwiPicgK1xuICAgICAgICAgICAgICAgICAgXCIgRmlsZSBJRDpcIiArXG4gICAgICAgICAgICAgICAgICAnICAgIDxpbnB1dCBpZD1cImZpbGVJZElucHV0XCIvPicgK1xuICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIGlkPVwiZmlsZUlkSW5wdXRCdG5cIj4nICtcbiAgICAgICAgICAgICAgICAgIFwiICAgIExvYWQgPC9idXR0b24+XCIgK1xuICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwiaHRtbFwiLFxuICAgICAgICAgICAgICAgIGlkOiBcImNvbnRleHRUb29sYmFyXCIsXG4gICAgICAgICAgICAgICAgaHRtbDogJzxkaXYgY2xhc3M9XCJ0b29sYmFyRW50cnlcIiBpZD1cImNvbnRleHRUb29sYmFyXCI+PC9kaXY+JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgdGhpcy5vd25lci5jb250ZW50KFwibWFpblwiLCBldmVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgb25SZXNpemU6IG9uQ2FudmFzUmVzaXplLFxuICAgIH0pO1xuXG4gICAgJChcIiNmaWxlSWRJbnB1dEJ0blwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICB2aWV3RmlsZUJ5RmlsZUlkKCQoXCIjZmlsZUlkSW5wdXRcIikudmFsKCkpO1xuICAgIH0pO1xuXG4gICAgLy8vIEdyaWQgaW5zaWRlIG1haW4gbGVmdFxuICAgICQoKS53MmxheW91dCh7XG4gICAgICBuYW1lOiBcImxlZnRMYXlvdXRcIixcbiAgICAgIHBhbmVsczogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJsZWZ0XCIsXG4gICAgICAgICAgc2l6ZTogMTUwLFxuICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICBzdHlsZTogcHN0eWxlLFxuICAgICAgICAgIGNvbnRlbnQ6IFwibGVmdFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJtYWluXCIsXG4gICAgICAgICAgc2l6ZTogNDIwLFxuICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICBzdHlsZTogcHN0eWxlLFxuICAgICAgICAgIGNvbnRlbnQ6IFwicmlnaHRcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gICAgdzJ1aVtcImxheW91dFwiXS5jb250ZW50KFwibGVmdFwiLCB3MnVpW1wibGVmdExheW91dFwiXSk7XG5cbiAgICAvKlxuICAgICAgICAgICAgU0lERUJBUlxuICAgICAgICAgICAgKi9cbiAgICB3MnVpW1wibGVmdExheW91dFwiXS5jb250ZW50KFxuICAgICAgXCJsZWZ0XCIsXG4gICAgICAkKCkudzJzaWRlYmFyKHtcbiAgICAgICAgbmFtZTogXCJzaWRlYmFyXCIsXG4gICAgICAgIGltZzogbnVsbCxcbiAgICAgICAgbm9kZXM6IFt7IGlkOiBcIkFsbFwiLCB0ZXh0OiBcIkFsbFwiLCBpbWc6IFwiaWNvbi1mb2xkZXJcIiwgZ3JvdXA6IGZhbHNlIH1dLFxuICAgICAgICBvbkNsaWNrOiBvbkZpbHRlckNsaWNrLFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLypcbiAgICAgICAgICAgIFNFVCBVUCBGSUxFIEJST1dTRVJcbiAgICAgICAgICAgICovXG4gICAgdzJ1aVtcImxlZnRMYXlvdXRcIl0uY29udGVudChcbiAgICAgIFwibWFpblwiLFxuICAgICAgJCgpLncyZ3JpZCh7XG4gICAgICAgIG5hbWU6IFwiZ3JpZFwiLFxuICAgICAgICBzaG93OiB7XG4gICAgICAgICAgdG9vbGJhcjogdHJ1ZSxcbiAgICAgICAgICBmb290ZXI6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbHVtbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJyZWNpZFwiLFxuICAgICAgICAgICAgY2FwdGlvbjogXCJNRlQgaW5kZXhcIixcbiAgICAgICAgICAgIHNpemU6IFwiODBweFwiLFxuICAgICAgICAgICAgc29ydGFibGU6IHRydWUsXG4gICAgICAgICAgICByZXNpemFibGU6IHRydWUsXG4gICAgICAgICAgICBzZWFyY2hhYmxlOiBcImludFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiYmFzZUlkc1wiLFxuICAgICAgICAgICAgY2FwdGlvbjogXCJCYXNlSWQgbGlzdFwiLFxuICAgICAgICAgICAgc2l6ZTogXCIxMDAlXCIsXG4gICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNlYXJjaGFibGU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogXCJ0eXBlXCIsXG4gICAgICAgICAgICBjYXB0aW9uOiBcIlR5cGVcIixcbiAgICAgICAgICAgIHNpemU6IFwiMTAwcHhcIixcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6IFwiZmlsZVNpemVcIixcbiAgICAgICAgICAgIGNhcHRpb246IFwiUGFjayBTaXplXCIsXG4gICAgICAgICAgICBzaXplOiBcIjg1cHhcIixcbiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHNvcnRhYmxlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHZpZXdGaWxlQnlNRlQoZXZlbnQucmVjaWQpO1xuICAgICAgICB9LFxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLypcbiAgICAgICAgICAgIFNFVCBVUCBGSUxFIFZJRVcgJ1dJTkRPVydcbiAgICAgICAgICAgICovXG4gICAgJCh3MnVpW1wibGF5b3V0XCJdLmVsKFwibWFpblwiKSlcbiAgICAgIC5hcHBlbmQoJChcIjxoMSBpZD0nZmlsZVRpdGxlJyAvPlwiKSlcbiAgICAgIC5hcHBlbmQoJChcIjxkaXYgaWQ9J2ZpbGVUYWJzJyAvPlwiKSlcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXG4gICAgICAgICAgXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNSYXcnPlwiICtcbiAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0ndGFiT3V0cHV0JyBpZD0ncmF3T3V0cHV0JyAvPlwiICtcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcbiAgICAgICAgKVxuICAgICAgKVxuICAgICAgLmFwcGVuZChcbiAgICAgICAgJChcbiAgICAgICAgICBcIjxkaXYgY2xhc3M9J2ZpbGVUYWInIGlkPSdmaWxlVGFic1BhY2snPlwiICtcbiAgICAgICAgICAgIFwiPGRpdiBjbGFzcz0ndGFiT3V0cHV0JyBpZD0ncGFja091dHB1dCcgLz5cIiArXG4gICAgICAgICAgICBcIjwvZGl2PlwiXG4gICAgICAgICkuaGlkZSgpXG4gICAgICApXG4gICAgICAuYXBwZW5kKFxuICAgICAgICAkKFxuICAgICAgICAgIFwiPGRpdiBjbGFzcz0nZmlsZVRhYicgaWQ9J2ZpbGVUYWJzVGV4dHVyZSc+XCIgK1xuICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPSd0YWJPdXRwdXQnIGlkPSd0ZXh0dXJlT3V0cHV0JyAvPlwiICtcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcbiAgICAgICAgKS5oaWRlKClcbiAgICAgIClcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXG4gICAgICAgICAgXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNTdHJpbmcnPlwiICtcbiAgICAgICAgICAgIFwiPGRpdiBpZD0nc3RyaW5nT3V0cHV0JyAvPlwiICtcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcbiAgICAgICAgKS5oaWRlKClcbiAgICAgIClcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXG4gICAgICAgICAgXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNNb2RlbCc+XCIgK1xuICAgICAgICAgICAgXCI8ZGl2IGlkPSdtb2RlbE91dHB1dCcvPlwiICtcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcbiAgICAgICAgKS5oaWRlKClcbiAgICAgIClcbiAgICAgIC5hcHBlbmQoXG4gICAgICAgICQoXG4gICAgICAgICAgXCI8ZGl2IGNsYXNzPSdmaWxlVGFiJyBpZD0nZmlsZVRhYnNTb3VuZCc+XCIgK1xuICAgICAgICAgICAgXCI8ZGl2IGNsYXNzPSd0YWJPdXRwdXQnIGlkPSdzb3VuZE91dHB1dCcvPlwiICtcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcbiAgICAgICAgKS5oaWRlKClcbiAgICAgICk7XG5cbiAgICAkKFwiI2ZpbGVUYWJzXCIpLncydGFicyh7XG4gICAgICBuYW1lOiBcImZpbGVUYWJzXCIsXG4gICAgICBhY3RpdmU6IFwidGFiUmF3XCIsXG4gICAgICB0YWJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJ0YWJSYXdcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlJhd1wiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzUmF3XCIpLnNob3coKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwidGFiUEZcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlBhY2sgRmlsZVwiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzUGFja1wiKS5zaG93KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBcInRhYlRleHR1cmVcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlRleHR1cmVcIixcbiAgICAgICAgICBkaXNhYmxlZDogdHJ1ZSxcbiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKFwiLmZpbGVUYWJcIikuaGlkZSgpO1xuICAgICAgICAgICAgJChcIiNmaWxlVGFic1RleHR1cmVcIikuc2hvdygpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJ0YWJTdHJpbmdcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIlN0cmluZ1wiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzU3RyaW5nXCIpLnNob3coKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwidGFiTW9kZWxcIixcbiAgICAgICAgICBjYXB0aW9uOiBcIk1vZGVsXCIsXG4gICAgICAgICAgZGlzYWJsZWQ6IHRydWUsXG4gICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJChcIi5maWxlVGFiXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICQoXCIjZmlsZVRhYnNNb2RlbFwiKS5zaG93KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBcInRhYlNvdW5kXCIsXG4gICAgICAgICAgY2FwdGlvbjogXCJTb3VuZFwiLFxuICAgICAgICAgIGRpc2FibGVkOiB0cnVlLFxuICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoXCIuZmlsZVRhYlwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI2ZpbGVUYWJzU291bmRcIikuc2hvdygpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8vIFNldCB1cCBncmlkIGZvciBzdHJpbmdzIHZpZXdcbiAgICAvLy9DcmVhdGUgZ3JpZFxuICAgICQoXCIjc3RyaW5nT3V0cHV0XCIpLncyZ3JpZCh7XG4gICAgICBuYW1lOiBcInN0cmluZ0dyaWRcIixcbiAgICAgIHNlbGVjdFR5cGU6IFwiY2VsbFwiLFxuICAgICAgc2hvdzoge1xuICAgICAgICB0b29sYmFyOiB0cnVlLFxuICAgICAgICBmb290ZXI6IHRydWUsXG4gICAgICB9LFxuICAgICAgY29sdW1uczogW1xuICAgICAgICB7IGZpZWxkOiBcInJlY2lkXCIsIGNhcHRpb246IFwiUm93ICNcIiwgc2l6ZTogXCI2MHB4XCIgfSxcbiAgICAgICAgeyBmaWVsZDogXCJ2YWx1ZVwiLCBjYXB0aW9uOiBcIlRleHRcIiwgc2l6ZTogXCIxMDAlXCIgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvKlxuICAgICAgICAgICAgU0VUIFVQIFRSRUUgM0QgU0NFTkVcbiAgICAgICAgKi9cbiAgICBzZXR1cFNjZW5lKCk7XG5cbiAgICAvLy8gQXNrIGZvciBmaWxlXG4gICAgdzJwb3B1cC5vcGVuKHtcbiAgICAgIHNwZWVkOiAwLFxuICAgICAgdGl0bGU6IFwiTG9hZCBBIEdXMiBkYXRcIixcbiAgICAgIG1vZGFsOiB0cnVlLFxuICAgICAgc2hvd0Nsb3NlOiBmYWxzZSxcbiAgICAgIGJvZHk6XG4gICAgICAgICc8ZGl2IGNsYXNzPVwidzJ1aS1jZW50ZXJlZFwiPicgK1xuICAgICAgICAnPGRpdiBpZD1cImZpbGVMb2FkUHJvZ3Jlc3NcIiAvPicgK1xuICAgICAgICAnPGlucHV0IGlkPVwiZmlsZVBpY2tlclBvcFwiIHR5cGU9XCJmaWxlXCIgLz4nICtcbiAgICAgICAgXCI8L2Rpdj5cIixcbiAgICB9KTtcblxuICAgICQoXCIjZmlsZVBpY2tlclBvcFwiKS5jaGFuZ2UoZnVuY3Rpb24gKGV2dCkge1xuICAgICAgX2xyID0gVDNELmdldExvY2FsUmVhZGVyKFxuICAgICAgICBldnQudGFyZ2V0LmZpbGVzWzBdLFxuICAgICAgICBvblJlYWRlckNyZWF0ZWQsXG4gICAgICAgIFwiLi4vc3RhdGljL3QzZHdvcmtlci5qc1wiXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8vIE92ZXJ3cml0ZSBwcm9ncmVzcyBsb2dnZXJcbiAgICBUM0QuTG9nZ2VyLmxvZ0Z1bmN0aW9uc1tUM0QuTG9nZ2VyLlRZUEVfUFJPR1JFU1NdID0gZnVuY3Rpb24gKCkge1xuICAgICAgJChcIiNmaWxlUGlja2VyUG9wXCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICQoXCIjZmlsZUxvYWRQcm9ncmVzc1wiKS5odG1sKFxuICAgICAgICBcIkluZGV4aW5nIC5kYXQgZmlsZSAoZmlyc3QgdmlzaXQgb25seSk8YnIvPlwiICtcbiAgICAgICAgICBhcmd1bWVudHNbMV0gK1xuICAgICAgICAgIFwiJTxici8+PGJyLz5cIlxuICAgICAgKTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBvblJlYWRlckNyZWF0ZWQoKSB7XG4gICAgVDNELmdldEZpbGVMaXN0QXN5bmMoXG4gICAgICBfbHIsXG4gICAgICBmdW5jdGlvbiAoZmlsZXMpIHtcbiAgICAgICAgLy8vIFN0b3JlIGZpbGVMaXN0IGdsb2JhbGx5XG4gICAgICAgIF9maWxlTGlzdCA9IGZpbGVzO1xuXG4gICAgICAgIGxldCBwYWNrTm9kZSA9IHtcbiAgICAgICAgICBpZDogXCJwYWNrR3JvdXBcIixcbiAgICAgICAgICB0ZXh0OiBcIlBhY2sgRmlsZXNcIixcbiAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCB0ZXh0dXJlTm9kZSA9IHtcbiAgICAgICAgICBpZDogXCJ0ZXh0dXJlR3JvdXBcIixcbiAgICAgICAgICB0ZXh0OiBcIlRleHR1cmUgZmlsZXNcIixcbiAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCB1bnNvcnRlZE5vZGUgPSB7XG4gICAgICAgICAgaWQ6IFwidW5zb3J0ZWRHcm91cFwiLFxuICAgICAgICAgIHRleHQ6IFwiVW5zb3J0ZWRcIixcbiAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgbm9kZXM6IFtdLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vLyBCdWlsZCBzaWRlYmFyIG5vZGVzXG4gICAgICAgIGZvciAobGV0IGZpbGVUeXBlIGluIF9maWxlTGlzdCkge1xuICAgICAgICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhfZmlsZUxpc3QpLmluY2x1ZGVzKGZpbGVUeXBlKSkge1xuICAgICAgICAgICAgbGV0IG5vZGUgPSB7IGlkOiBmaWxlVHlwZSwgaW1nOiBcImljb24tZm9sZGVyXCIsIGdyb3VwOiBmYWxzZSB9O1xuICAgICAgICAgICAgLy9sZXQgaXNQYWNrID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoZmlsZVR5cGUuc3RhcnRzV2l0aChcIlRFWFRVUkVcIikpIHtcbiAgICAgICAgICAgICAgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgICAgaW1nOiBcImljb24tZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgZ3JvdXA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICB0ZXh0dXJlTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZSA9PT0gXCJCSU5BUklFU1wiKSB7XG4gICAgICAgICAgICAgIG5vZGUudGV4dCA9IFwiQmluYXJpZXNcIjtcbiAgICAgICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZChub2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZVR5cGUgPT09IFwiU1RSSU5HU1wiKSB7XG4gICAgICAgICAgICAgIG5vZGUudGV4dCA9IFwiU3RyaW5nc1wiO1xuICAgICAgICAgICAgICB3MnVpLnNpZGViYXIuYWRkKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZS5zdGFydHNXaXRoKFwiUEZcIikpIHtcbiAgICAgICAgICAgICAgbm9kZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgICAgaW1nOiBcImljb24tZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgZ3JvdXA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBwYWNrTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZSA9PT0gXCJVTktOT1dOXCIpIHtcbiAgICAgICAgICAgICAgbm9kZS50ZXh0ID0gXCJVbmtub3duXCI7XG4gICAgICAgICAgICAgIHcydWkuc2lkZWJhci5hZGQobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBub2RlID0ge1xuICAgICAgICAgICAgICAgIGlkOiBmaWxlVHlwZSxcbiAgICAgICAgICAgICAgICBpbWc6IFwiaWNvbi1mb2xkZXJcIixcbiAgICAgICAgICAgICAgICBncm91cDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdGV4dDogZmlsZVR5cGUsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHVuc29ydGVkTm9kZS5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWNrTm9kZS5ub2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZChwYWNrTm9kZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGV4dHVyZU5vZGUubm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHcydWkuc2lkZWJhci5hZGQodGV4dHVyZU5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVuc29ydGVkTm9kZS5ub2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdzJ1aS5zaWRlYmFyLmFkZCh1bnNvcnRlZE5vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8vIENsb3NlIHRoZSBwb3BcbiAgICAgICAgdzJwb3B1cC5jbG9zZSgpO1xuXG4gICAgICAgIC8vLyBTZWxlY3QgdGhlIFwiQWxsXCIgY2F0ZWdvcnlcbiAgICAgICAgdzJ1aS5zaWRlYmFyLmNsaWNrKFwiQWxsXCIpO1xuICAgICAgfSAvLy8gRW5kIHJlYWRGaWxlTGlzdEFzeW5jIGNhbGxiYWNrXG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uRmlsdGVyQ2xpY2soZXZ0KSB7XG4gICAgLy8vIE5vIGZpbHRlciBpZiBjbGlja2VkIGdyb3VwIHdhcyBcIkFsbFwiXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IFwiQWxsXCIpIHtcbiAgICAgIHNob3dGaWxlR3JvdXAoKTtcbiAgICB9XG5cbiAgICAvLy8gT3RoZXIgZXZlbnRzIGFyZSBmaW5lIHRvIGp1c3QgcGFzc1xuICAgIGVsc2Uge1xuICAgICAgc2hvd0ZpbGVHcm91cChbZXZ0LnRhcmdldF0pO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3dGaWxlR3JvdXAoZmlsZVR5cGVGaWx0ZXIpIHtcbiAgICB3MnVpLmdyaWQucmVjb3JkcyA9IFtdO1xuXG4gICAgbGV0IHJldmVyc2VUYWJsZSA9IF9sci5nZXRSZXZlcnNlSW5kZXgoKTtcblxuICAgIGZvciAoY29uc3QgZmlsZVR5cGUgaW4gX2ZpbGVMaXN0KSB7XG4gICAgICAvLy8gT25seSBzaG93IHR5cGVzIHdlJ3ZlIGFza2VkIGZvclxuICAgICAgaWYgKGZpbGVUeXBlRmlsdGVyICYmIGZpbGVUeXBlRmlsdGVyLmluZGV4T2YoZmlsZVR5cGUpIDwgMCkge1xuICAgICAgICAvLy8gU3BlY2lhbCBjYXNlIGZvciBcInBhY2tHcm91cFwiXG4gICAgICAgIC8vLyBTaG91bGQgbGV0IHRyb3VnaCBhbGwgcGFjayB0eXBlc1xuICAgICAgICAvLy8gU2hvdWxkIE5PVCBsZXQgdHJvdWdodCBhbnkgbm9uLXBhY2sgdHlwZXNcbiAgICAgICAgLy8vIGkuZS4gU3RyaW5ncywgQmluYXJpZXMgZXRjXG4gICAgICAgIGlmIChmaWxlVHlwZUZpbHRlci5pbmRleE9mKFwicGFja0dyb3VwXCIpID49IDApIHtcbiAgICAgICAgICBpZiAoIWZpbGVUeXBlLnN0YXJ0c1dpdGgoXCJQRlwiKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZpbGVUeXBlRmlsdGVyLmluZGV4T2YoXCJ0ZXh0dXJlR3JvdXBcIikgPj0gMCkge1xuICAgICAgICAgIGlmICghZmlsZVR5cGUuc3RhcnRzV2l0aChcIlRFWFRVUkVcIikpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoT2JqZWN0LmtleXMoX2ZpbGVMaXN0KS5pbmNsdWRlcyhmaWxlVHlwZSkpIHtcbiAgICAgICAgbGV0IGZpbGVBcnIgPSBfZmlsZUxpc3RbZmlsZVR5cGVdO1xuICAgICAgICBmaWxlQXJyLmZvckVhY2goXG4gICAgICAgICAgZnVuY3Rpb24gKG1mdEluZGV4KSB7XG4gICAgICAgICAgICBsZXQgbWV0YSA9IF9sci5nZXRGaWxlTWV0YShtZnRJbmRleCk7XG5cbiAgICAgICAgICAgIGxldCBiYXNlSWRzID0gcmV2ZXJzZVRhYmxlW21mdEluZGV4XTtcbiAgICAgICAgICAgIGxldCBmaWxlU2l6ZSA9IG1ldGEgPyBtZXRhLnNpemUgOiBcIlwiO1xuXG4gICAgICAgICAgICBpZiAoZmlsZVNpemUgPiAwICYmIG1mdEluZGV4ID4gMTUpIHtcbiAgICAgICAgICAgICAgdzJ1aVtcImdyaWRcIl0ucmVjb3Jkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICByZWNpZDogbWZ0SW5kZXgsIC8vLyBNRlQgaW5kZXhcbiAgICAgICAgICAgICAgICBiYXNlSWRzOiBiYXNlSWRzLFxuICAgICAgICAgICAgICAgIHR5cGU6IGZpbGVUeXBlLFxuICAgICAgICAgICAgICAgIGZpbGVTaXplOiBmaWxlU2l6ZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1mdEluZGV4Kys7XG4gICAgICAgICAgfSAvLy8gRW5kIGZvciBlYWNoIG1mdCBpbiB0aGlzIGZpbGUgdHlwZVxuICAgICAgICApO1xuICAgICAgfSAvLy8gRW5kIGlmIF9maWxlTGlzdFtmaWxldHlwZV1cbiAgICB9IC8vLyBFbmQgZm9yIGVhY2ggZmlsZVR5cGUga2V5IGluIF9maWxlTGlzdCBvYmplY3RcblxuICAgIC8vLyBVcGRhdGUgZmlsZSBncmlkXG4gICAgdzJ1aS5ncmlkLnJlZnJlc2goKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZXdGaWxlQnlNRlQobWZ0SWR4KSB7XG4gICAgbGV0IHJldmVyc2VUYWJsZSA9IF9sci5nZXRSZXZlcnNlSW5kZXgoKTtcblxuICAgIGxldCBiYXNlSWQgPSByZXZlcnNlVGFibGVbbWZ0SWR4XSA/IHJldmVyc2VUYWJsZVttZnRJZHhdWzBdIDogXCJcIjtcblxuICAgIHZpZXdGaWxlQnlGaWxlSWQoYmFzZUlkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZXdGaWxlQnlGaWxlSWQoZmlsZUlkKSB7XG4gICAgLy8vIENsZWFuIG91dHB1dHNcbiAgICAkKFwiLnRhYk91dHB1dFwiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjZmlsZVRpdGxlXCIpLmh0bWwoXCJcIik7XG5cbiAgICAvLy8gQ2xlYW4gY29udGV4dCB0b29sYmFyXG4gICAgJChcIiNjb250ZXh0VG9vbGJhclwiKS5odG1sKFwiXCIpO1xuXG4gICAgLy8vIERpc2FibGUgdGFic1xuICAgIHcydWkuZmlsZVRhYnMuZGlzYWJsZShcInRhYlJhd1wiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJQRlwiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJUZXh0dXJlXCIpO1xuICAgIHcydWkuZmlsZVRhYnMuZGlzYWJsZShcInRhYlN0cmluZ1wiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJNb2RlbFwiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmRpc2FibGUoXCJ0YWJTb3VuZFwiKTtcblxuICAgIC8vLyBSZW1vdmUgb2xkIG1vZGVscyBmcm9tIHRoZSBzY2VuZVxuICAgIGlmIChfbW9kZWxzKSB7XG4gICAgICBfbW9kZWxzLmZvckVhY2goZnVuY3Rpb24gKG1kbCkge1xuICAgICAgICBfc2NlbmUucmVtb3ZlKG1kbCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLy8gTWFrZSBzdXJlIF9jb250ZXh0IGlzIGNsZWFuXG4gICAgX2NvbnRleHQgPSB7fTtcblxuICAgIC8vLyBSdW4gdGhlIGJhc2ljIERhdGFSZW5kZXJlciwgaGFuZGxlcyBhbGwgc29ydHMgb2YgZmlsZXMgZm9yIHVzLlxuICAgIFQzRC5ydW5SZW5kZXJlcihcbiAgICAgIFQzRC5EYXRhUmVuZGVyZXIsXG4gICAgICBfbHIsXG4gICAgICB7IGlkOiBmaWxlSWQgfSxcbiAgICAgIF9jb250ZXh0LFxuICAgICAgb25CYXNpY1JlbmRlcmVyRG9uZVxuICAgICk7XG4gIH1cblxuICBmdW5jdGlvbiBvbkJhc2ljUmVuZGVyZXJEb25lKCkge1xuICAgIC8vLyBSZWFkIHJlbmRlciBvdXRwdXQgZnJvbSBfY29udGV4dCBWT1xuICAgIGxldCBmaWxlSWQgPSAoX2ZpbGVJZCA9IFQzRC5nZXRDb250ZXh0VmFsdWUoXG4gICAgICBfY29udGV4dCxcbiAgICAgIFQzRC5EYXRhUmVuZGVyZXIsXG4gICAgICBcImZpbGVJZFwiXG4gICAgKSk7XG5cbiAgICBsZXQgcmF3RGF0YSA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwicmF3RGF0YVwiKTtcblxuICAgIGxldCByYXcgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKF9jb250ZXh0LCBUM0QuRGF0YVJlbmRlcmVyLCBcInJhd1N0cmluZ1wiKTtcblxuICAgIGxldCBwYWNrZmlsZSA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiZmlsZVwiKTtcblxuICAgIGxldCBpbWFnZSA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiaW1hZ2VcIik7XG5cbiAgICBsZXQgZmNjID0gcmF3LnN1YnN0cmluZygwLCA0KTtcblxuICAgIC8vLyBVcGRhdGUgbWFpbiBoZWFkZXIgdG8gc2hvdyBmaWxlbmFtZVxuXG4gICAgbGV0IGZpbGVOYW1lID1cbiAgICAgIGZpbGVJZCArIChpbWFnZSB8fCAhcGFja2ZpbGUgPyBcIi5cIiArIGZjYyA6IFwiLlwiICsgcGFja2ZpbGUuaGVhZGVyLnR5cGUpO1xuICAgICQoXCIjZmlsZVRpdGxlXCIpLmh0bWwoZmlsZU5hbWUpO1xuXG4gICAgLy8vIFVwZGF0ZSByYXcgdmlldyBhbmQgZW5hYmxlIHRhYlxuICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiUmF3XCIpO1xuXG4gICAgJChcIiNjb250ZXh0VG9vbGJhclwiKS5hcHBlbmQoXG4gICAgICAkKFwiPGJ1dHRvbj5Eb3dubG9hZCByYXc8L2J1dHRvbj5cIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgYmxvYiA9IG5ldyBCbG9iKFtyYXdEYXRhXSwgeyB0eXBlOiBcIm9jdGV0L3N0cmVhbVwiIH0pO1xuICAgICAgICBzYXZlRGF0YShibG9iLCBmaWxlTmFtZSArIFwiLnJhd1wiKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgICQoXCIjcmF3T3V0cHV0XCIpLmFwcGVuZCgkKFwiPGRpdj5cIikudGV4dChyYXcpKTtcblxuICAgIC8vLyBUZXh0dXJlIGZpbGVcbiAgICBpZiAoaW1hZ2UpIHtcbiAgICAgIC8vLyBTZWxlY3QgdGV4dHVyZSB0YWJcbiAgICAgIHcydWkuZmlsZVRhYnMuZW5hYmxlKFwidGFiVGV4dHVyZVwiKTtcbiAgICAgIHcydWkuZmlsZVRhYnMuY2xpY2soXCJ0YWJUZXh0dXJlXCIpO1xuXG4gICAgICAvLy8gRGlzcGxheSBiaXRtYXAgb24gY2FudmFzXG4gICAgICBsZXQgY2FudmFzID0gJChcIjxjYW52YXM+XCIpO1xuICAgICAgY2FudmFzWzBdLndpZHRoID0gaW1hZ2Uud2lkdGg7XG4gICAgICBjYW52YXNbMF0uaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuICAgICAgbGV0IGN0eCA9IGNhbnZhc1swXS5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBsZXQgdWljYSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShpbWFnZS5kYXRhKTtcbiAgICAgIGxldCBpbWFnZWRhdGEgPSBuZXcgSW1hZ2VEYXRhKHVpY2EsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZWRhdGEsIDAsIDApO1xuXG4gICAgICAkKFwiI3RleHR1cmVPdXRwdXRcIikuYXBwZW5kKGNhbnZhcyk7XG4gICAgfVxuXG4gICAgLy8vIFBGIFBhY2sgZmlsZVxuICAgIGVsc2UgaWYgKHBhY2tmaWxlKSB7XG4gICAgICAvLy8gQWx3YXlzIHJlbmRlciB0aGUgcGFjayBmaWxlIGNodW5rIGRhdGFcbiAgICAgIGRpc3BsYXlQYWNrRmlsZSgpO1xuXG4gICAgICAvLy8gRW5hYmxlIGNvcnJlc3BvbmRpbmcgdGFiXG4gICAgICB3MnVpLmZpbGVUYWJzLmVuYWJsZShcInRhYlBGXCIpO1xuXG4gICAgICAvLy8gSWYgdGhlIHBhY2sgZmlsZSB3YXMgYSBtb2RlbCwgcmVuZGVyIGl0IVxuICAgICAgaWYgKHBhY2tmaWxlLmhlYWRlci50eXBlID09PSBcIk1PRExcIikge1xuICAgICAgICAvLy8gUmVuZGVyIG1vZGVsXG4gICAgICAgIHJlbmRlckZpbGVNb2RlbChmaWxlSWQpO1xuICAgICAgfSBlbHNlIGlmIChwYWNrZmlsZS5oZWFkZXIudHlwZSA9PT0gXCJBU05EXCIpIHtcbiAgICAgICAgLy8vIEdldCBhIGNodW5rLCB0aGlzIGlzIHJlYWxseSB0aGUgam9iIG9mIGEgcmVuZGVyZXIgYnV0IHdoYXRldnNcbiAgICAgICAgbGV0IGNodW5rID0gcGFja2ZpbGUuZ2V0Q2h1bmsoXCJBU05EXCIpO1xuXG4gICAgICAgIC8vLyBFbmFibGUgYW5kIHNlbGVjdCBzb3VuZCB0YWJcbiAgICAgICAgdzJ1aS5maWxlVGFicy5lbmFibGUoXCJ0YWJTb3VuZFwiKTtcbiAgICAgICAgdzJ1aS5maWxlVGFicy5jbGljayhcInRhYlNvdW5kXCIpO1xuXG4gICAgICAgIC8vLyBQcmludCBzb21lIHJhbmRvbSBkYXRhIGFib3V0IHRoaXMgc291bmRcbiAgICAgICAgJChcIiNzb3VuZE91dHB1dFwiKS5odG1sKFxuICAgICAgICAgIFwiTGVuZ3RoOiBcIiArXG4gICAgICAgICAgICBjaHVuay5kYXRhLmxlbmd0aCArXG4gICAgICAgICAgICBcIiBzZWNvbmRzPGJyLz5cIiArXG4gICAgICAgICAgICBcIlNpemU6IFwiICtcbiAgICAgICAgICAgIGNodW5rLmRhdGEuYXVkaW9EYXRhLmxlbmd0aCArXG4gICAgICAgICAgICBcIiBieXRlc1wiXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8vIEV4dHJhY3Qgc291bmQgZGF0YVxuXG4gICAgICAgIGxldCBzb3VuZFVpbnRBcnJheSA9IGNodW5rLmRhdGEuYXVkaW9EYXRhO1xuXG4gICAgICAgICQoXCIjY29udGV4dFRvb2xiYXJcIilcbiAgICAgICAgICAuc2hvdygpXG4gICAgICAgICAgLmFwcGVuZChcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPkRvd25sb2FkIE1QMzwvYnV0dG9uPlwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGxldCBibG9iID0gbmV3IEJsb2IoW3NvdW5kVWludEFycmF5XSwgeyB0eXBlOiBcIm9jdGV0L3N0cmVhbVwiIH0pO1xuICAgICAgICAgICAgICBzYXZlRGF0YShibG9iLCBmaWxlTmFtZSArIFwiLm1wM1wiKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPGJ1dHRvbj5QbGF5IE1QMzwvYnV0dG9uPlwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmICghX2F1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgICAgIF9hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLy8gU3RvcCBwcmV2aW91cyBzb3VuZFxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5zdG9wKCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8vIENyZWF0ZSBuZXcgYnVmZmVyIGZvciBjdXJyZW50IHNvdW5kXG4gICAgICAgICAgICAgIF9hdWRpb1NvdXJjZSA9IF9hdWRpb0NvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5jb25uZWN0KF9hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgICAgICAgICAgIC8vLyBEZWNvZGUgYW5kIHN0YXJ0IHBsYXlpbmdcbiAgICAgICAgICAgICAgX2F1ZGlvQ29udGV4dC5kZWNvZGVBdWRpb0RhdGEoc291bmRVaW50QXJyYXkuYnVmZmVyLCBmdW5jdGlvbiAoXG4gICAgICAgICAgICAgICAgcmVzXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIF9hdWRpb1NvdXJjZS5idWZmZXIgPSByZXM7XG4gICAgICAgICAgICAgICAgX2F1ZGlvU291cmNlLnN0YXJ0KCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICAgLmFwcGVuZChcbiAgICAgICAgICAgICQoXCI8YnV0dG9uPlN0b3AgTVAzPC9idXR0b24+XCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBfYXVkaW9Tb3VyY2Uuc3RvcCgpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8vIFNlbGVjdCBQRiB0YWJcbiAgICAgICAgdzJ1aS5maWxlVGFicy5jbGljayhcInRhYlBGXCIpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZmNjID09PSBcInN0cnNcIikge1xuICAgICAgc2hvd0ZpbGVTdHJpbmcoZmlsZUlkKTtcbiAgICB9XG5cbiAgICAvLy8gRWxzZSBqdXN0IHNob3cgcmF3IHZpZXdcbiAgICBlbHNlIHtcbiAgICAgIHcydWkuZmlsZVRhYnMuY2xpY2soXCJ0YWJSYXdcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZGlzcGxheVBhY2tGaWxlKCkge1xuICAgIC8vbGV0IGZpbGVJZCA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiZmlsZUlkXCIpO1xuICAgIGxldCBwYWNrZmlsZSA9IFQzRC5nZXRDb250ZXh0VmFsdWUoX2NvbnRleHQsIFQzRC5EYXRhUmVuZGVyZXIsIFwiZmlsZVwiKTtcblxuICAgICQoXCIjcGFja091dHB1dFwiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjcGFja091dHB1dFwiKS5hcHBlbmQoJChcIjxoMj5DaHVua3M8L2gyPlwiKSk7XG5cbiAgICBwYWNrZmlsZS5jaHVua3MuZm9yRWFjaChmdW5jdGlvbiAoY2h1bmspIHtcbiAgICAgIGxldCBmaWVsZCA9ICQoXCI8ZmllbGRzZXQgLz5cIik7XG4gICAgICBsZXQgbGVnZW5kID0gJChcIjxsZWdlbmQ+XCIgKyBjaHVuay5oZWFkZXIudHlwZSArIFwiPC9sZWdlbmQ+XCIpO1xuXG4gICAgICBsZXQgbG9nQnV0dG9uID0gJChcIjxidXR0b24+TG9nIENodW5rIERhdGEgdG8gQ29uc29sZTwvYnV0dG9uPlwiKTtcbiAgICAgIGxvZ0J1dHRvbi5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIFQzRC5Mb2dnZXIubG9nKFxuICAgICAgICAgIFQzRC5Mb2dnZXIuVFlQRV9NRVNTQUdFLFxuICAgICAgICAgIFwiTG9nZ2luZ1wiLFxuICAgICAgICAgIGNodW5rLmhlYWRlci50eXBlLFxuICAgICAgICAgIFwiY2h1bmtcIlxuICAgICAgICApO1xuICAgICAgICBUM0QuTG9nZ2VyLmxvZyhUM0QuTG9nZ2VyLlRZUEVfTUVTU0FHRSwgY2h1bmsuZGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgZmllbGQuYXBwZW5kKGxlZ2VuZCk7XG4gICAgICBmaWVsZC5hcHBlbmQoJChcIjxwPlNpemU6XCIgKyBjaHVuay5oZWFkZXIuY2h1bmtEYXRhU2l6ZSArIFwiPC9wPlwiKSk7XG4gICAgICBmaWVsZC5hcHBlbmQobG9nQnV0dG9uKTtcblxuICAgICAgJChcIiNwYWNrT3V0cHV0XCIpLmFwcGVuZChmaWVsZCk7XG4gICAgICAkKFwiI3BhY2tPdXRwdXRcIikuc2hvdygpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0ZpbGVTdHJpbmcoZmlsZUlkKSB7XG4gICAgLy8vIE1ha2Ugc3VyZSBvdXRwdXQgaXMgY2xlYW5cbiAgICBfY29udGV4dCA9IHt9O1xuXG4gICAgLy8vIFJ1biBzaW5nbGUgcmVuZGVyZXJcbiAgICBUM0QucnVuUmVuZGVyZXIoXG4gICAgICBUM0QuU3RyaW5nUmVuZGVyZXIsXG4gICAgICBfbHIsXG4gICAgICB7IGlkOiBmaWxlSWQgfSxcbiAgICAgIF9jb250ZXh0LFxuICAgICAgb25SZW5kZXJlckRvbmVTdHJpbmdcbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gb25SZW5kZXJlckRvbmVTdHJpbmcoKSB7XG4gICAgLy8vIFJlYWQgZGF0YSBmcm9tIHJlbmRlcmVyXG4gICAgbGV0IHN0cmluZ3MgPSBUM0QuZ2V0Q29udGV4dFZhbHVlKFxuICAgICAgX2NvbnRleHQsXG4gICAgICBUM0QuU3RyaW5nUmVuZGVyZXIsXG4gICAgICBcInN0cmluZ3NcIixcbiAgICAgIFtdXG4gICAgKTtcblxuICAgIHcydWkuc3RyaW5nR3JpZC5yZWNvcmRzID0gc3RyaW5ncztcblxuICAgIHcydWkuc3RyaW5nR3JpZC5idWZmZXJlZCA9IHcydWkuc3RyaW5nR3JpZC5yZWNvcmRzLmxlbmd0aDtcbiAgICB3MnVpLnN0cmluZ0dyaWQudG90YWwgPSB3MnVpLnN0cmluZ0dyaWQuYnVmZmVyZWQ7XG4gICAgdzJ1aS5zdHJpbmdHcmlkLnJlZnJlc2goKTtcblxuICAgIC8vLyBTZWxlY3QgdGhpcyB2aWV3XG4gICAgdzJ1aS5maWxlVGFicy5lbmFibGUoXCJ0YWJTdHJpbmdcIik7XG4gICAgdzJ1aS5maWxlVGFicy5jbGljayhcInRhYlN0cmluZ1wiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckZpbGVNb2RlbChmaWxlSWQpIHtcbiAgICAvLy8gTWFrZSBzdXJlIG91dHB1dCBpcyBjbGVhblxuICAgIF9jb250ZXh0ID0ge307XG5cbiAgICAvLy8gUnVuIHNpbmdsZSByZW5kZXJlclxuICAgIFQzRC5ydW5SZW5kZXJlcihcbiAgICAgIFQzRC5TaW5nbGVNb2RlbFJlbmRlcmVyLFxuICAgICAgX2xyLFxuICAgICAgeyBpZDogZmlsZUlkIH0sXG4gICAgICBfY29udGV4dCxcbiAgICAgIG9uUmVuZGVyZXJEb25lTW9kZWxcbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gb25SZW5kZXJlckRvbmVNb2RlbCgpIHtcbiAgICAvLy8gRW5hYmxlIGFuZCBzZWxlY3QgbW9kZWwgdGFiXG4gICAgdzJ1aS5maWxlVGFicy5lbmFibGUoXCJ0YWJNb2RlbFwiKTtcbiAgICB3MnVpLmZpbGVUYWJzLmNsaWNrKFwidGFiTW9kZWxcIik7XG4gICAgJChcIiNtb2RlbE91dHB1dFwiKS5zaG93KCk7XG5cbiAgICAvLy8gUmUtZml0IGNhbnZhc1xuICAgIG9uQ2FudmFzUmVzaXplKCk7XG5cbiAgICAvLy8gQWRkIGNvbnRleHQgdG9vbGJhciBleHBvcnQgYnV0dG9uXG4gICAgJChcIiNjb250ZXh0VG9vbGJhclwiKS5hcHBlbmQoXG4gICAgICAkKFwiPGJ1dHRvbj5FeHBvcnQgc2NlbmU8L2J1dHRvbj5cIikuY2xpY2soZXhwb3J0U2NlbmUpXG4gICAgKTtcblxuICAgIC8vLyBSZWFkIHRoZSBuZXcgbW9kZWxzXG4gICAgX21vZGVscyA9IFQzRC5nZXRDb250ZXh0VmFsdWUoXG4gICAgICBfY29udGV4dCxcbiAgICAgIFQzRC5TaW5nbGVNb2RlbFJlbmRlcmVyLFxuICAgICAgXCJtZXNoZXNcIixcbiAgICAgIFtdXG4gICAgKTtcblxuICAgIC8vLyBLZWVwaW5nIHRyYWNrIG9mIHRoZSBiaWdnZXN0IG1vZGVsIGZvciBsYXRlclxuICAgIGxldCBiaWdnZXN0TWRsID0gbnVsbDtcblxuICAgIC8vLyBBZGQgYWxsIG1vZGVscyB0byB0aGUgc2NlbmVcbiAgICBfbW9kZWxzLmZvckVhY2goZnVuY3Rpb24gKG1vZGVsKSB7XG4gICAgICAvLy8gRmluZCB0aGUgYmlnZ2VzdCBtb2RlbCBmb3IgY2FtZXJhIGZvY3VzL2ZpdHRpbmdcbiAgICAgIGlmIChcbiAgICAgICAgIWJpZ2dlc3RNZGwgfHxcbiAgICAgICAgYmlnZ2VzdE1kbC5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPCBtb2RlbC5ib3VuZGluZ1NwaGVyZS5yYWRpdXNcbiAgICAgICkge1xuICAgICAgICBiaWdnZXN0TWRsID0gbW9kZWw7XG4gICAgICB9XG5cbiAgICAgIF9zY2VuZS5hZGQobW9kZWwpO1xuICAgIH0pO1xuXG4gICAgLy8vIFJlc2V0IGFueSB6b29tIGFuZCB0cmFuc2FsdGlvbi9yb3RhdGlvbiBkb25lIHdoZW4gdmlld2luZyBlYXJsaWVyIG1vZGVscy5cbiAgICBfY29udHJvbHMucmVzZXQoKTtcblxuICAgIC8vLyBGb2N1cyBjYW1lcmEgdG8gdGhlIGJpZ2VzdCBtb2RlbCwgZG9lc24ndCB3b3JrIGdyZWF0LlxuICAgIGxldCBkaXN0ID1cbiAgICAgIGJpZ2dlc3RNZGwgJiYgYmlnZ2VzdE1kbC5ib3VuZGluZ1NwaGVyZVxuICAgICAgICA/IGJpZ2dlc3RNZGwuYm91bmRpbmdTcGhlcmUucmFkaXVzIC8gTWF0aC50YW4oKE1hdGguUEkgKiA2MCkgLyAzNjApXG4gICAgICAgIDogMTAwO1xuICAgIGRpc3QgPSAxLjIgKiBNYXRoLm1heCgxMDAsIGRpc3QpO1xuICAgIGRpc3QgPSBNYXRoLm1pbigxMDAwLCBkaXN0KTtcbiAgICBfY2FtZXJhLnBvc2l0aW9uLnpvb20gPSAxO1xuICAgIF9jYW1lcmEucG9zaXRpb24ueCA9IGRpc3QgKiBNYXRoLnNxcnQoMik7XG4gICAgX2NhbWVyYS5wb3NpdGlvbi55ID0gNTA7XG4gICAgX2NhbWVyYS5wb3NpdGlvbi56ID0gMDtcblxuICAgIGlmIChiaWdnZXN0TWRsKSBfY2FtZXJhLmxvb2tBdChiaWdnZXN0TWRsLnBvc2l0aW9uKTtcbiAgfVxuXG4gIC8vLyBFeHBvcnRzIGN1cnJlbnQgbW9kZWwgYXMgYW4gLm9iaiBmaWxlIHdpdGggYSAubXRsIHJlZmVyaW5nIC5wbmcgdGV4dHVyZXMuXG4gIGZ1bmN0aW9uIGV4cG9ydFNjZW5lKCkge1xuICAgIC8vLyBHZXQgbGFzdCBsb2FkZWQgZmlsZUlkXG4gICAgbGV0IGZpbGVJZCA9IF9maWxlSWQ7XG5cbiAgICAvLy8gUnVuIFQzRCBoYWNrZWQgdmVyc2lvbiBvZiBPQkpFeHBvcnRlclxuICAgIGxldCByZXN1bHQgPSBuZXcgVEhSRUUuT0JKRXhwb3J0ZXIoKS5wYXJzZShfc2NlbmUsIGZpbGVJZCk7XG5cbiAgICAvLy8gUmVzdWx0IGxpc3RzIHdoYXQgZmlsZSBpZHMgYXJlIHVzZWQgZm9yIHRleHR1cmVzLlxuICAgIGxldCB0ZXhJZHMgPSByZXN1bHQudGV4dHVyZUlkcztcblxuICAgIC8vLyBTZXQgdXAgdmVyeSBiYXNpYyBtYXRlcmlhbCBmaWxlIHJlZmVyaW5nIHRoZSB0ZXh0dXJlIHBuZ3NcbiAgICAvLy8gcG5ncyBhcmUgZ2VuZXJhdGVkIGEgZmV3IGxpbmVzIGRvd24uXG4gICAgbGV0IG10bFNvdXJjZSA9IFwiXCI7XG4gICAgdGV4SWRzLmZvckVhY2goZnVuY3Rpb24gKHRleElkKSB7XG4gICAgICBtdGxTb3VyY2UgKz1cbiAgICAgICAgXCJuZXdtdGwgdGV4X1wiICtcbiAgICAgICAgdGV4SWQgK1xuICAgICAgICBcIlxcblwiICtcbiAgICAgICAgXCIgIG1hcF9LYSB0ZXhfXCIgK1xuICAgICAgICB0ZXhJZCArXG4gICAgICAgIFwiLnBuZ1xcblwiICtcbiAgICAgICAgXCIgIG1hcF9LZCB0ZXhfXCIgK1xuICAgICAgICB0ZXhJZCArXG4gICAgICAgIFwiLnBuZ1xcblxcblwiO1xuICAgIH0pO1xuXG4gICAgLy8vIERvd25sb2FkIG9ialxuICAgIGxldCBibG9iID0gbmV3IEJsb2IoW3Jlc3VsdC5vYmpdLCB7IHR5cGU6IFwib2N0ZXQvc3RyZWFtXCIgfSk7XG4gICAgc2F2ZURhdGEoYmxvYiwgXCJleHBvcnQuXCIgKyBmaWxlSWQgKyBcIi5vYmpcIik7XG5cbiAgICAvLy8gRG93bmxvYWQgbXRsXG4gICAgYmxvYiA9IG5ldyBCbG9iKFttdGxTb3VyY2VdLCB7IHR5cGU6IFwib2N0ZXQvc3RyZWFtXCIgfSk7XG4gICAgc2F2ZURhdGEoYmxvYiwgXCJleHBvcnQuXCIgKyBmaWxlSWQgKyBcIi5tdGxcIik7XG5cbiAgICAvLy8gRG93bmxvYWQgdGV4dHVyZSBwbmdzXG4gICAgdGV4SWRzLmZvckVhY2goZnVuY3Rpb24gKHRleElkKSB7XG4gICAgICAvLy8gTG9jYWxSZWFkZXIgd2lsbCBoYXZlIHRvIHJlLWxvYWQgdGhlIHRleHR1cmVzLCBkb24ndCB3YW50IHRvIGZldGNoXG4gICAgICAvLy8gdGhlbiBmcm9tIHRoZSBtb2RlbCBkYXRhLi5cbiAgICAgIF9sci5sb2FkVGV4dHVyZUZpbGUodGV4SWQsIGZ1bmN0aW9uIChcbiAgICAgICAgaW5mbGF0ZWREYXRhLFxuICAgICAgICBkeHRUeXBlLFxuICAgICAgICBpbWFnZVdpZHRoLFxuICAgICAgICBpbWFnZUhlaWd0aFxuICAgICAgKSB7XG4gICAgICAgIC8vLyBDcmVhdGUganMgaW1hZ2UgdXNpbmcgcmV0dXJuZWQgYml0bWFwIGRhdGEuXG4gICAgICAgIGxldCBpbWFnZSA9IHtcbiAgICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShpbmZsYXRlZERhdGEpLFxuICAgICAgICAgIHdpZHRoOiBpbWFnZVdpZHRoLFxuICAgICAgICAgIGhlaWdodDogaW1hZ2VIZWlndGgsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8vIE5lZWQgYSBjYW52YXMgaW4gb3JkZXIgdG8gZHJhd1xuICAgICAgICBsZXQgY2FudmFzID0gJChcIjxjYW52YXMgLz5cIik7XG4gICAgICAgICQoXCJib2R5XCIpLmFwcGVuZChjYW52YXMpO1xuXG4gICAgICAgIGNhbnZhc1swXS53aWR0aCA9IGltYWdlLndpZHRoO1xuICAgICAgICBjYW52YXNbMF0uaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xuXG4gICAgICAgIGxldCBjdHggPSBjYW52YXNbMF0uZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gICAgICAgIC8vLyBEcmF3IHJhdyBiaXRtYXAgdG8gY2FudmFzXG4gICAgICAgIGxldCB1aWNhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlLmRhdGEpO1xuICAgICAgICBsZXQgaW1hZ2VkYXRhID0gbmV3IEltYWdlRGF0YSh1aWNhLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcbiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZWRhdGEsIDAsIDApO1xuXG4gICAgICAgIC8vLyBUaGlzIGlzIHdoZXJlIHNoaXQgZ2V0cyBzdHVwaWQuIEZsaXBwaW5nIHJhdyBiaXRtYXBzIGluIGpzXG4gICAgICAgIC8vLyBpcyBhcHBhcmVudGx5IGEgcGFpbi4gQmFzaWNseSByZWFkIGN1cnJlbnQgc3RhdGUgcGl4ZWwgYnkgcGl4ZWxcbiAgICAgICAgLy8vIGFuZCB3cml0ZSBpdCBiYWNrIHdpdGggZmxpcHBlZCB5LWF4aXNcbiAgICAgICAgbGV0IGlucHV0ID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcblxuICAgICAgICAvLy8gQ3JlYXRlIG91dHB1dCBpbWFnZSBkYXRhIGJ1ZmZlclxuICAgICAgICBsZXQgb3V0cHV0ID0gY3R4LmNyZWF0ZUltYWdlRGF0YShpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcblxuICAgICAgICAvLy8gR2V0IGltYWdlZGF0YSBzaXplXG4gICAgICAgIGxldCB3ID0gaW5wdXQud2lkdGgsXG4gICAgICAgICAgaCA9IGlucHV0LmhlaWdodDtcbiAgICAgICAgbGV0IGlucHV0RGF0YSA9IGlucHV0LmRhdGE7XG4gICAgICAgIGxldCBvdXRwdXREYXRhID0gb3V0cHV0LmRhdGE7XG5cbiAgICAgICAgLy8vIExvb3AgcGl4ZWxzXG4gICAgICAgIGZvciAobGV0IHkgPSAxOyB5IDwgaCAtIDE7IHkgKz0gMSkge1xuICAgICAgICAgIGZvciAobGV0IHggPSAxOyB4IDwgdyAtIDE7IHggKz0gMSkge1xuICAgICAgICAgICAgLy8vIElucHV0IGxpbmVhciBjb29yZGluYXRlXG4gICAgICAgICAgICBsZXQgaSA9ICh5ICogdyArIHgpICogNDtcblxuICAgICAgICAgICAgLy8vIE91dHB1dCBsaW5lYXIgY29vcmRpbmF0ZVxuICAgICAgICAgICAgbGV0IGZsaXAgPSAoKGggLSB5KSAqIHcgKyB4KSAqIDQ7XG5cbiAgICAgICAgICAgIC8vLyBSZWFkIGFuZCB3cml0ZSBSR0JBXG4gICAgICAgICAgICAvLy8gVE9ETzogUGVyaGFwcyBwdXQgYWxwaGEgdG8gMTAwJVxuICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCA0OyBjICs9IDEpIHtcbiAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgY10gPSBpbnB1dERhdGFbZmxpcCArIGNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vLyBXcml0ZSBiYWNrIGZsaXBwZWQgZGF0YVxuICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dCwgMCwgMCk7XG5cbiAgICAgICAgLy8vIEZldGNoIGNhbnZhcyBkYXRhIGFzIHBuZyBhbmQgZG93bmxvYWQuXG4gICAgICAgIGNhbnZhc1swXS50b0Jsb2IoZnVuY3Rpb24gKHBuZ0Jsb2IpIHtcbiAgICAgICAgICBzYXZlRGF0YShwbmdCbG9iLCBcInRleF9cIiArIHRleElkICsgXCIucG5nXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLy8gUmVtb3ZlIGNhbnZhcyBmcm9tIERPTVxuICAgICAgICBjYW52YXMucmVtb3ZlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vLyBVdGlsaXR5IGZvciBkb3dubG9hZGluZyBmaWxlcyB0byBjbGllbnRcbiAgbGV0IHNhdmVEYXRhID0gKGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7XG4gICAgYS5zdHlsZSA9IFwiZGlzcGxheTogbm9uZVwiO1xuICAgIHJldHVybiBmdW5jdGlvbiAoYmxvYiwgZmlsZU5hbWUpIHtcbiAgICAgIGxldCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgIGEuaHJlZiA9IHVybDtcbiAgICAgIGEuZG93bmxvYWQgPSBmaWxlTmFtZTtcbiAgICAgIGEuY2xpY2soKTtcbiAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgfTtcbiAgfSkoKTtcblxuICAvLy8gU2V0dGluZyB1cCBhIHNjZW5lLCBUcmVlLmpzIHN0YW5kYXJkIHN0dWZmLi4uXG4gIGZ1bmN0aW9uIHNldHVwU2NlbmUoKSB7XG4gICAgbGV0IGNhbnZhc1dpZHRoID0gJChcIiNtb2RlbE91dHB1dFwiKS53aWR0aCgpO1xuICAgIGxldCBjYW52YXNIZWlnaHQgPSAkKFwiI21vZGVsT3V0cHV0XCIpLmhlaWdodCgpO1xuICAgIGxldCBjYW52YXNDbGVhckNvbG9yID0gMHgzNDI5MjA7IC8vIEZvciBoYXBweSByZW5kZXJpbmcsIGFsd2F5cyB1c2UgVmFuIER5a2UgQnJvd24uXG4gICAgbGV0IGZvdiA9IDYwO1xuICAgIGxldCBhc3BlY3QgPSAxO1xuICAgIGxldCBuZWFyID0gMC4xO1xuICAgIGxldCBmYXIgPSA1MDAwMDA7XG5cbiAgICBfY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIpO1xuXG4gICAgX3NjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgICAvLy8gVGhpcyBzY2VuZSBoYXMgb25lIGFtYmllbnQgbGlnaHQgc291cmNlIGFuZCB0aHJlZSBkaXJlY3Rpb25hbCBsaWdodHNcbiAgICBsZXQgYW1iaWVudExpZ2h0ID0gbmV3IFRIUkVFLkFtYmllbnRMaWdodCgweDU1NTU1NSk7XG4gICAgX3NjZW5lLmFkZChhbWJpZW50TGlnaHQpO1xuXG4gICAgbGV0IGRpcmVjdGlvbmFsTGlnaHQxID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gICAgZGlyZWN0aW9uYWxMaWdodDEucG9zaXRpb24uc2V0KDAsIDAsIDEpO1xuICAgIF9zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDEpO1xuXG4gICAgbGV0IGRpcmVjdGlvbmFsTGlnaHQyID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gICAgZGlyZWN0aW9uYWxMaWdodDIucG9zaXRpb24uc2V0KDEsIDAsIDApO1xuICAgIF9zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDIpO1xuXG4gICAgbGV0IGRpcmVjdGlvbmFsTGlnaHQzID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuOCk7XG4gICAgZGlyZWN0aW9uYWxMaWdodDMucG9zaXRpb24uc2V0KDAsIDEsIDApO1xuICAgIF9zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodDMpO1xuXG4gICAgLy8vIFN0YW5kYXJkIFRIUkVFIHJlbmRlcmVyIHdpdGggQUFcbiAgICBfcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhc2luZzogdHJ1ZSB9KTtcbiAgICAkKFwiI21vZGVsT3V0cHV0XCIpWzBdLmFwcGVuZENoaWxkKF9yZW5kZXJlci5kb21FbGVtZW50KTtcblxuICAgIF9yZW5kZXJlci5zZXRTaXplKGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpO1xuICAgIF9yZW5kZXJlci5zZXRDbGVhckNvbG9yKGNhbnZhc0NsZWFyQ29sb3IpO1xuXG4gICAgLy8vIEFkZCBUSFJFRSBvcmJpdCBjb250cm9scywgZm9yIHNpbXBsZSBvcmJpdGluZywgcGFubmluZyBhbmQgem9vbWluZ1xuICAgIF9jb250cm9scyA9IG5ldyBUSFJFRS5PcmJpdENvbnRyb2xzKF9jYW1lcmEsIF9yZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICBfY29udHJvbHMuZW5hYmxlWm9vbSA9IHRydWU7XG5cbiAgICAvLy8gU2VtcyB3MnVpIGRlbGF5cyByZXNpemluZyA6L1xuICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xuICAgICAgc2V0VGltZW91dChvbkNhbnZhc1Jlc2l6ZSwgMTApO1xuICAgIH0pO1xuXG4gICAgLy8vIE5vdGU6IGNvbnN0YW50IGNvbnRpbm91cyByZW5kZXJpbmcgZnJvbSBwYWdlIGxvYWQgZXZlbnQsIG5vdCB2ZXJ5IG9wdC5cbiAgICByZW5kZXIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uQ2FudmFzUmVzaXplKCkge1xuICAgIGxldCBzY2VuZVdpZHRoID0gJChcIiNtb2RlbE91dHB1dFwiKS53aWR0aCgpO1xuICAgIGxldCBzY2VuZUhlaWdodCA9ICQoXCIjbW9kZWxPdXRwdXRcIikuaGVpZ2h0KCk7XG5cbiAgICBpZiAoIXNjZW5lSGVpZ2h0IHx8ICFzY2VuZVdpZHRoKSByZXR1cm47XG5cbiAgICBfY2FtZXJhLmFzcGVjdCA9IHNjZW5lV2lkdGggLyBzY2VuZUhlaWdodDtcblxuICAgIF9yZW5kZXJlci5zZXRTaXplKHNjZW5lV2lkdGgsIHNjZW5lSGVpZ2h0KTtcblxuICAgIF9jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuICB9XG5cbiAgLy8vIFJlbmRlciBsb29wLCBubyBnYW1lIGxvZ2ljLCBqdXN0IHJlbmRlcmluZy5cbiAgZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyKTtcbiAgICBfcmVuZGVyZXIucmVuZGVyKF9zY2VuZSwgX2NhbWVyYSk7XG4gIH1cbn07XG4iXX0="}