!function(){return function e(t,a,n){function i(o,s){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[o]={exports:{}};t[o][0].call(c.exports,function(e){return i(t[o][1][e]||e)},c,c.exports,e,t,a,n)}return a[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}}()({1:[function(e,t,a){const n=e("../util/MathUtils");function i(e){let t={};if(t.version=e.readUint8(),t.magic=e.readString(3),t.headerSize=e.readUint32(),e.seek(e.position+4),t.chunkSize=e.readUint32(),t.crc=e.readUint32(),e.seek(e.position+4),t.mftOffset=n.arr32To64([e.readUint32(),e.readUint32()]),t.mftSize=e.readUint32(),t.flags=e.readUint32(),"AN"===t.magic)return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header"),t;T3D.Logger.log(T3D.Logger.TYPE_ERROR,"ANDat header is not valid",t.magic)}function r(e){let t={};if(t.magic=e.readString(4),e.seek(e.position+8),t.nbOfEntries=e.readUint32(),e.seek(e.position+4+4),"Mft"!==t.magic)return void T3D.Logger.log(T3D.Logger.TYPE_ERROR,"MFTTable header is not valid",t.magic);let a=[];for(let i=1;i<t.nbOfEntries;i++){let t={};t.offset=n.arr32To64([e.readUint32(),e.readUint32()]),t.size=e.readUint32(),t.compressed=e.readUint16(),e.seek(e.position+4+2),t.crc=e.readUint32(),a[i]=t}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded MFTTable"),{header:t,table:a,mftIndexOffset:a[2].offset,mftIndexSize:a[2].size}}function o(e,t){let a=t/8,n=[];for(let t=0;t<a;t++){let t=e.readUint32(),a=e.readUint32();n[t]=a}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT"),n}function s(e,t,a){return new Promise((n,i)=>{let r=new FileReader;r.onerror=i,r.onload=function(e){let t=e.target.result,i=new DataStream(t);i.endianness=DataStream.LITTLE_ENDIAN,n({ds:i,len:a})},r.readAsArrayBuffer(e.slice(t,t+a))})}t.exports={readArchive:async function(e){let t=i((await s(e,0,40)).ds),a=r((await s(e,t.mftOffset,t.mftSize)).ds),{ds:n,len:l}=await s(e,a.mftIndexOffset,a.mftIndexSize),d=o(n,l);return{archiveHeader:t,metaTable:a.table,indexTable:d}},parseANDatHeader:i,parseMFTTable:r,parseMFTIndex:o,getFilePart:s}},{"../util/MathUtils":20}],2:[function(e,t,a){t.exports=class{constructor(e){this._settings=e,this._workerPool=[],this._workerLoad=[],this._inflateCallbacks=[];for(let t=0;t<e.workersNb;t++)this._startWorker(e.workerPath)}inflate(e,t,a,n,i){return new Promise((t,r)=>{let o=e.buffer;if((!i||i<0)&&(i=0),o.byteLength<12)return T3D.Logger.log(T3D.Logger.TYPE_WARNING,`not inflating, length is too short (${o.byteLength})`,a),void r(new Error("Couldn't inflate "+a+" (mftId)"));if(this._inflateCallbacks[a])return void this._inflateCallbacks[a].push({resolve:t,reject:r});this._inflateCallbacks[a]=[{resolve:t,reject:r}];let s=this._getBestWorkerIndex();this._workerLoad[s]+=1,this._workerPool[s].postMessage([a,o,!0===n,i])})}_startWorker(e){let t=this,a=new Worker(e),n=this._workerPool.push(a)-1;if(this._workerLoad.push(0)!==n+1)throw new Error("WorkerLoad and WorkerPool don't have the same length");a.onmessage=function(e){let a;if(t._workerLoad[n]-=1,"string"==typeof e.data){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",e.data),a=e.data.split(":")[0];for(let e of t._inflateCallbacks[a])e.reject()}else if(a=e.data[0],t._inflateCallbacks[a]){for(let n of t._inflateCallbacks[a]){let t=e.data;n.resolve({buffer:t[1],dxtType:t[2],imageWidth:t[3],imageHeight:t[4]})}t._inflateCallbacks[a]=null}else T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Inflater threw an error",e.data)}}_getBestWorkerIndex(){return this._workerLoad.indexOf(Math.min(...this._workerLoad))}}},{}],3:[function(e,t,a){const n=e("../format/file/GW2File.js");let i={getFileType:function(e){let t=e.readCString(4);switch(t){case"ATEC":return"TEXTURE_ATEC";case"ATEP":return"TEXTURE_ATEP";case"ATET":return"TEXTURE_ATET";case"ATEU":return"TEXTURE_ATEU";case"ATEX":return"TEXTURE_ATEX";case"ATTX":return"TEXTURE_ATTX"}if(0===t.indexOf("DDS"))return"TEXTURE_DDS";if(1===t.indexOf("PNG"))return"TEXTURE_PNG";if(0===t.indexOf("RIFF"))return"TEXTURE_RIFF";if(0===t.indexOf("YUI"))return"TEXT_YUI";if(0===t.indexOf("PF")){return"PF_"+new n(e,0,!0).header.type}return 0===t.indexOf("MZ")?"BINARIES":0===t.indexOf("strs")?"STRINGS":0===t.indexOf("asnd")?"CHUNK_ASND":"UNKNOWN"}};t.exports=i},{"../format/file/GW2File.js":18}],4:[function(e,t,a){const n=e("./ArchiveParser"),i=e("./PersistantStore"),r=e("./DataReader"),o=e("../MapFileList"),s=e("./FileTypes");t.exports=class{constructor(e){this._settings=e,this._dataReader=new r(e),this._persistantStore,this._file=void 0,this._indexTable=[],this._fileMetaTable=[],!1!==e.noIndexedDB&&(this._persistantStore=new i)}async openArchive(e){let{metaTable:t,indexTable:a}=await n.readArchive(e);this._fileMetaTable=t,this._indexTable=a,this._file=e}getFileIndex(e){return this._indexTable[e]}getFileMeta(e){return this._fileMetaTable[e]}async readFile(e,t,a,i,r){let o=this.getFileMeta(e);if(!o)throw new Error("Unexistant file");let{ds:s,len:l}=await n.getFilePart(this._file,o.offset,i||o.size);if(o.compressed||!1!==a){let a;return await this._dataReader.inflate(s,l,e,t,r||0).then(e=>{a=e}).catch(()=>{a={buffer:void 0,dxtType:void 0,imageWidth:void 0,imageHeight:void 0}}),a}return{buffer:s.buffer}}async readFileList(e){let t,a=this,n=e||[];if(this._persistantStore){let e=await this._persistantStore.getLastListing(this._file.name);n=e.array,e.complete||(t=e.key)}let i=Object.keys(a._indexTable).map(e=>Number(e));for(let e in n)e in a._indexTable||i.push(e);let r=[];for(let e=0;e<1;e++)r[e]=Promise.resolve({task:e});let o=!1;for(let e in i){let s=i[e],l=this._needsScan(s,n);if(!0===l.scan){let e=(await Promise.race(r)).task;r[e]=this._readFileType(s).then(t=>(n[s]={baseId:s,size:t.size,crc:t.crc,fileType:t.fileType},{task:e}))}"removed"===l.change&&delete n[s],"none"!==l.change&&(o=!0),e%Math.floor(i.length/100)==0&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Finding types",e/Math.floor(i.length/100)),a._persistantStore&&o&&(o=!1,a._persistantStore.putListing(t,n,a._file.name,!1).then(e=>t=e)))}return await Promise.all(r).then(()=>{a._persistantStore&&a._persistantStore.putListing(t,n,a._file.name,!0)}),this._persistantData=n,this.getFileList()}getMapList(){let e=this,t=[];if(this._persistantData){let a=this.getReverseIndex(),n=this._persistantData.filter(e=>"PF_mapc"===e.fileType).filter(t=>t.baseId===a[e.getFileIndex(t.baseId)][0]);for(let e of n){let a=!1;for(let n of o.maps){let i=n.maps.find(t=>Number(t.fileName.split(".data")[0])===e.baseId);if(i){t.push({name:i.name,category:n.name,baseId:e.baseId}),a=!0;break}}a||t.push({name:e.baseId.toString(),category:"Uncategorized",baseId:e.baseId})}}else for(let e of o.maps)for(let a of e.maps)Number(a.fileName.split(".data")[0])in this._indexTable&&t.push({name:a.name,category:e.name,baseId:Number(a.fileName.split(".data")[0])});return t}getFileList(){let e=this._persistantData?this._persistantData.map(e=>e.fileType):[],t=this.getReverseIndex(),a=this._fileMetaTable.map((a,n)=>{let i=t[n]?t[n]:[],r=t[n]?e[i[0]]:"Non-Registered";return{mftId:n,baseIdList:i,size:a.size,crc:a.crc,fileType:r}});return a[0]={mftId:0,baseIdList:[],size:0,crc:0,fileType:"Non-Registered"},a}getReverseIndex(){return this._indexTable.reduce((e,t,a)=>(t in e?e[t].push(a):e[t]=[a],e),[])}readMapListAsync(e,t){let a=this;function n(e){let t=[];for(let a of e){let e=t.findIndex(e=>e.name===a.category);-1===e&&(e=t.push({name:a.category,maps:[]})-1),t[e].maps.push({fileName:a.baseId,name:a.name})}return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),{maps:t}}T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readMapListAsync is deprecated !"),e?this.readFileList().then(()=>{t(n(a.getMapList()))}):t(n(a.getMapList()))}readFileListAsync(e){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readFileListAsync is deprecated !"),this.readFileList().then(t=>{let a={};for(let e of t)void 0===a[e.fileType]&&(a[e.fileType]=[]),a[e.fileType].push(e.mftId);e(a)})}loadFile(e,t,a,n){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFile is deprecated !");let i=this.getFileIndex(e);if(i<=0)return t(null);this.readFile(i,a,n).then(e=>{if(void 0===e.buffer)return t(null);t(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadTextureFile(e,t){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadTextureFile is deprecated !"),this.loadFile(e,t,!0)}loadFileList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFileList is deprecated !")}loadMapList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadMapList is deprecated !")}_needsScan(e,t){if(e<=0)return{change:"none",scan:!1};let a=this.getFileIndex(e),n=this.getFileMeta(a);return void 0!==n||e in t?void 0===n?{change:"removed",scan:!1}:e in t?n.size!==t[e].size||n.crc!==t[e].crc?{change:"modified",scan:!0}:{change:"none",scan:!1}:{change:"added",scan:!0}:{change:"none",scan:!1}}async _readFileType(e){this._fileTypeCache||(this._fileTypeCache=[]);let t,a=this.getFileIndex(e),n=this.getFileMeta(a);if(void 0!==this._fileTypeCache[e])t=this._fileTypeCache[e];else{let e=(await this.readFile(a,!1,!1,Math.min(n.size,1e3),32)).buffer;if(void 0===e)return;t=s.getFileType(new DataStream(e))}return{fileType:t,crc:n.crc,size:n.size}}}},{"../MapFileList":7,"./ArchiveParser":1,"./DataReader":2,"./FileTypes":3,"./PersistantStore":5}],5:[function(e,t,a){const n=4;t.exports=class{constructor(){this._dbConnection=void 0,this._getConnection(()=>{})}_getConnection(){let e=this;return new Promise((t,a)=>{e._dbConnection&&t(e._dbConnection);let i=window.indexedDB.open("Tyria3DLibrary",n);i.onblocked=(()=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")}),i.onupgradeneeded=(e=>{let t=e.target.result,a=e.oldVersion;a<2&&t.createObjectStore("listings",{autoIncrement:!0}),a<3&&e.currentTarget.transaction.objectStore("listings").createIndex("filename","filename",{unique:!1})}),i.onsuccess=(a=>{e._dbConnection=a.target.result,e.isReady=!0,t(e._dbConnection)}),i.onerror=(()=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),a()})})}putListing(e,t,a,n){let i=this;return new Promise((r,o)=>{i._getConnection().then(i=>{let s=i.transaction(["listings"],"readwrite").objectStore("listings"),l=e?s.put({array:t,filename:a,complete:n},e):s.put({array:t,name:a});l.onsuccess=(()=>{r(l.result)}),l.onerror=(()=>{o()})})})}getLastListing(e){let t=this;return new Promise(a=>{t._getConnection().then(t=>{t.transaction(["listings"],"readonly").objectStore("listings").index("filename").openCursor(IDBKeyRange.only(e),"prev").onsuccess=(e=>{let t=e.target.result;a(t?{array:t.value.array,key:t.primaryKey,complete:t.value.complete}:{array:[],key:void 0,complete:!0})})})})}}},{}],6:[function(e,t,a){let n={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};n.logFunctions=new Array(5),n.log=function(){if(0===arguments.length)return;let e=n.argsToArr(arguments);1===e.length&&e.unshift(n.TYPE_MESSAGE);let t=Math.max(0,Math.min(n.logFunctions.length,e.shift()));n.logFunctions[t].apply(this,e)},n.argsToArr=function(e){let t=new Array(e.length);for(let a=0;a<t.length;++a)t[a]=e[a];return t},n.logFunctions[n.TYPE_ERROR]=function(){console.error.apply(console,arguments)},n.logFunctions[n.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},n.logFunctions[n.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},n.logFunctions[n.TYPE_PROGRESS]=function(){let e=n.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},n.logFunctions[n.TYPE_DEBUG]=function(){let e=n.argsToArr(arguments);console.debug.apply(console,e)},t.exports=n},{}],7:[function(e,t,a){t.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"1966018.data",name:"Hoelbrak (2)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"1968107.data",name:"Black Citadel (2)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"1968576.data",name:"Lion's Arch (4)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"1968748.data",name:"Divinity's Reach (3)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove (0)"},{fileName:"1969341.data",name:"The Grove (1)"},{fileName:"198272.data",name:"Rata Sum (0)"},{fileName:"1968896.data",name:"Rata Sum (1)"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],8:[function(e,t,a){(function(a){let n,i=e("./LocalReader/LocalReader"),r={t3dtoolsWorker:"modules/t3dtools/t3dworker.js",concurrentTasks:"undefined"!=typeof navigator?navigator.hardwareConcurrency:1};n=t.exports={version:"1.1.0",GW2File:e("./format/file/GW2File"),GW2Chunk:e("./format/file/GW2Chunk"),DataRenderer:e("./dataRenderer/DataRenderer"),EnvironmentRenderer:e("./dataRenderer/EnvironmentRenderer"),HavokRenderer:e("./dataRenderer/HavokRenderer"),PropertiesRenderer:e("./dataRenderer/PropertiesRenderer"),SingleModelRenderer:e("./dataRenderer/SingleModelRenderer"),TerrainRenderer:e("./dataRenderer/TerrainRenderer"),ZoneRenderer:e("./dataRenderer/ZoneRenderer"),StringRenderer:e("./dataRenderer/StringRenderer"),Logger:e("./Logger"),MapFileList:e("./MapFileList"),MaterialUtils:e("./util/MaterialUtils.js"),MathUtils:e("./util/MathUtils.js"),ParserUtils:e("./util/ParserUtils.js"),RenderUtils:e("./util/RenderUtils.js"),PersistantStore:e("./LocalReader/PersistantStore"),FileTypes:e("./LocalReader/FileTypes"),getLocalReader:function(e,t,a){let n=new i({workerPath:a||r.t3dtoolsWorker,workersNb:r.concurrentTasks});return n.openArchive(e).then(()=>{t(n)}),n},getFileListAsync:function(e,t){let a=e.loadFileList();a?t(a):e.readFileListAsync(t)},getMapListAsync:function(e,t,a){if(a)return void e.readMapListAsync(!0,t);let n=e.loadMapList();n?t(n):e.readMapListAsync(!1,t)},renderMapContentsAsync:function(e,t,a,i,r){let o,s={};if(parseInt(t))e.loadFile(t,function(t){let r=new DataStream(t,0,DataStream.LITTLE_ENDIAN),l=new n.GW2File(r,0);(o=function(t){t<a.length?n.runRenderer(a[t].renderClass,e,Object.assign(a[t].settings,{mapFile:l}),s,o.bind(this,t+1)):i(s)})(0)});else{(r||n.Logger).log(n.Logger.TYPE_ERROR,"Map id must be an integer!, was:",t)}},runRenderer:function(e,t,a,n,i){new e(t,a,n).renderAsync(i)},getContextValue:function(e,t,a,n){let i=e[t.name];return i&&i[a]?i[a]:n},hasWebGL:function(e){if(window.WebGLRenderingContext){let t=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1;for(let i=0;i<4;i++)try{if((n=t.getContext(a[i]))&&"function"==typeof n.getParameter)return!e||{name:a[i],gl:n}}catch(e){}return!1}return!1}},function(){let e=0;a.window&&window.indexedDB||(n.Logger.log(n.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),e++),"undefined"==typeof DataStream&&(n.Logger.log(n.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),e++),"undefined"==typeof THREE&&(n.Logger.log(n.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),e++),e<1&&n.Logger.log(n.Logger.TYPE_MESSAGE,"Tyria 3D API v"+n.version+" initialized.")}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/FileTypes":3,"./LocalReader/LocalReader":4,"./LocalReader/PersistantStore":5,"./Logger":6,"./MapFileList":7,"./dataRenderer/DataRenderer":9,"./dataRenderer/EnvironmentRenderer":10,"./dataRenderer/HavokRenderer":11,"./dataRenderer/PropertiesRenderer":12,"./dataRenderer/SingleModelRenderer":13,"./dataRenderer/StringRenderer":14,"./dataRenderer/TerrainRenderer":15,"./dataRenderer/ZoneRenderer":16,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/MaterialUtils.js":19,"./util/MathUtils.js":20,"./util/ParserUtils.js":21,"./util/RenderUtils.js":22}],9:[function(e,t,a){const n=e("../format/file/GW2File");let i=function(e,t,a,n){this.localReader=e,this.settings=t,t||(t={}),this.context=a,this.context[this.constructor.name]={},this.logger=n||T3D.Logger};i.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},i.prototype.renderAsync=function(e){let t=this;this.localReader.loadFile(this.settings.id,function(a){t.getOutput().fileId=t.settings.id,t.getOutput().rawData=a;let i=new Uint8Array(a),r=[],o=Math.min(i.length,1e4);for(let e=0;65535*e<o;e++)r.push(String.fromCharCode.apply(null,i.subarray(65535*e,65535*(e+1))));o<i.length&&r.push("T3D Ignored the last "+(i.length-o)+" bytes when generating this raw output"),t.getOutput().rawString=r.join();let s=new DataStream(a),l=s.readCString(4);"ATEX"===l||"ATEC"===l||"ATEP"===l||"ATET"===l||"ATEU"===l||"ATTX"===l?t.localReader.loadTextureFile(t.settings.id,function(a,n,i,r){let o={data:new Uint8Array(a),width:i,height:r};t.getOutput().image=o,e()}):0===l.indexOf("PF")?(t.getOutput().file=new n(s,0),e()):(t.getOutput().file=null,e())})},t.exports=i},{"../format/file/GW2File":18}],10:[function(e,t,a){const n=e("../util/RenderUtils"),i=e("./DataRenderer");function r(e,t,a,r){i.call(this,e,t,a,r),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(t,a,i,r,o){let s=this;function l(e){t.forEach(function(t){a[t]=e})}function d(){l(s.getMat((new THREE.TextureLoader).load(r)))}l(s.getMat(n.loadLocalTexture(e,i,null,o,function(){setTimeout(d,1)})))},this.getHazeColor=function(e){let t=e&&e.dataGlobal.haze;return!t||t.length<=0?[190,160,60]:t[0].farColor},this.parseLights=function(e){let t=this;t.getOutput().lights=[];let a,n=!1;(e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}]).forEach(function(e){if(n)return;let i=0;if(e.lights.forEach(function(e){n=!0;let a=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),r=new THREE.DirectionalLight(a.getHex(),e.intensity);r.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),i+=e.intensity,t.getOutput().lights.push(r)}),!e.lights||0===e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){let a=new THREE.Color(1,1,1),n=e[3],r=new THREE.DirectionalLight(a.getHex(),n);r.position.set(e[0],e[1],e[2]).normalize(),i+=n,t.getOutput().lights.push(r)})}let r=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);a=new THREE.AmbientLight(r)});let i=0;a&&(i=a.color.r+a.color.g+a.color.b,this.getOutput().lights.push(a)),this.getOutput().hasLight=n||i>0},this.parseSkybox=function(e,t,a){this.getOutput().skyElements=[];let n=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];n||(n={texPathNE:1930687,texPathSW:193069,texPathT:193071});let i=t.rect,r=Math.abs(i.x1-i.x2),o=Math.abs(i.y1-i.y2),s=(Math.max(r,o),[]);this.loadTextureWithFallback([1,4],s,n.texPathNE+1,"img/193068.png",a),this.loadTextureWithFallback([0,5],s,n.texPathSW+1,"img/193070.png",a),this.loadTextureWithFallback([2],s,n.texPathT+1,"img/193072.png",a),s[3]=new THREE.MeshBasicMaterial({visible:!1});let l=new THREE.BoxGeometry(1024,512,1024);l.faceVertexUvs[0].forEach(function(e,t){let a=Math.floor(t/2);0===a||1===a?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5===a||4===a?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),l.uvsNeedUpdate=!0;let d=new THREE.Mesh(l,s);d.translateY(256),this.getOutput().skyElements.push(d)}}r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this.mapFile.getChunk("env").data,a=this.mapFile.getChunk("parm").data,n=this.getHazeColor(t),i=256*n[2]*256+256*n[1]+n[0];this.getOutput().hazeColor=n,this.parseLights(t),this.parseSkybox(t,a,i),e()},t.exports=r},{"../util/RenderUtils":22,"./DataRenderer":9}],11:[function(e,t,a){const n=e("./DataRenderer");function i(e,t,a,i){n.call(this,e,t,a,i),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,t,a){let n;n=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,n,t,200,0,a)},this.getCollisionsForAnimation=function(e,t){let a=[];for(let n=0;n<e.collisionIndices.length;n++){let i=e.collisionIndices[n],r=t[i];r.index=i,a.push(r)}return a},this.parseAllModels=function(e,t,a,n,i,r){let o=i;for(;o<i+n&&o<e.length;o++){let n=Math.round(100*o/e.length);n!==this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+a+")",n),this.lastP=n);let i=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),r=this.getCollisionsForAnimation(i,this.havokChunkData.collisions);for(let a=0;a<r.length;a++){let n=r[a];this.renderMesh(n,e[o],t)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,t,a,n,i+n,r),10):r()},this.animationFromGeomIndex=function(e,t,a){let n=t[e].animations.length;return a[t[e].animations[n-1]]},this.renderMesh=function(e,t,a){let n=t.translate,i=t.rotate,r=32*t.scale,o=this.parseHavokMesh(e,a);o.position.set(n[0],-n[2],-n[1]),r&&o.scale.set(r,r,r),i&&(o.rotation.order="ZXY",o.rotation.set(i[0],-i[2],-i[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){let e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,t){let a=e.index;if(this.meshes[a])return this.meshes[a].clone();{let n=new THREE.Geometry;for(let t=0;t<e.vertices.length;t++){let a=e.vertices[t];n.vertices.push(new THREE.Vector3(a[0],a[2],-a[1]))}for(let t=0;t<e.indices.length;t+=3){let a=e.indices[t],i=e.indices[t+1],r=e.indices[t+2];a<=e.vertices.length&&i<=e.vertices.length&&r<=e.vertices.length?n.faces.push(new THREE.Face3(a,i,r)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return n.computeFaceNormals(),this.meshes[a]=new THREE.Mesh(n,t),this.meshes[a]}}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];let a=this.havokChunkData.propModels,n=this.havokChunkData.zoneModels,i=this.havokChunkData.obsModels;i.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;let r=function(){t.renderModels(i,"obs",e)};t.renderModels(a,"prop",function(){t.renderModels(n,"zone",r)})},t.exports=i},{"./DataRenderer":9}],12:[function(e,t,a){const n=e("../util/RenderUtils"),i=e("./DataRenderer");function r(e,t,a,n){i.call(this,e,t,a,n),this.mapFile=this.settings.mapFile}r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this;t.getOutput().meshes=[];let a=this.mapFile.getChunk("prp2").data;if(!a)return void e();let i=a.propArray,r=a.propAnimArray,o=a.propInstanceArray,s=a.propMetaArray;i=i.concat(r).concat(o).concat(s),t.meshCache={},t.textureCache={};let l=-1,d=function(a){if(a>=i.length)return t.meshCache={},t.textureCache={},void e();let r=Math.round(1e3*a/i.length);if(l!==(r/=10)){let e=r+(r.toString().indexOf(".")<0?".0":"");t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",e),l=r}let o=i[a],s=function(e,t,a,n,i){let r=0!==n.lod2?n.lod2:e.lodOverride[1];if(0===e.flags&&(r=0),i&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,t[r])t[r].add(e);else{let n=new THREE.Group;n.updateMatrix(),n.matrixAutoUpdate=!1,n.add(e),t[r]=n,a.addLevel(n,r)}return r};n.getMeshesForFilename(o.filename,o.color,t.localReader,t.meshCache,t.textureCache,!1,function(e,n,i){e&&function(e,a,n){let i={},r=new THREE.LOD,l=0;e.forEach(function(e){l=Math.max(l,s(e,i,r,o,a))}),r.addLevel(new THREE.Group,1e5),o.rotation&&(r.rotation.order="ZXY",r.rotation.set(o.rotation[0],-o.rotation[2],-o.rotation[1])),r.scale.set(o.scale,o.scale,o.scale),r.position.set(o.position[0],-o.position[2],-o.position[1]),r.boundingSphereRadius=(n&&n.radius?n.radius:1)*o.scale,r.updateMatrix(),r.matrixAutoUpdate=!1,t.getOutput().meshes.push(r),o.transforms&&o.transforms.forEach(function(a){let i={},r=new THREE.LOD,l=0;e.forEach(function(e){l=Math.max(l,s(e,i,r,o,!0))}),a.rotation&&(r.rotation.order="ZXY",r.rotation.set(a.rotation[0],-a.rotation[2],-a.rotation[1])),r.scale.set(a.scale,a.scale,a.scale),r.position.set(a.position[0],-a.position[2],-a.position[1]),r.updateMatrix(),r.matrixAutoUpdate=!1,r.boundingSphereRadius=(n&&n.radius?n.radius:1)*o.scale,r.update(r),t.getOutput().meshes.push(r)})}(e,n,i),d(a+1)})};d(0)},r.prototype.getFileIdsAsync=function(e){let t=[],a=this.mapFile.getChunk("prp2").data,i=a.propArray,r=a.propAnimArray,o=a.propInstanceArray,s=a.propMetaArray;i=i.concat(r).concat(o).concat(s);let l=function(a){if(a>=i.length)return void e(t);a%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",a,"of",i.length);let r=i[a];n.getFilesUsedByModel(r.filename,{},function(e){t=t.concat(e),l(a+1)})};l(0)},t.exports=r},{"../util/RenderUtils":22,"./DataRenderer":9}],13:[function(e,t,a){const n=e("../util/RenderUtils"),i=e("./DataRenderer");function r(e,t,a,n){i.call(this,e,t,a,n)}r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this,a=this.settings.id,i={};t.getOutput().meshes=[],n.getMeshesForFilename(a,65280,t.localReader,i,{},!0,function(a,n,r){a&&a.forEach(function(e){e.boundingSphere=r,t.getOutput().meshes.push(e)}),i={},e()})},t.exports=r},{"../util/RenderUtils":22,"./DataRenderer":9}],14:[function(e,t,a){const n=e("./DataRenderer");function i(e,t,a,i){n.call(this,e,t,a,i)}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){let t=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(a){let n=new DataStream(a),i=n.byteLength-2;n.seek(4);let r=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],o=0;for(;i-n.position>6;){let e=n.readStruct(r);if(e.size-=6,e.size>0){if(!(0!==e.decryptionOffset||16!==e.bitsPerSymbol)){let a=n.readUCS2String(e.size/2);t.getOutput().strings.push({value:a,recid:o})}}o++}n.seek(n.byteLength-2),t.getOutput().language=n.readUint16(),e()})},t.exports=i},{"./DataRenderer":9}],15:[function(e,t,a){const n=e("../util/RenderUtils"),i=e("./DataRenderer"),r=e("../format/file/GW2File.js"),o=e("../util/TerrainShader.js");function s(e,t,a,s,l){i.call(this,e,t,a,s,l),this.mapFile=this.settings.mapFile,this.drawWater=function(e){let t=t||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return t.transparent=!0,n.renderRect(e,0,t)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(e,t){let a=this;a.getOutput().terrainTiles=[];let i=new DataStream(t),s=new r(i,0).getChunk("pgtb"),l=s&&s.data;this.mapRect=null;let d=this.mapFile.getChunk("trn").data,c=this.mapFile.getChunk("parm").data,u=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(d);let m=d.numChunksD_1,h=d.numChunksD_2,p=d.materials.materials,f=d.materials.texFileArray,g=c.rect[2]-c.rect[0],y=c.rect[3]-c.rect[1],v=g/d.numChunksD_1*1,E=y/d.numChunksD_2*1,T=0,R=[],b=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),k={};if(l){l.strippedPages.forEach(function(e){if(e.layer<=1){let t=e.filename,i=e.coord,r=i[0]+","+i[1];if(1===e.layer&&(r+="-2"),!k[r]){let e=n.loadLocalTexture(a.localReader,t);e&&(e.anisotropy=u,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),k[r]=e}}})}let w=function(t,i){if(t>=m&&(t=0,i++),i>=h)return a.getOutput().water=a.drawWater(a.mapRect),a.getOutput().bounds=a.mapRect,void e();let r=Math.floor(100*(i*m+t)/(m*h));a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",r),function(e,t){let i=t*m+e,r=Math.floor(e/4),s=Math.floor(t/4),l=p[i].loResMaterial.texIndexArray,h=b,g=e%4/4,y=.75-t%4/4,w=[];for(let e=0;e<l.length/2;e++){let t=f[l[e]].filename;if(w.push(t),!k[t]){let e=n.loadLocalTexture(a.localReader,t);e&&(e.anisotropy=u,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),k[t]=e}}let x=r+","+s,M=r+","+s+"-2",N={color:{r:1,g:1,b:1},near:0,far:0},L=a.getOutput(T3D.EnvironmentRenderer);L.hazeColor&&(N.color.r=L.hazeColor[2]/255,N.color.g=L.hazeColor[1]/255,N.color.b=L.hazeColor[0]/255);let P=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);P.uvScale={type:"v2",value:new THREE.Vector2(8,8)},P.offset={type:"v2",value:new THREE.Vector2(g,y)},P.texturePicker={type:"t",value:k[x]},P.texturePicker2={type:"t",value:k[M]},P.texture1={type:"t",value:k[w[0]]},P.texture2={type:"t",value:k[w[1]]},P.texture3={type:"t",value:k[w[2]]},P.texture4={type:"t",value:k[w[3]]},h=new THREE.ShaderMaterial({uniforms:P,fragmentShader:o.getFragmentShader(),vertexShader:o.getVertexShader()}),R.push(h);let S=new THREE.PlaneBufferGeometry(v,E,32,32),F=0;for(let e=0;e<35;e++)for(let t=0;t<35;t++)0!==t&&34!==t&&0!==e&&34!==e&&(S.getAttribute("position").array[3*F+2]=d.heightMapArray[T],F++),T++;let C,A=(new THREE.Matrix4).identity();A.elements[5]=-1,S.applyMatrix(A),S.computeFaceNormals(),C=new THREE.Mesh(S,b),(C=h.length?THREE.SceneUtils.createMultiMaterialObject(S,h):new THREE.Mesh(S,h)).rotation.set(Math.PI/2,0,0);let D=c.rect[0]+v/2,_=e*v;if(C.position.x=D+_,d.numChunksD_2%2==0){let e=c.rect[1]+E/2-0,a=t*E*1;C.position.z=a+e}else{let e=c.rect[1]-E/2+0,a=t*E*1;C.position.z=e+a}let H=C.position.x,U=C.position.z;a.mapRect||(a.mapRect={x1:H-v/2,x2:H+v/2,y1:U-E/2,y2:U+E/2}),a.mapRect.x1=Math.min(a.mapRect.x1,H-v/2),a.mapRect.x2=Math.max(a.mapRect.x2,H+v/2),a.mapRect.y1=Math.min(a.mapRect.y1,U-E/2),a.mapRect.y2=Math.max(a.mapRect.y2,U+E/2),C.updateMatrix(),C.updateMatrixWorld(),a.getOutput().terrainTiles.push(C)}(t,i),setTimeout(w,1,t+1,i)};w(0,0)}}s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.renderAsync=function(e){let t=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(t,this.loadPagedImageCallback.bind(this,e))},s.prototype.getFileIdsAsync=function(){let e=this.mapFile.getChunk("trn"),t=this.mapFile.getChunk("pimg"),a=[];return(t&&t.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&a.push(e.filename)}),e.data.materials.texFileArray.forEach(function(e){e.filename>0&&a.push(e.filename)}),a},t.exports=s},{"../format/file/GW2File.js":18,"../util/RenderUtils":22,"../util/TerrainShader.js":23,"./DataRenderer":9}],16:[function(e,t,a){const n=e("../util/RenderUtils"),i=e("./DataRenderer");function r(e,t,a,r){i.call(this,e,t,a,r),this.mapFile=this.settings.mapFile,this.renderZone=function(e,t,a,i){let r=this,o=null;t.forEach(function(t){o||t.token!==e.defToken||(o=t)});let s=this.getModelGroups(e,o,a);r.meshCache={},r.textureCache={};let l=Object.keys(s);!function e(t){if(t>=l.length)return r.meshCache={},r.textureCache={},void i();let a=l[t],o=s[a],d=[];n.getMeshesForFilename(a,null,r.localReader,r.meshCache,r.textureCache,!1,function(a){a&&o.forEach(function(e,t){a.forEach(function(a,n){if(525===a.materialFlags)return;let i={x:0,y:0,z:0};if(d[n])i.x=e.x-d[n].position.x,i.y=e.z-d[n].position.z,i.z=e.y-d[n].position.y;else{let t=a.geometry.clone();d[n]={readVerts:t.getAttribute("position").array,verts:new Float32Array(o.length*t.getAttribute("position").array.length),readIndices:t.getIndex().array,indices:new Uint32Array(o.length*t.getIndex().array.length),readUVs:t.getAttribute("uv").array,uvs:new Float32Array(o.length*t.getAttribute("uv").array.length),readNormals:t.getAttribute("normal").array,normals:new Float32Array(o.length*t.getAttribute("normal").array.length),material:a.material,position:{x:e.x,y:e.y,z:e.z}}}let r=d[n].readVerts,s=d[n].verts,l=r.length;for(let e=0,a=t*l;e<l;e+=3,a+=3)s[a+0]=r[e+0]+i.x,s[a+1]=r[e+1]+i.y,s[a+2]=r[e+2]+i.z;let c=d[n].readIndices,u=d[n].indices,m=c.length,h=l*t/3;for(let e=0,a=t*m;e<m;e++,a++)u[a]=c[e]+h;let p=d[n].readUVs,f=d[n].uvs,g=p.length;for(let e=0,a=t*g;e<g;e++,a++)f[a]=p[e];let y=d[n].readNormals,v=d[n].normals,E=y.length;for(let e=0,a=t*E;e<E;e++,a++)v[a]=y[e]})}),d.forEach(function(e){let t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),t.setIndex(new THREE.BufferAttribute(e.indices,1)),t.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),t.buffersNeedUpdate=!0;let a=new THREE.Mesh(t,e.material);a.position.set(e.position.x,e.position.z,e.position.y),r.getOutput().meshes.push(a)}),e(t+1)})}(0)},this.getModelGroups=function(e,t,a){let n=a[0],i=a[1],r=48,o=e.vertRect[0]*r+n,s=(e.vertRect[2],e.vertRect[1]*-r-i);e.vertRect[3];if(0===e.encodeData.length)return{};let l=e.vertRect[0]-e.vertRect[2],d=0,c={},u=this.getOutput(T3D.TerrainRenderer).terrainTiles;for(let a=0;a<e.flags.length;a+=2){d+=e.flags[a];let n=e.flags[a+1];if(0!==n){let e=n>>4,a=t.layerDefArray[e-1];if(a){let e=d%l*r+o,t=Math.floor(d/l)*r+s,n=null,i=1e5,m=new THREE.Raycaster(new THREE.Vector3(e,i,t),new THREE.Vector3(0,-1,0));u.forEach(function(e){if(null===n){let t=m.intersectObject(e);t.length>0&&(n=i-t[0].distance)}});let h=0,p=a.modelArray[h].filename,f=a.rotRangeX,g=a.rotRangeY,y=a.rotRangeZ,v=a.scaleRange,E=a.fadeRange;c[p]||(c[p]=[]),c[p].push({x:e,y:t,z:n,rotRangeX:f,rotRangeY:g,rotRangeZ:y,scaleRange:v,fadeRange:E})}}}return c}}r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.renderAsync=function(e){let t=this;t.getOutput().meshes=[];let a=this.mapFile.getChunk("zon2").data,n=this.mapFile.getChunk("parm").data.rect,i=a.zoneArray,r=a.zoneDefArray,o=-1;!function a(s){let l=Math.round(100*s/i.length);o!==l&&(t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",l),o=l),s>=i.length?e():t.renderZone(i[s],r,n,a.bind(t,s+1))}(0)},t.exports=r},{"../util/RenderUtils":22,"./DataRenderer":9}],17:[function(e,t,a){const n=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"];let i;const r=[{pack:"MODL",chunk:"ANIM",root:"ModelFileAnimation"},{pack:"MODL",chunk:"GAME",root:"ModelFileGame"},{pack:"MODL",chunk:"SKEL",root:"ModelFileSkeleton"},{pack:"MODL",chunk:"TOOL",root:"ModelFileTool"},{pack:"cntc",chunk:"Main",root:"PackContent"},{pack:"mMet",chunk:"Main",root:"PackMapMetadata"},{pack:"AMAT",chunk:"TOOL",root:"AmatToolParams"},{pack:"cmaC",chunk:"main",root:"CollideModelManifest"}];class o{constructor(e,t){!function(){if(!i){i={};for(let t of r){let a=new RegExp(`^${t.root}(V[0-9]*)?$`),n=T3D.formats.filter(e=>e.name===t.chunk);for(let r in n){let o=n[r].versions;if(e(o[Object.keys(o).pop()]).match(a)){i[t.chunk]||(i[t.chunk]=[]),i[t.chunk][r]=t.pack;break}}}}function e(e){let t=new e;return Object.keys(t).filter(e=>t[e]===t.__root&&"__root"!==e)[0]}}(),this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.loadHead()}loadHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr}getDefinition(e){let t=0,a=i[this.header.type];if(a){t=-1;for(let n=0;n<a.length&&-1===t;n++){a[n]===e&&(t=n)}if(-1===t)throw new Error("We didnt find this file name!")}let n=0;for(let e=0;e<T3D.formats.length;e++){let a=T3D.formats[e];if(a.name===this.header.type){if(n===t&&a.versions[this.header.chunkVersion])return(new a.versions[this.header.chunkVersion]).__root;n++}}}loadData(e){let t=this.getDefinition(e);t?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(t)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)}next(){try{return new o(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null}}t.exports=o},{}],18:[function(e,t,a){const n=e("./GW2Chunk"),i=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"];t.exports=class{constructor(e,t,a){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),a||this.readChunks()}readHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(i),this.headerLength=this.ds.position-this.addr}readChunks(){this.chunks=[];let e=new n(this.ds,this.headerLength+this.addr);for(;null!==e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()}getChunk(e){for(let t=0;t<this.chunks.length;t++)if(this.chunks[t].header.type.toLowerCase()===e.toLowerCase())return this.chunks[t];return null}getChunkStructs(){return{}}}},{"./GW2Chunk":17}],19:[function(e,t,a){function n(e){let t="",a="",n="";for(let i=0;i<e;i++)t+="varying vec2 vUv_"+(i+1)+";\n",i>1&&(a+="attribute vec2 uv"+(i+1)+";\n"),n+="vUv_"+(i+1)+" = uv"+(i>0?i+1:"")+";\n";return a+t+"void main()\n{\n"+n+"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"}function i(e,t,a){let n=e*t,i=new Uint8Array(4*n),r=Math.floor(255*a.r),o=Math.floor(255*a.g),s=Math.floor(255*a.b);for(let e=0;e<n;e++){let t=4*e;i[t]=r,i[t+1]=o,i[t+2]=s,i[t+3]=255}return new THREE.DataTexture(i,e,t,THREE.RGBAFormat)}function r(e,t,a,n){let i="vUv_"+(e[0].uvIdx+1),r="";a&&(r="    if (c1.a < 0.5) \n       discard;\n");let o="gl_FragColor = c1;\n";if(n){o="   vec4 c2 = texture2D( texture"+(0+1)+", "+"vUv_1"+" );\n     gl_FragColor = c2;\n"}let s="";e.forEach(function(e,t){s+="uniform sampler2D texture"+(t+1)+";\n"});let l="";for(let e=0;e<t;e++)l+="varying vec2 vUv_"+(e+1)+";\n";return s+l+"void main( void ) {\n    vec4 c1 = texture2D( texture1, "+i+" );\n"+r+o+"}"}function o(e,t,a){let i=!1,o={};e.forEach(function(e,t){o["texture"+t]={type:"t",value:e}}),e.length>1&&(i=!0);let s={};for(let e=2;e<t;e++)s["uv"+(e+1)]={type:"v2",value:[]};let l=n(t);return new THREE.ShaderMaterial({uniforms:o,vertexShader:l,fragmentShader:r(e,t,a,i),attributes:s,side:THREE.FrontSide})}function s(e,t,a){let n;return e&&a[e]?n=a[e]:e&&((n=l(t,e)).wrapT=THREE.RepeatWrapping,n.wrapS=THREE.RepeatWrapping,n.flipY=!1,a[e]=n),n}function l(e,t,a,n,r){void 0===n&&(n=Math.floor(16777215*Math.random()));let o=i(1,1,new THREE.Color(n));return o.minFilter=THREE.LinearMipMapLinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!0,o.flipY=!0,parseInt(t)<=0?(r&&r(),o):(e.loadTextureFile(t,function(e,t,a,n){if(!e)return void(r&&r());let i={data:new Uint8Array(e),width:a,height:n};o.format=THREE.RGBAFormat,o.image=i,o.needsUpdate=!0}),o)}t.exports={buildVS:n,generateDataTexture:i,buildPS:r,getUVMat:o,getMaterial:function(e,t,a,n){if(!t)return;let i,r=t.getChunk("dx9s"),o=t.getChunk("grmt"),l=[];if(e&&e.textures.length){let t,i,d=r.data.techniques[0].passes[0].effects[0],c=[];for(let a=0;a<d.samplerIndex.length;a++){let n=d.samplerIndex[a],s=r.data.samplers[n];if(s)if((t=s&&o.data.texTokens[s.textureIndex])||(t="0-0"),i=null,e.textures.forEach(function(e){i||e.token.split("-")[0]!==t.split("-")[0]||(i=e)}),i)c.push(i);else if(s)c.push(e.textures[s.textureIndex]);else{if(!(e.textures.length>0))return;c.push(e.textures[0])}}if(c.length<=0)return;c.forEach(function(e,t){if(!e)return;let i=e&&e.filename;l[t]=s(i,a,n),l[t]&&(l[t].uvIdx=e.uvPSInputIndex)})}if(l){let t=!1,r=!1;if(e.textures.forEach(function(e){t||"1733499172"!==e.token.split("-")[0]||(t=e),r||"404146670"!==e.token.split("-")[0]||(r=e)}),!t||t.filename<=0)return;if(i=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:s(t.filename,a,n)}),r){let e=s(r.filename,a,n);e.flipY=!0,i.normalMap=e}i.textureFilename=t.filename,16460!==o.data.flags&&(i.alphaTest=.05)}else i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(i.needsUpdate=!0,e){let a=1,n=16;o=t.getChunk("grmt"),e.materialFlags&a||e.materialFlags&n||e.materialFlags;let r=8;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(o.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",o.data.flags),o.data.flags&r||(i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:i.map})),16460!==o.data.flags&&(i.alphaTest=.05)}return i},loadLocalTexture:l}},{}],20:[function(e,t,a){const n=Math.pow(2,32);t.exports={f16:function(e){let t=(32768&e)>>15,a=(31744&e)>>10,n=1023&e;return 0===a?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31===a?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,a-15)*(1+n/Math.pow(2,10))},popcount:function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63},arr32To64:function(e){return n*e[1]+e[0]},sort_unique:function(e,t){let a=Array.prototype.sort.call(e,t),n={},i=[];for(let e=0,t=a.length;e<t;++e)n.hasOwnProperty(a[e])||(i.push(a[e]),n[a[e]]=1);return i}}},{}],21:[function(e,t,a){t.exports={getArrayReader:function(e,t){return function(a,n){let i=[];try{let r=a.readUint32(),o=a.readUint32();if(0===o)return i;let s=a.position-4+o,l=a.position;if(t&&r>t)throw"Array length "+r+" exceeded allowed maximum "+t;a.seek(s),i=a.readType(["[]",e,r],n),a.seek(l)}catch(t){console.warn("getArrayReader Failed loading array",t),console.warn("getArrayReader Failed loading array, structDef",e)}return i}},getRefArrayReader:function(e){return function(t){let a=[],n=t.readUint32(),i=t.position+t.readUint32();if(0===n)return a;let r=t.position;t.seek(i);let o=t.readInt32Array(n),s=r-4;t.seek(s),s+=t.readUint32();for(let n=0;n<o.length;n++)if(0!==o[n]){let i=s+4*n+o[n];t.seek(i);try{a.push(t.readStruct(e))}catch(e){a.push(null),console.warn("getRefArrayReader could not find refered data at offset",o[n],e)}}return t.seek(r),a}},getQWordReader:function(){return function(e){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e){let t=e.position+e.readUint32(),a=e.position;e.seek(t);let n=e.readCString();return e.seek(a),n}},getString16Reader:function(e){return function(t){let a=t.position+t.readUint32()+(e||0),n=t.position;t.seek(a);let i,r="";for(;t.position+2<t.byteLength&&0!==(i=t.readUint16());)r+=String.fromCharCode(i);return t.seek(n),r}},getPointerReader:function(e){return function(t){let a=t.readUint32();if(0===a)return{};let n=t.position-4+a,i=t.position;t.seek(n);let r=t.readStruct(e);return t.seek(i),r}},getFileNameReader:function(){return function(e){let t;try{let a=e.position+e.readUint32();t=e.position,e.seek(a);let n=e.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(n.m_highPart-256)+(n.m_lowPart-256)+1;return i<0&&(i=0),e.seek(t),i}catch(a){return e.seek(t),-1}}}}},{}],22:[function(e,t,a){const n=e("../format/file/GW2File"),i=e("./MaterialUtils"),r=e("./MathUtils");let o={},s={Position:1,Weights:2,Group:4,Normal:8,Color:16,Tangent:32,Bitangent:64,TangentFrame:128,UV32Mask:65280,UV16Mask:16711680,Unknown1:16777216,Unknown2:33554432,Unknown3:67108864,Unknown4:134217728,PositionCompressed:268435456,Unknown5:536870912};function l(e,t,a,n,l){let d=t.data.meshes,c=[],u=a.data.permutations[0].materials;return d.forEach(function(t){let d=t.geometry,m=d.verts.mesh.fvf,h=d.verts.vertexCount,p=d.verts.mesh.vertices,f=d.indices.indices,g=new THREE.BufferGeometry,y=new DataStream(p.buffer),v=p.length/h,E=new Float32Array(3*h),T=[],R=12*!!(m&s.Position)+4*!!(m&s.Weights)+4*!!(m&s.Group)+12*!!(m&s.Normal)+4*!!(m&s.Color)+12*!!(m&s.Tangent)+12*!!(m&s.Bitangent)+12*!!(m&s.TangentFrame),b=(m&s.UV32Mask)>>8,k=(m&s.UV16Mask)>>16,w=!!b,x=!!k||!!b,M=w?b:k,N=r.popcount(M);if(N=Math.min(N,1),x)for(let e=0;e<N;e++)T[e]=new Float32Array(2*h);s.Normal,s.Tangent,s.Bitangent,s.TangentFrame;for(let e=0;e<h;e++){y.seek(e*v);let t=y.readFloat32(),a=y.readFloat32(),n=y.readFloat32();if(E[3*e+0]=t,E[3*e+1]=-n,E[3*e+2]=-a,x)for(let t=0;t<N;t++){let a,n;y.seek(e*v+R+t*(w?8:4)),w?(a=y.readUint32(),n=y.readUint32()):(a=r.f16(y.readUint16()),n=r.f16(y.readUint16())),T[t][2*e+0]=a,T[t][2*e+1]=n}}let L=new Uint16Array(f.length);for(let e=0;e<f.length;e+=3)L[e+0]=f[e+2],L[e+1]=f[e+1],L[e+2]=f[e+0];if(g.addAttribute("position",new THREE.BufferAttribute(E,3)),g.setIndex(new THREE.BufferAttribute(L,1)),g.computeVertexNormals(),x){for(let e=0;e<N;e++){let t="uv"+(e>0?e+1:"");g.addAttribute(t,new THREE.BufferAttribute(T[e],2)),g.attributes[t].needsUpdate=!0}g.uvsNeedUpdate=!0}g.buffersNeedUpdate=!0;let P=t.materialIndex,S=u[P],F=null;S&&o[S.filename]&&(F=o[S.filename]);let C=i.getMaterial(S,F,e,n);if(!C){if(!l)return;C=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}let A=new THREE.Mesh(g,C);S&&(A.materialFlags=S.materialFlags,A.materialFilename=S.filename),A.materialName=t.materialName,A.numLods=t.geometry.lods.length,A.lodOverride=a.data.lodOverride,A.flags=t.flags,A.numUV=N,c.push(A)}),c}function d(e,t,a,i,r,s){let d=[];a.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;let c=new DataStream(t),u=new n(c,0),m=u.getChunk("modl"),h=u.getChunk("geom"),p=m.data.boundingSphere,f=p.center;p.radius+=Math.sqrt(f[0]*f[0]+Math.sqrt(f[1]*f[1]+f[2]*f[2]));let g=m.data.permutations[0].materials;!function e(t,i){if(t>=g.length)return void i();let r=g[t];o[r.filename]?e(t+1,i):a.loadFile(r.filename,function(a){if(a){let e=new DataStream(a),t=new n(e,0);o[r.filename]=t}e(t+1,i)})}(0,function(){l(a,h,m,i,r).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(r||2056&e.materialFlags)&&(4===e.flags||1===e.flags||e.flags,d.push(e))}),s(d,p)})}catch(t){console.warn("Failed rendering model "+e,t);let a=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);a.flags=4,a.materialFlags=2056,a.lodOverride=[1e6,1e6],d.push(a),s(d)}})}t.exports={renderRect:function(e,t,a,n){let i=e.x1-e.x2,r=e.y1-e.y2;n||(n=1);let o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=t,d=new THREE.BoxGeometry(i,n,r);a=a||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});let c=new THREE.Mesh(d,a);return c.overdraw=!0,c.position.x=o,c.position.y=l,c.position.z=s,c},loadLocalTexture:function(e,t,a,n,r){return T3D.Logger.log(T3D.Logger.TYPE_WARNING,"RenderUtils.loadLocalTexture is deprecated ! Please use the one from MaterialUtils."),i.loadLocalTexture(e,t,a,n,r)},renderGeomChunk:l,loadMeshFromModelFile:d,getMeshesForFilename:function(e,t,a,n,i,r,o){n[e]?o(n[e].meshes,!0,n[e].boundingSphere):d(e,0,a,i,r,function(t,a){t&&(n[e]={meshes:t,boundingSphere:a}),o(t,!1,a)})},getFilesUsedByModel:function(e,t,a){let i=[e];t.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;let a=new DataStream(t);new n(a,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){let t=e.filename;i.push(t),e.textures.forEach(function(e){i.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}a(i)})}}},{"../format/file/GW2File":18,"./MaterialUtils":19,"./MathUtils":20}],23:[function(e,t,a){t.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}],24:[function(e,t,a){var n,i,r=e("./SceneUtils"),o=new THREE.Vector3,s=!1,l=!1,d=!1,c=!1,u=!1,m=!1,h=500,p=!0,f=!1,g=function(){};g.prototype.updateURL=function(){var e=i.getObject().position,t=Math.round(1e4*i.getPitchObject().rotation.x)/1e4,a=Math.round(1e4*i.getObject().rotation.y)/1e4,n={map:$("#mapPicker").val(),x:Math.round(1e3*e.x)/1e3,y:Math.round(1e3*e.y)/1e3,z:Math.round(1e3*e.z)/1e3,pitch:t,yaw:a,loadZone:$("#loadZone").prop("checked"),loadProp:$("#loadProp").prop("checked"),showHavok:$("#showHavok").prop("checked")};window.location.hash=$.param(n)},g.prototype.getControls=function(){return i},g.prototype.setSpeed=function(e){h=e},g.prototype.toggleFly=function(){p=!p},g.prototype.setSensitivity=function(e){i.setSensitivity(e)},g.prototype.invertMouse=function(){i.invertMouse()},g.prototype.update=function(e){if(i.enabled){var t=i.getObject().position.y<0;if(p||t){var a=i.getObject();if(o.x=0,o.y=0,o.z=0,l||d){var m=l?h:-h;i.getDirection(o),o.normalize(),o.multiplyScalar(m),a.position.set(a.position.x+o.x*e,a.position.y+o.y*e,a.position.z+o.z*e)}if(c||u){m=u?h:-h;a.translateX(m*e)}s&&i.getObject().translateY(h*e)}else{var f;if(o.z=l?-h:d?h:0,o.x=c?-h:u?h:0,n.ray.origin.copy(i.getObject().position),f=n.intersectObjects(r.getCollisions()),!0===f.length>0){o.y=Math.max(0,o.y);i.getObject().translateY(70-f[0].distance-1)}else o.y-=2*h*e;i.getObject().translateX(o.x*e),i.getObject().translateY(o.y*e),i.getObject().translateZ(o.z*e)}return!0}return!1},g.prototype.lock=function(){var e=document.body;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()},g.prototype.setMapReady=function(e){f=e},g.prototype.init=function(){if(!("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document))return!1;var e=this,t=document.body;document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var a=function(a){f&&(document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(controlsEnabled=!0,i.enabled=!0,$("#output").fadeOut(300)):($("#output").fadeIn(300),e.updateURL(),i.enabled=!1))},p=function(e){};document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("pointerlockerror",p,!1),document.addEventListener("mozpointerlockerror",p,!1),document.addEventListener("webkitpointerlockerror",p,!1),r.getRenderer().domElement.addEventListener("mousedown",function(t){f&&e.lock()},!1),$("#outputWrapper").on("mousedown",function(t){f&&e.lock()}),document.addEventListener("mouseup",function(e){document.exitPointerLock(),i.enabled=!1},!1),i=new THREE.PointerLockControls(r.getCamera(),.002),r.getScene().add(i.getObject());return document.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:l=!0;break;case 37:case 65:c=!0;break;case 40:case 83:d=!0;break;case 39:case 68:u=!0;break;case 32:s=!0,!0===m&&(o.y+=h,m=!1)}},!1),document.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:l=!1;break;case 37:case 65:c=!1;break;case 40:case 83:d=!1;break;case 39:case 68:u=!1;break;case 32:s=!1,m=!0}},!1),n=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,-1,0),0,70),!0},t.exports=g},{"./SceneUtils":25}],25:[function(e,t,a){var n,i,r,o,s,l,d=60,c=10,u=5e3,m=null,h=[],p=[],f=[],g=[],y=[],v=0,E=0;function T(e){e instanceof THREE.LOD&&e.update(r)}t.exports={setupScene:function(){n=new THREE.Scene,i=new THREE.Scene;var e=window.innerWidth;s=r=new THREE.PerspectiveCamera(d,e/window.innerHeight,c,v),l=new THREE.PerspectiveCamera(d,e/window.innerHeight,c,1e6);var t,a=new THREE.AmbientLight(0);n.add(a),(t=new THREE.DirectionalLight(16777215,.7)).position.set(0,0,1),n.add(t),(t=new THREE.DirectionalLight(16777215,.3)).position.set(-1,1,-1),n.add(t),n.fog=new THREE.Fog(16777215,Math.max(1,v-u),v),(m=new THREE.WebGLRenderer({sortObjects:!1,stencil:!1,premultipliedAlpha:!1,antialiasing:!0})).sortObjects=!1,m.setSize(e,window.innerHeight),m.autoClear=!1,m.domElement.style.position="absolute",document.body.appendChild(m.domElement),$(window).resize(this.resize),this.render()},setPerspective:function(){s=r,this.render()},setOrthographic:function(e,t,a,n,i,r){var l,d=window.innerWidth/window.innerHeight,c=Math.abs(e-t),u=Math.abs(a-n);c/u<d?(e*=l=u*d/(1*c),t*=l):(a*=l=c/d/(1*u),n*=l);var m=1.01;e*=m,t*=m,a*=m,n*=m,(o=new THREE.OrthographicCamera(e,t,a,n,i,r)).position.set(0*(e+t)/2,-r/2,0*(a+n)/2),o.rotation.set(Math.PI/2,0,0,"YXZ"),s=o,this.render()},setHSLa:function(e,t,a,n){for(var i=0;i<5;i++)g[i]&&(g[i].color.setHSL(e,t,a),g[i].intensity=n,e=(e+.2)%1)},setRenderVisible:function(e){m.domElement.style.display=e?"block":"none"},applyCameraRotationTo:function(e){if(r.parent){var t=r.parent.rotation.x,a=r.parent.parent.rotation.y;e.rotation.set(t,a,0,"YXZ")}},render:function(){null!==m&&(10==++E&&(E=0,n.traverse(T)),m.clear(m.getClearColor()),r==s&&(this.applyCameraRotationTo(l),m.render(i,l)),m.render(n,s))},clear:function(){h.forEach(function(e){n.remove(e)}),p.forEach(function(e){n.remove(e)}),g.forEach(function(e){n.remove(e)}),y.forEach(function(e){i.remove(e)}),p=[],h=[],g=[],y=[],f=[]},resize:function(){var e=window.innerWidth;r.aspect=e/window.innerHeight,l.aspect=e/window.innerHeight,m.setSize(e,window.innerHeight),r.updateProjectionMatrix(),l.updateProjectionMatrix(),t.exports.render()},setAmbientAdd:function(e){g.forEach(function(t){var a=e;t.added&&(a-=t.added),t instanceof THREE.AmbientLight&&t.color.addScalar(a),t.added=e}),t.exports.render()},setFog:function(e){v=e,n&&n.fog&&(n.fog.far=e,n.fog.near=Math.max(1,e-u)),r&&(r.far=e,r.updateProjectionMatrix(),f.forEach(function(e){e.material.uniforms.fogNear.value=n.fog.near,e.material.uniforms.fogFar.value=n.fog.far,e.material.needsUpdate=!0})),this.render()},showProgressPanel:function(e){var t=$("#progressPanel");t.is(":visible")?e&&e():(t.find(".progressTitle").html("Loading"),t.find(".progress").html("..."),this.showPanel(t,e))},showMapPanel:function(e){this.showPanel($("#mapPanel"),e)},showPanel:function(e,t){var a=$("#output").find(".ui-panel:visible");this.swapPanels(a,e,!0,t)},swapPanels:function(e,t,a,n){e.parent().css({height:e.parent().height()}),t.removeClass("hidden");var i,r,o=t.height();t.addClass("hidden"),t.css({right:a?-500:"auto",left:a?"auto":-500}),e.css({right:a?-500:"auto"}),a?(i={left:-500},r={right:0}):(i={right:-500},r={left:0}),e.animate(i,0,"swing",function(){e.addClass("hidden"),e.parent().animate({height:o},0,"swing",function(){t.removeClass("hidden"),t.animate(r,0,"swing",n)})})},getScene:function(){return n},getSkyScene:function(){return i},getCamera:function(){return r},getRenderer:function(){return m},getCollisions:function(){return h},getNonCollisions:function(){return p},getTerrainChunks:function(){return f},getSkyObjects:function(){return y},getLights:function(){return g}}},{}],26:[function(e,t,a){var n=e("./UI.js"),i=e("./SceneUtils.js"),r=e("./FlyControls.js"),o=e("t3d-lib"),s=t.exports=function(){this.map,this.stats,this.controller,this.hasPointerLock,this.ui,this.lastTs=-1,this.animating=!1,this.localReader=null,this._mapRect=null,this.mapAutoLoad=null,this.animationTime=0,$(document).ready(this.onDocumentReady.bind(this)),this.initAnim=function(){var e=this;$(".content  h1").first().animate({"margin-top":20},e.animationTime),$("nav").slideUp(e.animationTime,function(){$("#intro").delay(e.animationTime).fadeOut(e.animationTime,e.init.bind(e))})},this.init=function(){var e=this;this.mapAutoLoad=l(window.location.hash.slice(1)),console.log(this.mapAutoLoad),$("#intro").hide(),this.stats=new Stats,$("body").append(this.stats.domElement),this.controller=new r,this.ui=new n($("body"),this.controller,this.loadMap.bind(e)),this.ui.init();var t=$("<input type='file' class='hidden' />"),a=$("<button id='fileInputIcon' tabindex='-1'>Select a Guild Wars 2 .dat file</button>");a.click(function(){t.trigger("click")});t.change(function(a){var n=a.target.files[0];t.val(""),e.localReader=o.getLocalReader(n,function(){i.showProgressPanel(function(){$("#output").find(".progressTitle").html("Finding maps (first visit only)"),$("#output").find(".progress").html("initializing"),setTimeout(function(){o.getMapListAsync(e.localReader,e.applyMapList.bind(e),!1)},10)})},void 0,void 0,"js/T3D/t3dworker.js")}),$("#filePanel").append(t),$("#filePanel").append(a);var s=$("<span class='link'>Scan all .dat entries for maps</span>");s.click(function(t){confirm("Searching the full .dat file will take roughly 10 minutes depending on file size.\n\nOnce complete the results will be stored locally and available every time you load this .dat.\n\nNote that the vast majority of maps are probably already loaded.Are you sure you want to search the .dat for maps?")&&i.showProgressPanel(function(){$("#output").find(".progressTitle").html("Finding maps (first visit only)"),$("#output").find(".progress").html("initializing"),setTimeout(function(){o.getMapListAsync(e.localReader,e.applyMapList,!0)},10)})});var d=$("<p class='instruction'>Missing maps? </p>");d.append(s),$("#mapPanel").append(d),document.addEventListener("keydown",this.keyDownListener,!1),document.addEventListener("mousewheel",this.mouseWheelListener,!1),i.setupScene(),i.setRenderVisible(!1),this.hasPointerLock=this.controller.init()},this.loadMap=function(e,t){var a,n,r,s=this;void 0!=s.mapAutoLoad.showHavok?(a=s.mapAutoLoad.showHavok,$("#showHavok").prop("checked",a)):a=$("#showHavok").prop("checked"),void 0!=s.mapAutoLoad.loadProp?(n=s.mapAutoLoad.loadProp,$("#loadProp").prop("checked",n)):n=$("#loadProp").prop("checked"),void 0!=s.mapAutoLoad.loadZone?(r=s.mapAutoLoad.loadZone,$("#loadZone").prop("checked",r)):r=$("#loadZone").prop("checked"),i.showProgressPanel(function(){s.controller.setMapReady(!1),i.setRenderVisible(!1);var t=[{renderClass:o.HavokRenderer,settings:{visible:a}},{renderClass:o.EnvironmentRenderer,settings:{}},{renderClass:o.TerrainRenderer,settings:{anisotropy:i.getRenderer().getMaxAnisotropy()}}];r&&t.push({renderClass:o.ZoneRenderer,settings:{}}),n&&t.push({renderClass:o.PropertiesRenderer,settings:{}}),o.renderMapContentsAsync(s.localReader,e,t,s.onMapLoaded.bind(s))})},this.onMapLoaded=function(e){i.clear(),void 0!=e.ZoneRenderer&&e.ZoneRenderer.meshes.forEach(function(e){i.getScene().add(e),i.getNonCollisions().push(e)}),void 0!=e.PropertiesRenderer&&e.PropertiesRenderer.meshes.forEach(function(e){i.getScene().add(e),i.getNonCollisions().push(e)}),e.EnvironmentRenderer.skyElements.forEach(function(e){i.getSkyScene().add(e),i.getSkyObjects().push(e)}),e.TerrainRenderer.terrainTiles.forEach(function(e){i.getScene().add(e),i.getTerrainChunks().push(e),i.getCollisions().push(e)}),i.getScene().add(e.TerrainRenderer.water),i.getNonCollisions().push(e.TerrainRenderer.water),void 0!=e.HavokRenderer&&e.HavokRenderer.meshes.forEach(function(e){i.getScene().add(e),i.getCollisions().push(e)}),e.EnvironmentRenderer.lights.forEach(function(e){i.getScene().add(e),i.getLights().push(e)});var t=e.EnvironmentRenderer.hazeColor,a=new THREE.Color(t[2]/255,t[1]/255,t[0]/255);i.getRenderer().setClearColor(a,1),i.getScene().fog.color.copy(a),_mapRect=e.TerrainRenderer.bounds,this.controller.setMapReady(!0),$("#UI").removeClass("hidden"),$("#ambientSlider").slider("value",e.EnvironmentRenderer.hasLight?0:.5),$("#fogSlider").slider("value",35e3),this.hasPointerLock?i.showPanel($("#suspendedPanel")):i.showPanel($("#errorPanel"));var n=this.controller.getControls();n.getObject().position.set(0,e.TerrainRenderer.bounds?e.TerrainRenderer.bounds.y2:0,0),n.getPitchObject().rotation.x=-Math.PI/2,void 0!=this.mapAutoLoad.x&&void 0!=this.mapAutoLoad.y&&void 0!=this.mapAutoLoad.z&&n.getObject().position.set(this.mapAutoLoad.x,this.mapAutoLoad.y,this.mapAutoLoad.z),void 0!=this.mapAutoLoad.yaw&&void 0!=this.mapAutoLoad.pitch&&(n.getPitchObject().rotation.x=this.mapAutoLoad.pitch,n.getObject().rotation.y=this.mapAutoLoad.yaw),this.mapAutoLoad={},i.render(),i.setRenderVisible(!0),this.animating||(this.animating=!0,this.animate(0)),this.controller.updateURL()},this.applyMapList=function(e){var t=this;this.mapAutoLoad=l(window.location.hash.slice(1));var a=$("#mapPicker");a.empty(),a.append($("<option selected='true' disabled='disabled'>Pick Map</option>"));var n=function(e,t){return e.name<t.name?-1:e.name>t.name?1:0};e.maps.sort(n),e.maps.forEach(function(e){var t=$("<optgroup label='"+e.name+"' />");a.append(t),e.maps.sort(n),e.maps.forEach(function(e){t.append("<option value='"+e.fileName+"'>"+e.name+"</option>")})}),i.showMapPanel(),void 0!=t.mapAutoLoad.map&&$("#mapPicker option").each(function(){if(t.mapAutoLoad.map==this.value){var e=$.Event("change");$("#mapPicker").val(this.value),$("#mapPicker").trigger(e)}})},this.mouseWheelListener=function(e){var t=Math.sign(e.wheelDelta),a=$("#moveSpeedSlider"),n=a.slider("option","min"),i=a.slider("option","max"),r=(i-n)*t*.05+a.slider("option","value");r=Math.min(i,r),r=Math.max(n,r),a.slider("option","value",r)},this.animate=function(e){var t=e-this.lastTs;t>0&&(this.lastTs=e,this.controller.update(.001*t)&&i.render(),this.stats.update()),window.requestAnimationFrame(this.animate.bind(this))},this.keyDownListener=function(e){if(85==e.keyCode&&($("#UI").toggle(),i.resize()),73==e.keyCode&&$("#stats").toggle(),80==e.keyCode&&i.setPerspective(),79==e.keyCode){var t=_mapRect;if(t){var a=t.x1,n=t.x2,r=t.y1,o=t.y2;i.setOrthographic(a,n,r,o,1e5,-1e5)}}70==e.keyCode&&$("#flyInput").trigger("click")}};function l(e){var t=e.split("&"),a={};if(e.length<1)return a;for(elt of t)elt=elt.split("="),"true"==elt[1]||"false"==elt[1]?a[elt[0]]="true"==elt[1]:a[elt[0]]=Number(elt[1]);return a}s.prototype.onDocumentReady=function(){console.log("Tyria 3D API version "+o.version);var e=o.hasWebGL();$("#frontpageLoader").addClass("hidden"),window.WebGLRenderingContext&&e?(window.location.hash.length>1&&this.initAnim(),$("#ILoveYouDiddi").removeClass("hidden").one("click",this.initAnim.bind(this))):$("#errorGL").removeClass("hidden")};new s},{"./FlyControls.js":24,"./SceneUtils.js":25,"./UI.js":27,"t3d-lib":8}],27:[function(e,t,a){var n=e("./SceneUtils"),i=function(e,t,a){this.holder=e,this.controller=t,this.loadMap=a};i.prototype.selectMap=function(e){$("#mapPicker option").filter(function(){return $(this).val()==e.fileName}).prop("selected",!0),$("#mapPicker").change()},i.prototype.logProgress=function(){i.op||(i.op=$("#output")),"Find type"!=arguments[0]&&i.op.find(".progressTitle").html(arguments[0]),parseFloat(arguments[1])?i.op.find(".progress").html(arguments[1]+"%"):i.op.find(".progress").html(arguments[1])},i.prototype.init=function(){var e=this;T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS]=this.logProgress,T3D.Logger.logFunctions[T3D.Logger.TYPE_DEBUG]=function(){};var t=$("<div id='UI' class='diagonalBG hidden' />");this.holder.append(t);var a=$("<div id='outputWrapper'/>");a.css({top:-500}).delay(0).animate({top:0},0);var i=$("<div id='output' class='diagonalBG'/>");a.append(i),this.holder.append(a),i.append($("<div class='ui-panel' id='filePanel'><p class='title'><span class='titleLink homeLink'>Home</span><span class='titleSeparator'> &#187 </span>File<span class='titleSeparator'> &#187 </span><span class='titleInactive'>Map</span></p><p class='instruction'>Tyria 3D reads data from the Guild Wars 2 <span class='hightlight'>.dat file</span>. This file contains all the assets used to run the game and is located in the Guild Wars 2 install directory, the same directory that the game executable is located in.</p></div>"));var r=$("<div class='ui-panel hidden' id='progressPanel'><p class='progressTitle'></p><p class='progress'></p></div>");i.append(r);var o=$("<div class='ui-panel hidden' id='errorPanel'>Your browser doesn't seem to support Pointer Lock API, navigating the map will not be possible.<br/><br/>Pro tip: <a href='https://www.google.com/chrome/browser/desktop/index.html' target='_blank'>Donwload Google Chrome</a>.</div>");i.append(o);var s=$("<div class='ui-panel hidden' id='suspendedPanel'>This view is suspended until you<br/><br/> <strong>click and hold</strong> to look around<br /><br/>or<br/><br />click the <strong>Lock Mouse</strong> button<br/><br/>When this view is active, use <strong>W A S D</strong> and <strong>space</strong> to move and jump + air jump</div>");i.append(s);var l=$("<div class='ui-panel hidden' id='mapPanel'><p class='title'><span class='titleLink homeLink'>Home</span><span class='titleSeparator'> &#187 </span><span id='mapBack' class='titleLink'>File</span><span class='titleSeparator'> &#187 </span>Map</p><p class='instruction' style='margin-bottom:0;'>Select what data to load and pick a <span class='highlight'>Map</span>.</p></div>");i.append(l),$("#mapBack").click(function(e){n.swapPanels($("#mapPanel"),$("#filePanel"))}),$(".homeLink").click(function(){location.reload()}),l.append($("<label class='noselect'><p class='label'>Zone Models</p><input type='checkbox' id='loadZone' tabindex='-1' /></label><label class='noselect '><p class='label'>Prop Models</p><input type='checkbox' id='loadProp' tabindex='-1' checked='checked' /></label><label class='noselect '><p class='label'>Visible collision</p><input type='checkbox' id='showHavok' tabindex='-1' /></label><br/>"));var d=$("<select id='mapPicker' tabindex='-1'/>");d.append($("<option selected='true' disabled='disabled'>No .dat loaded</option>")),T3D.MapFileList.maps.forEach(function(e){var t=$("<optgroup label='"+e.name+"' />");d.append(t),e.maps.forEach(function(e){t.append("<option value='"+e.fileName+"'>"+e.name+"</option>")})}),d.change(function(t){var a=d.val();e.loadMap(a,t.value);var n=$("#mapPicker option").filter(function(){return $(this).val()==a}).html();$("#mapTitle").html(n),d.blur()}),l.append(d),l.append($("<p class='instruction'>Enabling <span class='highlight'>Zone Models</span> allows you to view trees, plants and various 'nature' models. </p><p class='instruction'>Enabling <span class='highlight'>Prop Models</span> allows you to view most of the models in a map. </p><p class='instruction'>Enabling <span class='highlight'>Visible collision</span> allows you to view all the collision data in a map.  The collision data has no textures but will give you a hint of how the map looks with actual models, consider enabling only Visible collision to reduce map loading times.  If you enabled Zone Models or Prop Models you probably don't want Visible collision.</p>"));var c=$("<div class='ui-panel' id='optionsPanel'>\n\t\t\t<p class='title' id='mapTitle'></p>\n\t\t\t<p id='showMapSelection' class='optionsLink' tabindex='-1'>Back to map selection</p>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<br/>\n\t\t\t\t<span class='label'>View distance:</span><br/>\n\t\t\t\t<div class='slider' id='fogSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>&#128161;:</span>\n\t\t\t\t<div class='slider' id='ambientSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>Speed [Scroll Up/Down]:</span>\n\t\t\t\t<div class='slider' id='moveSpeedSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>Mouse sensitivity:</span>\n\t\t\t\t<div class='slider' id='mouseSensSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<label class='noselect halfLabel'><p class='label'>Fly [F]</p>\n\t\t\t\t<input id='flyInput' type='checkbox' tabindex='-1' checked='checked'></input></label>\n\t\t\t\t<label class='noselect halfLabel'><p class='label'>Invert mouse</p>\n\t\t\t\t<input id='invertInput' type='checkbox' tabindex='-1'></input></label>\n\t\t\t</div>\n\t\t\t\n\t\t\t<p class='uiText'>Toggle UI [U], Toggle Stats [I], Orthographic Cam [O], Perspective Cam [P]</p>\n\t\t\t<button id='mouseLockBtn' tabindex='-1'>Lock Mouse</button>\n\t\t\t\n\t\t\t\n\t\t\t<label class='hidden'><p class='label nomargin'>Location URL</p>\t\n\t\t\t<input class='hidden' id='locationInput' type='text'></input></label>\t\n\t\t</div>");t.append(c),$("#showMapSelection").click(function(){window.location.hash="",$("#UI").addClass("hidden"),e.controller.setMapReady(!1),n.swapPanels($("#suspendedPanel"),$("#mapPanel")),$("canvas").hide(),$("#mapPicker option").prop("selected",!1),$("#mapPicker option").first().prop("selected",!0)}),$("#moveSpeedSlider").slider({min:4,max:10,step:.01,change:function(t,a){var n=Math.exp(a.value);window.setTimeout(function(){e.controller.setSpeed(n)},10)}}).slider("value",7.5),$("#mouseSensSlider").slider({min:1e-4,max:.01,step:1e-4,change:function(t,a){var n=a.value;window.setTimeout(function(){e.controller.setSensitivity(n)},10)}}).slider("value",.002),$("#fogSlider").slider({min:5e3,max:1e5,step:500,change:function(e,t){n.setFog(t.value)}}),$("#ambientSlider").slider({min:0,max:1,step:.01,change:function(e,t){n.setAmbientAdd(t.value)}}),$("#invertInput").change(function(){e.controller.invertMouse()}),$("#flyInput").change(function(){e.controller.toggleFly()}),$("#mouseLockBtn").click(function(){e.controller.lock()}),$("#locationInput").on("click",function(){this.select()})},t.exports=i},{"./SceneUtils":25}]},{},[26]);
//# sourceMappingURL=T3DAPP-1.0.6.min.js.map
